<!DOCTYPE html>
<html lang="az">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Az…ôrbaycan Beyn…ôlxalq Maarif M…ôkt…ôbl…ôri - 2025-2026 T…ôdris ili I yarƒ±mil analizi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary-blue: #00525d;
            --secondary-blue: #00adba;
            --accent-blue: #4fd1c5;
            --light-blue: #e6f7ff;
            --success-green: #10b981;
            --dark-green: #047857;
            --warning-orange: #f59e0b;
            --danger-red: #ef4444;
            --dark-gray: #374151;
            --light-gray: #f9fafb;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --border-color: #e5e7eb;
            --text-color: #374151;
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(255, 255, 255, 0.5);
            --shadow-soft: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025);
            --shadow-medium: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(at 0% 0%, hsla(189, 100%, 56%, 0.1) 0px, transparent 50%),
                radial-gradient(at 100% 0%, hsla(160, 100%, 40%, 0.1) 0px, transparent 50%);
            background-attachment: fixed;
            color: var(--text-color);
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        .navbar-brand-imsa {
            font-family: 'Poppins', sans-serif;
            letter-spacing: -0.02em;
        }

        .card {
            border: 1px solid rgba(255, 255, 255, 0.5);
            background: var(--card-bg);
            box-shadow: var(--shadow-soft);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        [data-theme="dark"] {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --border-color: #334155;
            --text-color: #f1f5f9;
            --light-blue: #0f3443;
            --dark-gray: #f1f5f9;
            --light-gray: #334155;
            --primary-blue: #38bdf8;
            --secondary-blue: #0ea5e9;
            --glass-bg: rgba(30, 41, 59, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        [data-theme="dark"] .text-muted {
            color: #94a3b8 !important;
        }

        [data-theme="dark"] .bg-white,
        [data-theme="dark"] .bg-light {
            background-color: var(--card-bg) !important;
            color: var(--text-color) !important;
        }

        [data-theme="dark"] .card-header .text-white,
        [data-theme="dark"] .navbar-imsa .text-white {
            color: white !important;
        }

        /* Prevent dark mode from stripping semantic colors */
        [data-theme="dark"] .text-success {
            color: #4ade80 !important;
        }

        [data-theme="dark"] .text-danger {
            color: #f87171 !important;
        }

        [data-theme="dark"] .text-warning {
            color: #fbbf24 !important;
        }

        [data-theme="dark"] .text-info {
            color: #38bdf8 !important;
        }

        [data-theme="dark"] .text-primary {
            color: #60a5fa !important;
        }

        /* Custom Background Colors for New Grading System */
        .bg-dark-green {
            background-color: var(--dark-green) !important;
            color: white;
        }

        .text-dark-green {
            color: var(--dark-green) !important;
        }

        /* Print styles for PDF export */
        @media print {

            .navbar,
            .desktop-sidebar,
            .mobile-compact-nav,
            .filter-section,
            .btn,
            #theme-toggle,
            .navbar-imsa {
                display: none !important;
            }

            .content-section {
                display: block !important;
                margin-top: 0 !important;
                padding: 0 !important;
            }

            body {
                padding-top: 0 !important;
                background: white !important;
                color: black !important;
            }

            .card {
                box-shadow: none !important;
                border: 1px solid #ddd !important;
                break-inside: avoid;
            }

            canvas {
                max-width: 100% !important;
            }
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            padding-top: 60px !important;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* IMSA Stili Header */
        .navbar-imsa {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            box-shadow: 0 4px 20px rgba(0, 82, 93, 0.15);
            padding: 0.5rem 0;
            backdrop-filter: blur(10px);
        }

        .navbar-brand-imsa {
            display: flex;
            align-items: center;
            font-weight: 600;
            font-size: 1.1rem;
            color: white !important;
            text-decoration: none;
            gap: 12px;
            text-align: center;
        }

        .logo-circle {
            width: 55px;
            /* Enlarged logo */
            height: 55px;
            /* Enlarged logo */
            border-radius: 50%;
            border: 2px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: var(--card-bg);
            padding: 2px;
            flex-shrink: 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }



        .logo-circle img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 50%;
        }

        .school-name {
            display: flex;
            flex-direction: column;
        }

        .school-name-main {
            font-size: 1rem;
            font-weight: 600;
            line-height: 1.2;
        }

        .school-name-sub {
            font-size: 0.75rem;
            opacity: 0.9;
            font-weight: 400;
        }

        /* Sistem M…ôlumat Kartƒ± */
        .system-info-card {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        /* Mobil Optimizasiya */
        @media (max-width: 768px) {
            body {
                padding-top: 80px !important;
                padding-bottom: 80px !important;
                /* Bottom nav space */
            }

            .mobile-compact-nav {
                position: fixed;
                bottom: 0px;
                /* Move to bottom */
                top: auto;
                left: 0;
                right: 0;
                background: var(--card-bg);
                /* Use theme bg */
                z-index: 1000;
                box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
                padding: 10px 5px;
                display: flex;
                justify-content: space-around;
                /* Distribute evenly */
                flex-wrap: nowrap;
                border-top: 1px solid var(--border-color);
            }

            .mobile-compact-nav::-webkit-scrollbar {
                display: none;
            }

            .mobile-nav-btn {
                flex: 1;
                display: flex;
                flex-direction: column;
                /* Icon top, text bottom */
                align-items: center;
                justify-content: center;
                padding: 0.5rem 0.2rem;
                margin: 0;
                background: transparent;
                border: none;
                border-radius: 8px;
                color: var(--text-color);
                font-weight: 500;
                font-size: 0.7rem;
                /* Smaller text */
                white-space: nowrap;
                transition: all 0.2s ease;
                opacity: 0.7;
            }

            .mobile-nav-btn.active {
                background: transparent;
                color: var(--primary-blue);
                opacity: 1;
            }

            .mobile-nav-btn i {
                margin-right: 0;
                margin-bottom: 4px;
                /* Space between icon and text */
                font-size: 1.2rem;
            }

            .content-section {
                margin-top: 120px !important;
                padding: 1rem !important;
            }

            .stat-card {
                padding: 1rem !important;
                margin-bottom: 0.75rem !important;
            }

            .stat-card h3 {
                font-size: 1.5rem !important;
            }

            .chart-container {
                height: 250px !important;
            }

            .table-responsive {
                font-size: 0.85rem;
            }

            .navbar-brand-imsa {
                font-size: 0.9rem;
            }

            .logo-circle {
                width: 40px;
                height: 40px;
            }
        }

        /* Desktop Sidebar */
        @media (min-width: 769px) {
            .desktop-sidebar {
                background: linear-gradient(180deg, var(--primary-blue) 0%, #003f47 100%);
                min-height: calc(100vh - 60px);
                position: sticky;
                top: 60px;
                box-shadow: 3px 0 15px rgba(0, 0, 0, 0.1);
            }

            .sidebar-nav {
                padding: 1.5rem 0;
            }

            .sidebar-nav .nav-link {
                color: rgba(255, 255, 255, 0.9);
                padding: 0.75rem 1.5rem;
                margin: 0.25rem 1rem;
                border-radius: 8px;
                transition: all 0.3s ease;
                font-weight: 500;
            }

            .sidebar-nav .nav-link:hover,
            .sidebar-nav .nav-link.active {
                background: rgba(255, 255, 255, 0.15);
                color: white;
                transform: translateX(5px);
            }

            .sidebar-nav .nav-link i {
                width: 24px;
                text-align: center;
                margin-right: 10px;
            }
        }

        /* ƒ∞statistik Kartlarƒ± */
        .stat-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .stat-card.blue {
            border-left: 4px solid var(--secondary-blue);
        }

        .stat-card.green {
            border-left: 4px solid var(--success-green);
        }

        .stat-card.orange {
            border-left: 4px solid var(--warning-orange);
        }

        .stat-card.red {
            border-left: 4px solid var(--danger-red);
        }

        .stat-card i {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--primary-blue);
        }

        /* Kartlar */
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
            background: var(--card-bg);
            color: var(--text-color);
            transition: background-color 0.3s ease;
        }

        .card-header {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: white;
            border-radius: 12px 12px 0 0 !important;
            padding: 1rem 1.5rem;
            font-weight: 600;
        }

        /* C…ôdv…ôll…ôr */
        .data-table th {
            background: var(--light-blue);
            color: var(--primary-blue);
            font-weight: 600;
            padding: 1rem;
            position: sticky;
            top: 0;
        }

        .data-table td {
            padding: 0.75rem 1rem;
            vertical-align: middle;
            color: var(--text-color);
        }

        .data-table tr:hover {
            background-color: var(--light-gray);
            opacity: 0.9;
        }

        /* Davamsƒ±zlq ƒ∞ndikatorlarƒ± */
        .attendance-low {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-red);
        }

        .attendance-medium {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning-orange);
        }

        .attendance-good {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-green);
        }

        .attendance-excellent {
            background-color: rgba(79, 209, 197, 0.1);
            color: var(--accent-blue);
        }

        .attendance-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 500;
            font-size: 0.85rem;
        }

        /* Proqress Barlarƒ± */
        .progress-custom {
            height: 8px;
            border-radius: 4px;
            background-color: #e5e7eb;
        }

        .progress-custom .progress-bar {
            border-radius: 4px;
        }

        /* Filtre B√∂lm…ôsi */
        .filter-section {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
            transition: background-color 0.3s ease;
        }

        /* Analiz Qrafikl…ôri */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        /* ≈ûagird Profil ≈û…ôkli - M…ôkt…ôb Logosu */
        .student-photo {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 2px solid var(--primary-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: var(--card-bg);
            padding: 2px;
        }

        .student-photo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* Heatmap Styles */
        .heatmap-grid {
            display: grid;
            gap: 2px;
            margin-top: 1rem;
        }

        .heatmap-cell {
            padding: 10px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 500;
            border-radius: 4px;
            min-width: 60px;
            transition: transform 0.2s ease;
        }

        .sticky-col {
            position: sticky;
            left: 0;
            z-index: 99 !important;
            /* Higher Z-index to stay on top */
            background: var(--light-gray);
            border-right: 2px solid var(--border-color);
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            /* Drop shadow to separate */
        }

        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 90;
            background: var(--light-gray);
            border-bottom: 2px solid var(--border-color);
        }

        .sticky-col.sticky-header {
            z-index: 100 !important;
            /* Highest Z-index for top-left intersection */
        }

        .heatmap-cell:hover {
            transform: scale(1.05);
            z-index: 10;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .heatmap-header {
            font-weight: 600;
            background: var(--light-gray);
            padding: 12px 5px;
            border-radius: 4px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            word-break: break-word;
            line-height: 1.2;
            min-height: 50px;
        }

        /* Search Styles */
        .search-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: flex-start;
            padding-top: 10vh;
        }

        .search-container {
            width: 90%;
            max-width: 600px;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        #global-search-input {
            width: 100%;
            padding: 20px;
            font-size: 1.2rem;
            border: none;
            border-bottom: 1px solid var(--border-color);
            background: transparent;
            color: var(--text-color);
            outline: none;
        }

        .search-results {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }

        .search-item {
            padding: 12px 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-color);
        }

        .search-item:hover {
            background: var(--light-blue);
            transform: translateX(5px);
        }

        /* --- ANIMATIONS --- */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }

        .animate-slide-up {
            animation: fadeInUp 0.6s ease-out forwards;
        }

        .content-section {
            animation: fadeIn 0.5s ease-out forwards;
        }

        .card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card {
            animation: fadeInUp 0.5s ease-out forwards;
            animation-fill-mode: both;
        }

        /* Delay for staggered animation */
        .stat-card:nth-child(1) {
            animation-delay: 0.1s;
        }

        .stat-card:nth-child(2) {
            animation-delay: 0.2s;
        }

        .stat-card:nth-child(3) {
            animation-delay: 0.3s;
        }

        .stat-card:nth-child(4) {
            animation-delay: 0.4s;
        }

        .stat-card:nth-child(5) {
            animation-delay: 0.5s;
        }

        /* Table row animation */
        .data-table tr {
            transition: all 0.2s ease;
        }

        .data-table tr:hover {
            transform: scale(1.01);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            z-index: 2;
        }

        /* AI Chat Button Pulse */
        .ai-chat-btn {
            animation: pulse 2s infinite ease-in-out;
        }

        .ai-chat-btn:hover {
            animation: none;
            transform: scale(1.1);
        }

        .search-item i {
            width: 30px;
            height: 30px;
            background: var(--primary-blue);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Offcanvas Styling */
        .offcanvas-imsa {
            background: linear-gradient(180deg, var(--primary-blue) 0%, #003f47 100%);
            color: white;
        }

        .offcanvas-imsa .nav-link {
            color: rgba(255, 255, 255, 0.9);
            padding: 12px 20px;
            border-radius: 8px;
            margin: 5px 15px;
        }

        .offcanvas-imsa .nav-link.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        /* Teacher Card Styles */
        .teacher-card {
            border: none !important;
            border-radius: 16px !important;
            overflow: hidden;
            background: var(--card-bg);
            box-shadow: var(--shadow-soft);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .teacher-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-medium);
        }

        .avatar-circle {
            box-shadow: 0 4px 10px rgba(0, 173, 186, 0.3);
            border: 3px solid white;
        }

        #teacher-detail-view .card {
            border-radius: 20px;
            border: none;
        }

        [data-theme="dark"] #teacher-detail-view .card-header {
            color: white !important;
        }

        #teacher-detail-view .card-header {
            background: transparent;
            border-bottom: 1px solid var(--border-color);
            padding: 1.5rem;
            color: var(--text-color);
        }

        /* Kbd Shortcut */
        kbd {
            background-color: var(--light-gray);
            border: 1px solid var(--border-color);
            border-radius: 3px;
            box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2);
            color: var(--text-color);
            display: inline-block;
            font-size: 0.85em;
            font-weight: 700;
            line-height: 1;
            padding: 2px 4px;
            white-space: nowrap;
        }

        /* Modern Grid Navigation */
        .modern-nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 8px;
            margin-bottom: 20px;
        }

        .modern-nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-color);
            text-align: center;
            height: 100%;
            min-height: 70px;
        }

        .modern-nav-btn:hover {
            background: var(--light-blue);
            transform: translateY(-2px);
        }

        .modern-nav-btn i {
            font-size: 1.2rem;
            margin-bottom: 4px;
            color: var(--primary-blue);
        }

        .modern-nav-btn span {
            font-size: 0.8rem;
            font-weight: 500;
            line-height: 1.1;
        }

        .modern-nav-btn.active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
            box-shadow: 0 4px 6px rgba(0, 82, 93, 0.2);
        }

        .modern-nav-btn.active i {
            color: white;
        }

        @media (max-width: 768px) {
            .modern-nav-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 5px;
            }

            .modern-nav-btn {
                padding: 6px 2px;
                min-height: 60px;
            }

            .modern-nav-btn span {
                font-size: 0.7rem;
            }

            .modern-nav-btn i {
                font-size: 1rem;
            }
        }

        /* AI Assistant Styles */
        .ai-chat-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00adba, #00525d);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(0, 173, 186, 0.4);
            z-index: 2000;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 3px solid rgba(255, 255, 255, 0.2);
            animation: pulse-ai 2s infinite;
        }

        @keyframes pulse-ai {
            0% {
                box-shadow: 0 0 0 0 rgba(0, 173, 186, 0.7);
            }

            70% {
                box-shadow: 0 0 0 15px rgba(0, 173, 186, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(0, 173, 186, 0);
            }
        }

        .ai-chat-btn:hover {
            transform: scale(1.1) rotate(15deg);
        }

        .ai-chat-window {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 380px;
            height: 550px;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            z-index: 1999;
            display: none;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .ai-chat-header {
            background: linear-gradient(135deg, #00525d, #00adba);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: var(--bg-color);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .ai-message {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 15px;
            font-size: 14px;
            line-height: 1.5;
            position: relative;
        }

        .ai-message.assistant {
            align-self: flex-start;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            border-bottom-left-radius: 2px;
        }

        .ai-message.user {
            align-self: flex-end;
            background: #00adba;
            color: white;
            border-bottom-right-radius: 2px;
        }

        .ai-chat-input-area {
            padding: 15px;
            padding-bottom: 25px;
            background: var(--card-bg);
            border-top: 1px solid var(--border-color);
            position: relative;
            /* For absolute positioning of button */
        }

        .ai-chat-input {
            width: 100%;
            /* Full width */
            border: 1px solid var(--border-color);
            background: var(--bg-color);
            color: var(--text-color);
            border-radius: 25px;
            /* More rounded */
            padding: 10px 15px;
            padding-right: 50px;
            /* Space for the button inside */
            outline: none;
            height: 46px;
            /* Explicit height */
        }

        .ai-chat-input-area button {
            position: absolute;
            right: 25px;
            /* 15px area padding + 10px input padding roughly */
            top: 50%;
            transform: translateY(-50%);
            width: 34px !important;
            height: 34px !important;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            z-index: 10;
            margin: 0 !important;
            /* Reset margins */
            padding-bottom: 25px;
            /* Cancel generic padding if any */
            padding-bottom: 0 !important;
            /* Reset padding */
        }

        .ai-suggestion-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        .suggestion-chip {
            background: var(--light-gray);
            border: 1px solid var(--border-color);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        /* Mobile Responsive AI Chat */
        @media (max-width: 576px) {
            .ai-chat-window {
                width: 92% !important;
                /* Ideal spacing from sides */
                left: 50% !important;
                transform: translateX(-50%);
                right: auto !important;
                bottom: 20px !important;
                /* Spacing from bottom */
                height: 75vh;
                border-radius: 20px;
                /* Fully rounded corners */
                border: 1px solid rgba(0, 0, 0, 0.1);
            }

            .ai-chat-btn {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 20px;
            }

            .ai-chat-input-area {
                padding: 15px;
            }
        }

        .suggestion-chip:hover {
            background: #00adba;
            color: white;
        }

        .ai-analysis-card {
            background: rgba(0, 173, 186, 0.05);
            border-left: 4px solid #00adba;
            padding: 10px;
            border-radius: 8px;
            margin-top: 5px;
        }

        @media (max-width: 576px) {
            .ai-chat-window {
                width: calc(100% - 40px);
                height: 70vh;
                right: 20px;
                bottom: 80px;
            }
        }

        /* Eksik CSS sƒ±nƒ±flarƒ± */
        .bg-light-custom {
            background-color: var(--light-gray);
        }

        .border-light-custom {
            border-color: var(--border-color);
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-imsa navbar-expand-lg fixed-top">
        <div class="container-fluid d-flex justify-content-between align-items-center">
            <div class="d-none d-lg-block" style="width: 100px;"></div>
            <a class="navbar-brand-imsa mx-auto" href="#">
                <div class="logo-circle">
                    <img src="https://i.imgur.com/a3FuVV8.png" alt="IMSA Logo"
                        onerror="this.onerror=null; this.src='https://placehold.co/40x40/00525d/ffffff?text=IMSA';">
                </div>
                <div class="school-name">
                    <div class="school-name-main">
                        <span class="me-1">üá¶üáø</span>
                        Az…ôrbaycan Beyn…ôlxalq Maarif M…ôkt…ôbl…ôri - N…ôsimi kampusu
                        <span class="ms-1">üáπüá∑</span>
                    </div>
                    <div class="school-name-sub">2025-2026 T…ôdris ili I yarƒ±mil analizi</div>
                </div>
            </a>
            <div class="d-flex align-items-center gap-1 gap-md-3">
                <!-- Search Button (Mobile & Desktop) -->
                <button class="btn btn-outline-light rounded-pill px-2 px-md-3 py-1 d-flex align-items-center gap-2"
                    onclick="openSearch()" title="Axtar (Ctrl+K)"
                    style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);">
                    <i class="fas fa-search small"></i>
                    <span class="d-none d-md-block" style="font-size: 0.85rem;">S√ºr…ôtli Axtarƒ±≈ü</span>
                    <span class="d-none d-md-block badge bg-light text-primary rounded-pill ms-1"
                        style="font-size: 0.65rem; opacity: 0.8;">Ctrl+K</span>
                </button>

                <!-- Theme Toggle -->
                <button id="theme-toggle"
                    class="btn btn-outline-light rounded-circle p-0 d-flex align-items-center justify-content-center"
                    style="width: 32px; height: 32px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);">
                    <i class="fas fa-moon" style="font-size: 0.9rem;"></i>
                </button>

                <!-- Hamburger removed as we use top grid now, but keeping button just in case user wants offcanvas back later, hidden for now -->
                <button class="btn btn-link text-white p-0 border-0 shadow-none d-none" type="button"
                    data-bs-toggle="offcanvas" data-bs-target="#mobileSidebar">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="navbar-text text-white ms-2 text-end" style="min-width: 150px;">
                    <div id="current-clock" class="fw-bold" style="font-size: 1rem; line-height: 1;"></div>
                    <div id="current-date" style="font-size: 0.7rem; opacity: 0.9;"></div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobil Offcanvas Sidebar -->
    <div class="offcanvas offcanvas-start offcanvas-imsa" tabindex="-1" id="mobileSidebar">
        <div class="offcanvas-header border-bottom border-light">
            <h5 class="offcanvas-title text-white">Menyu</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body p-0">
            <ul class="nav flex-column mt-3">
                <li class="nav-item">
                    <a class="nav-link active" href="#" data-section="dashboard" data-bs-dismiss="offcanvas">
                        <i class="fas fa-tachometer-alt me-2"></i> √úmumi G√∂r√ºn√º≈ü
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-section="students" data-bs-dismiss="offcanvas">
                        <i class="fas fa-users me-2"></i> ≈ûagird Analizi
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-section="attendance" data-bs-dismiss="offcanvas">
                        <i class="fas fa-calendar-alt me-2"></i> Davamsƒ±zlƒ±q Analizi
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-section="subjects" data-bs-dismiss="offcanvas">
                        <i class="fas fa-book me-2"></i> F…ônn Analizi
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-section="classes" data-bs-dismiss="offcanvas">
                        <i class="fas fa-chalkboard me-2"></i> Sinif Analizi
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-section="comparison" data-bs-dismiss="offcanvas">
                        <i class="fas fa-balance-scale me-2"></i> M√ºqayis…ô Analizi
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-section="export" data-bs-dismiss="offcanvas">
                        <i class="fas fa-file-invoice me-2"></i> Hesabat
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <div class="container-fluid" style="margin-top: 60px;">
        <div class="row">
            <!-- Sidebar Removed for Grid Layout -->
            <!-- <div class="col-lg-2 desktop-only desktop-sidebar">...</div> -->

            <!-- Main Content -->
            <!-- Main Content -->
            <div class="col-12 p-3 p-lg-4">
                <!-- Navigation Grid -->
                <div class="modern-nav-grid">
                    <div class="modern-nav-btn active" data-section="dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>√úmumi</span>
                    </div>
                    <div class="modern-nav-btn" data-section="students">
                        <i class="fas fa-users"></i>
                        <span>≈ûagird</span>
                    </div>
                    <div class="modern-nav-btn" data-section="attendance">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Davamsƒ±zlƒ±q</span>
                    </div>
                    <div class="modern-nav-btn" data-section="subjects">
                        <i class="fas fa-book"></i>
                        <span>F…ônn</span>
                    </div>
                    <div class="modern-nav-btn" data-section="classes">
                        <i class="fas fa-chalkboard"></i>
                        <span>Sinif</span>
                    </div>
                    <div class="modern-nav-btn" data-section="comparison">
                        <i class="fas fa-balance-scale"></i>
                        <span>M√ºqayis…ô</span>
                    </div>
                    <div class="modern-nav-btn" data-section="teachers">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <span>M√º…ôlliml…ôr</span>
                    </div>
                    <div class="modern-nav-btn" data-section="export">
                        <i class="fas fa-file-invoice"></i>
                        <span>Hesabat</span>
                    </div>
                </div>
                <!-- Dashboard Section -->
                <section id="dashboard-section" class="content-section">
                    <h2 class="mb-4"><i class="fas fa-tachometer-alt me-2"></i>√úmumi G√∂r√ºn√º≈ü</h2>

                    <!-- Stats Cards -->
                    <div class="row mb-4">
                        <div class="col-md-3 col-6">
                            <div class="stat-card blue">
                                <i class="fas fa-users"></i>
                                <h3 id="total-students">0</h3>
                                <p>√úmumi ≈ûagird</p>
                                <small class="text-muted" id="total-classes-info">0 sinif</small>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="stat-card green">
                                <i class="fas fa-chart-line"></i>
                                <h3 id="overall-average">0.0</h3>
                                <p>√úmumi Ortalama</p>
                                <small class="text-muted" id="average-trend">Normal</small>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="stat-card orange">
                                <i class="fas fa-calendar-times"></i>
                                <h3 id="avg-attendance">0.0</h3>
                                <p>Orta Davamsƒ±zlƒ±q</p>
                                <small class="text-muted" id="attendance-status">Yax≈üƒ±</small>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="stat-card red">
                                <i class="fas fa-exclamation-triangle"></i>
                                <h3 id="warning-students">0</h3>
                                <p>Diqq…ôt Yetirilm…ôli</p>
                                <small class="text-muted" id="warning-info">N…ôz…ôr…ô alƒ±nmalƒ±</small>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row -->
                    <div class="row mb-4">
                        <div class="col-lg-6 mb-3 mb-lg-0">
                            <div class="card h-100">
                                <div class="card-header">
                                    <i class="fas fa-chart-bar me-2"></i>F…ônn Ortalamalarƒ± (Top 8)
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="subjectAvgChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="card h-100">
                                <div class="card-header">
                                    <i class="fas fa-user-clock me-2"></i>Davamsƒ±zlƒ±q Statistikasƒ±
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="attendanceChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Dashboard Row 1: Top 5 & Warning -->
                    <div class="row">
                        <div class="col-lg-6 mb-3 mb-lg-0">
                            <div class="card h-100">
                                <div class="card-header bg-primary text-white">
                                    <i class="fas fa-trophy me-2"></i>∆èn Y√ºks…ôk N…ôtic…ôli 5 ≈ûagird
                                </div>
                                <div class="card-body">
                                    <div id="top-students-list">
                                        <p class="text-muted">Y√ºkl…ônir...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="card h-100">
                                <div class="card-header bg-warning">
                                    <i class="fas fa-exclamation-circle me-2"></i>Diqq…ôt Yetirilm…ôli Olanlar
                                </div>
                                <div class="card-body">
                                    <div id="warning-students-list">
                                        <p class="text-muted">Y√ºkl…ônir...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Dashboard Row 2: Lowest Average & Highest Attendance -->
                    <div class="row mt-4">
                        <div class="col-lg-6 mb-3 mb-lg-0">
                            <div class="card h-100">
                                <div class="card-header bg-danger text-white">
                                    <i class="fas fa-arrow-down me-2"></i>∆èn A≈üaƒüƒ± N…ôtic…ôli 5 ≈ûagird
                                </div>
                                <div class="card-body">
                                    <div id="lowest-students-list">
                                        <p class="text-muted">Y√ºkl…ônir...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="card h-100">
                                <div class="card-header bg-dark text-white">
                                    <i class="fas fa-walking me-2"></i>∆èn √áox Davamsƒ±zlƒ±q Ed…ôn 5 ≈ûagird
                                </div>
                                <div class="card-body">
                                    <div id="highest-attendance-list">
                                        <p class="text-muted">Y√ºkl…ônir...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Students Analysis Section -->
                <section id="students-section" class="content-section" style="display: none;">
                    <h2 class="mb-4"><i class="fas fa-users me-2"></i>≈ûagird Analizi</h2>

                    <div class="filter-section">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="student-class-filter" class="form-label">Sinif se√ßin:</label>
                                <select id="student-class-filter" class="form-select">
                                    <option value="all">Hamƒ±sƒ±</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="student-search" class="form-label">≈ûagird axtarƒ±n:</label>
                                <input type="text" id="student-search" class="form-control" placeholder="Ad, soyad...">
                            </div>
                            <div class="col-md-4">
                                <label for="student-sort" class="form-label">Sƒ±rala:</label>
                                <select id="student-sort" class="form-select">
                                    <option value="name">Ada g√∂r…ô</option>
                                    <option value="average_desc">Ortalamaya g√∂r…ô (azalan)</option>
                                    <option value="average_asc">Ortalamaya g√∂r…ô (artan)</option>
                                    <option value="attendance_desc">Davamsƒ±zlƒ±ƒüa g√∂r…ô (azalan)</option>
                                    <option value="attendance_asc">Davamsƒ±zlƒ±ƒüa g√∂r…ô (artan)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><i class="fas fa-list me-2"></i>≈ûagird Siyahƒ±sƒ±</span>
                            <span id="student-count" class="badge bg-primary">0 ≈üagird</span>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table data-table table-hover mb-0" id="students-table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>≈ûagird</th>
                                            <th>Sinif</th>
                                            <th>√úmumi Orta</th>
                                            <th>Davamsƒ±zlƒ±q</th>
                                            <th>Status</th>
                                            <th>∆èm…ôliyyat</th>
                                        </tr>
                                    </thead>
                                    <tbody id="students-table-body">
                                        <!-- Data will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Attendance Analysis Section -->
                <section id="attendance-section" class="content-section" style="display: none;">
                    <h2 class="mb-4"><i class="fas fa-calendar-alt me-2"></i>Davamsƒ±zlƒ±q Analizi</h2>

                    <div class="filter-section">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="attendance-class-filter" class="form-label">Sinif se√ßin:</label>
                                <select id="attendance-class-filter" class="form-select">
                                    <option value="all">Hamƒ±sƒ±</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="attendance-threshold" class="form-label">Davamsƒ±zlƒ±q h…ôddi:</label>
                                <select id="attendance-threshold" class="form-select">
                                    <option value="5">5+ g√ºn (Y√ºks…ôk)</option>
                                    <option value="10">10+ g√ºn (√áox y√ºks…ôk)</option>
                                    <option value="15">15+ g√ºn (T…ôhl√ºk…ôli)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Attendance Stats -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card text-center">
                                <div class="card-body">
                                    <i class="fas fa-user-check fa-2x text-success mb-3"></i>
                                    <h4 id="good-attendance-count">0</h4>
                                    <p class="text-muted">Yax≈üƒ± Davamsƒ±zlƒ±q (0-4 g√ºn)</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-center">
                                <div class="card-body">
                                    <i class="fas fa-user-clock fa-2x text-warning mb-3"></i>
                                    <h4 id="medium-attendance-count">0</h4>
                                    <p class="text-muted">Orta Davamsƒ±zlƒ±q (5-9 g√ºn)</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-center">
                                <div class="card-body">
                                    <i class="fas fa-user-times fa-2x text-danger mb-3"></i>
                                    <h4 id="high-attendance-count">0</h4>
                                    <p class="text-muted">Y√ºks…ôk Davamsƒ±zlƒ±q (10+ g√ºn)</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Class-based Attendance -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <i class="fas fa-chart-bar me-2"></i>Sinif Bazlƒ± Davamsƒ±zlƒ±q Ortalamasƒ±
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="classAttendanceChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Attendance List -->
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><i class="fas fa-list me-2"></i>Davamsƒ±zlƒ±q Siyahƒ±sƒ±</span>
                            <span id="attendance-count" class="badge bg-primary">0 ≈üagird</span>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table data-table table-hover mb-0" id="attendance-table">
                                    <thead>
                                        <tr>
                                            <th>≈ûagird</th>
                                            <th>Sinif</th>
                                            <th>Davamsƒ±zlƒ±q (g√ºn)</th>
                                            <th>√úmumi Orta</th>
                                            <th>Davamsƒ±zlƒ±q Statusu</th>
                                            <th>∆èks T…ôsir</th>
                                        </tr>
                                    </thead>
                                    <tbody id="attendance-table-body">
                                        <!-- Data will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Subjects Analysis Section -->
                <section id="subjects-section" class="content-section" style="display: none;">
                    <h2 class="mb-4"><i class="fas fa-book me-2"></i>F…ônn Analizi</h2>

                    <div class="filter-section">
                        <div class="row g-3">
                            <div class="col-md-5">
                                <label for="subject-detailed-filter" class="form-label fw-bold"><i
                                        class="fas fa-book-open me-1"></i>Analiz √º√ß√ºn f…ônn se√ßin:</label>
                                <select id="subject-detailed-filter" class="form-select border-primary shadow-sm">
                                    <option value="all">üìä B√ºt√ºn F…ônl…ôr (√úmumi ƒ∞cmal)</option>
                                    <!-- Options will be populated -->
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="subject-sort" class="form-label">Sƒ±ralama:</label>
                                <select id="subject-sort" class="form-select">
                                    <option value="average_desc">Ortalamaya g√∂r…ô (Azalan)</option>
                                    <option value="average_asc">Ortalamaya g√∂r…ô (Artan)</option>
                                    <option value="name">Ada g√∂r…ô</option>
                                </select>
                            </div>
                            <div class="col-md-3 d-flex align-items-end">
                                <div class="form-check form-switch w-100 p-3 border rounded bg-white shadow-sm">
                                    <input class="form-check-input" type="checkbox" id="subject-merge-toggle" checked>
                                    <label class="form-check-label fw-bold" for="subject-merge-toggle">Sinifl…ôri
                                        Birl…ô≈üdir</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Subject Stats Cards -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card text-center">
                                <div class="card-body">
                                    <i class="fas fa-star fa-2x text-warning mb-3"></i>
                                    <h4 id="best-subject">-</h4>
                                    <p class="text-muted">∆èn Y√ºks…ôk Ortalamalƒ± F…ônn</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-center">
                                <div class="card-body">
                                    <i class="fas fa-chart-line fa-2x text-primary mb-3"></i>
                                    <h4 id="subject-total-count">0</h4>
                                    <p class="text-muted">Analiz Edil…ôn F…ônn Sayƒ±</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-center">
                                <div class="card-body">
                                    <i class="fas fa-exclamation-triangle fa-2x text-danger mb-3"></i>
                                    <h4 id="worst-subject">-</h4>
                                    <p class="text-muted">∆èn A≈üaƒüƒ± Ortalamalƒ± F…ônn</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-chart-line me-2"></i>F…ônn Statistikalarƒ±
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table data-table table-hover" id="subjects-table">
                                    <thead>
                                        <tr>
                                            <th>F…ônn</th>
                                            <th>√úmumi Orta</th>
                                            <th>2-ci Sinif</th>
                                            <th>3-c√º Sinif</th>
                                            <th>4-c√º Sinif</th>
                                            <th>5-ci Sinif</th>
                                            <th>6-cƒ± Sinif</th>
                                            <th>7-ci Sinif</th>
                                            <th>8-ci Sinif</th>
                                            <th>9-cu Sinif</th>
                                            <th>Uƒüur Nisb…ôti</th>
                                        </tr>
                                    </thead>
                                    <tbody id="subjects-table-body">
                                        <tr>
                                            <td colspan="11" class="text-center text-muted">Y√ºkl…ônir...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Subject Correlation Chart -->
                    <div class="card mt-4">
                        <div class="card-header">
                            <i class="fas fa-chart-bar me-2"></i>F…ônn Ortalamalarƒ± Qrafiki
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="subjectComparisonChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Student Ranking for Subject (Initially Hidden) -->
                    <div id="subject-student-ranking-container" class="card mt-4" style="display: none;">
                        <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-2">
                            <span><i class="fas fa-list-ol me-2"></i>F…ônn √ºzr…ô ≈ûagird N…ôtic…ôl…ôri</span>
                            <div class="d-flex gap-2">
                                <select id="subject-student-sort-filter" class="form-select form-select-sm"
                                    style="min-width: 130px;">
                                    <option value="desc">√áoxdan aza</option>
                                    <option value="asc">Azdan √ßoxa</option>
                                </select>

                                <div class="dropdown">
                                    <button
                                        class="btn btn-sm btn-outline-secondary dropdown-toggle bg-white d-flex align-items-center justify-content-between"
                                        type="button" id="classFilterDropdownButton" data-bs-toggle="dropdown"
                                        data-bs-auto-close="outside" aria-expanded="false" style="min-width: 160px;">
                                        <span>B√ºt√ºn Sinifl…ôr</span>
                                    </button>
                                    <ul class="dropdown-menu p-2 shadow-sm" id="subject-student-class-dropdown"
                                        style="max-height: 300px; overflow-y: auto; width: 250px;">
                                        <!-- Content populated by JS -->
                                    </ul>
                                </div>

                                <button class="btn btn-sm btn-primary px-3" onclick="updateSubjectStudentRankings()">
                                    G√∂st…ôr
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle" id="subject-student-table">
                                    <thead class="table-light">
                                        <tr>
                                            <th>#</th>
                                            <th>≈ûagird</th>
                                            <th>Sinif</th>
                                            <th>Qiym…ôt</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="subject-student-table-body">
                                        <!-- Content populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Classes Analysis Section -->
                <section id="classes-section" class="content-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="mb-0"><i class="fas fa-chalkboard-teacher me-2"></i>Sinif Analizi</h2>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="merge-classes-toggle">
                            <label class="form-check-label" for="merge-classes-toggle">Paralel Sinifl…ôri
                                Birl…ô≈üdir</label>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-chart-bar me-2"></i>Sinif Ortalamalarƒ± v…ô Davamsƒ±zlƒ±q
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="classAvgChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="card h-100">
                                <div class="card-header">
                                    <i class="fas fa-trophy me-2"></i>∆èn Y√ºks…ôk Ortalamalƒ± 3 Sinif
                                </div>
                                <div class="card-body" id="top-classes-list">
                                    <p class="text-muted">Y√ºkl…ônir...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-table me-2"></i>Sinif M√ºqayis…ôsi
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table data-table table-hover" id="classes-table">
                                    <thead>
                                        <tr>
                                            <th>Sinif</th>
                                            <th>≈ûagird Sayƒ±</th>
                                            <th>√úmumi Orta</th>
                                            <th>Davamsƒ±zlƒ±q (orta)</th>
                                            <th>∆èn Yax≈üƒ± F…ônn</th>
                                            <th>∆èn A≈üaƒüƒ± F…ônn</th>
                                            <th>Uƒüurlu ≈ûagird (%)</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="classes-table-body">
                                        <tr>
                                            <td colspan="8" class="text-center text-muted">Y√ºkl…ônir...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Comparison Section -->
                <section id="comparison-section" class="content-section" style="display: none;">
                    <h2 class="mb-4"><i class="fas fa-balance-scale me-2"></i>M√ºqayis…ô Analizi</h2>

                    <div class="row mb-4">
                        <div class="col-lg-6 mb-3 mb-lg-0">
                            <div class="card h-100">
                                <div class="card-header">
                                    <i class="fas fa-chart-bar me-2"></i>Sinif S…ôviyy…ôsin…ô G√∂r…ô M√ºqayis…ô
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="gradeComparisonChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="card h-100">
                                <div class="card-header">
                                    <i class="fas fa-chart-line me-2"></i>Davamsƒ±zlƒ±q v…ô Ortalama ∆èlaq…ôsi
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="attendanceCorrelationChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center w-100">
                                <span><i class="fas fa-table me-2"></i>Detallƒ± M√ºqayis…ô</span>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="comparison-merge-toggle"
                                        checked>
                                    <label class="form-check-label" for="comparison-merge-toggle">Paralel Sinifl…ôri
                                        Birl…ô≈üdir</label>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table data-table table-hover" id="comparison-table">
                                    <thead>
                                        <tr>
                                            <th>G√∂st…ôrici</th>
                                            <th>2-ci Sinif</th>
                                            <th>3-c√º Sinif</th>
                                            <th>4-c√º Sinif</th>
                                            <th>5-ci Sinif</th>
                                            <th>6-cƒ± Sinif</th>
                                            <th>7-ci Sinif</th>
                                            <th>8-ci Sinif</th>
                                            <th>9-cu Sinif</th>
                                            <th>Qalib Sinif</th>
                                        </tr>
                                    </thead>
                                    <tbody id="comparison-table-body">
                                        <tr>
                                            <td colspan="10" class="text-center text-muted">Y√ºkl…ônir...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Hesabat Section -->
                <section id="export-section" class="content-section" style="display: none;">
                    <h2 class="section-title mb-4"><i class="fas fa-file-invoice me-2"></i>Hesabatlar v…ô Analiz</h2>

                    <div class="row">
                        <!-- Heatmap Section -->
                        <div class="col-12 mb-4">
                            <div class="card shadow-sm border-0">
                                <div
                                    class="card-header bg-primary text-white py-3 d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0"><i class="fas fa-th me-2"></i>M…ôkt…ôb Performans ƒ∞stilik X…ôrit…ôsi
                                        (Heatmap)</h5>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="heatmap-merge-toggle">
                                        <label class="form-check-label text-white"
                                            for="heatmap-merge-toggle">Paralellarƒ±
                                            Birl…ô≈üdir</label>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <p class="text-muted small mb-3">R…ôngl…ôr f…ônn v…ô sinif √ºzr…ô ortalama uƒüuru g√∂st…ôrir
                                        (Qƒ±rmƒ±zƒ±: &lt;31, Sarƒ±: 31-60, Mavi: 61-80, Ya≈üƒ±l: 81-90, T√ºnd Ya≈üƒ±l: &gt;90)
                                    </p>
                                    <div id="heatmap-container" class="table-responsive">
                                        <!-- Heatmap will be generated here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Correlation Analysis -->
                        <div class="col-12">
                            <div class="card shadow-sm border-0">
                                <div class="card-header bg-info text-white py-3">
                                    <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Davamsƒ±zlƒ±ƒüƒ±n N…ôtic…ôl…ôr…ô
                                        T…ôsiri Analizi</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row align-items-center">
                                        <div class="col-lg-7">
                                            <div class="chart-container" style="height: 380px;">
                                                <canvas id="impactAnalysisChart"></canvas>
                                            </div>
                                        </div>
                                        <div class="col-lg-5">
                                            <div id="correlation-insights" class="p-4 bg-light-custom rounded border">
                                                <h6 class="fw-bold mb-3 text-info"><i
                                                        class="fas fa-lightbulb me-2"></i>Aƒüƒ±llƒ± Analitik √áƒ±xarƒ±≈ülar
                                                </h6>
                                                <div id="insight-content">
                                                    Y√ºkl…ônir...
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Teachers Section -->
                <section id="teachers-section" class="content-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="mb-0"><i class="fas fa-chalkboard-teacher me-2"></i>M√º…ôlliml…ôr</h2>
                        <div class="d-flex gap-2">
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-search"></i></span>
                                <input type="text" id="teacher-search" class="form-control"
                                    placeholder="M√º…ôllim axtar...">
                            </div>
                        </div>
                    </div>

                    <div class="row" id="teachers-grid">
                        <!-- Teacher cards will be populated here -->
                    </div>

                    <!-- Teacher Detail View (Initially Hidden) -->
                    <div id="teacher-detail-view" style="display: none;">
                        <button class="btn btn-outline-secondary mb-3" onclick="showTeachersGrid()">
                            <i class="fas fa-arrow-left me-2"></i>Siyahƒ±ya Qayƒ±t
                        </button>
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h4 id="detail-teacher-name" class="mb-0">M√º…ôllim Adƒ±</h4>
                                <span class="badge bg-light text-primary" id="detail-teacher-subject">-</span>
                            </div>
                            <div class="card-body">
                                <div class="row mb-4">
                                    <div class="col-md-3">
                                        <div class="stat-card blue">
                                            <i class="fas fa-users"></i>
                                            <h3 id="teacher-student-count">0</h3>
                                            <p>√úmumi ≈ûagird</p>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-card green">
                                            <i class="fas fa-star"></i>
                                            <h3 id="teacher-performance-avg">0.0</h3>
                                            <p>Performans Ortalamasƒ±</p>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-card orange">
                                            <i class="fas fa-chalkboard"></i>
                                            <h3 id="teacher-class-count">0</h3>
                                            <p>D…ôrs Ke√ßdiyi Sinif</p>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-card red">
                                            <i class="fas fa-exclamation-circle"></i>
                                            <h3 id="teacher-warning-count">0</h3>
                                            <p>Diqq…ôt Yetirilm…ôli</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="card">
                                            <div class="card-header bg-secondary bg-opacity-10 text-dark">
                                                <i class="fas fa-list me-2"></i>Sinifl…ôr √ºzr…ô Ortalama
                                            </div>
                                            <div class="card-body">
                                                <div class="chart-container" style="height: 250px;">
                                                    <canvas id="teacherClassChart"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="card">
                                            <div class="card-header bg-secondary bg-opacity-10 text-dark">
                                                <i class="fas fa-user-graduate me-2"></i>≈ûagird Paylanmasƒ±
                                            </div>
                                            <div class="card-body">
                                                <div class="chart-container" style="height: 250px;">
                                                    <canvas id="teacherDistributionChart"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <!-- New Row for Subject Averages -->
                        <div class="row mt-4 mb-4">
                            <div class="col-12">
                                <div class="card bg-light bg-opacity-50">
                                    <div class="card-header bg-secondary bg-opacity-10 text-dark py-2">
                                        <i class="fas fa-book-open me-2"></i>F…ônl…ôr √ºzr…ô Ortalama
                                    </div>
                                    <div class="card-body py-3">
                                        <div id="teacher-subject-averages" class="row g-3">
                                            <!-- Subject averages will be populated here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card mt-4">
                            <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-3">
                                <span><i class="fas fa-users me-2"></i>≈ûagird Siyahƒ±sƒ±</span>
                                <div class="d-flex gap-2 align-items-center">
                                    <select id="teacher-student-class-filter" class="form-select form-select-sm"
                                        style="width: auto;" onchange="filterTeacherStudents()">
                                        <option value="all">B√ºt√ºn Sinifl…ôr</option>
                                    </select>
                                    <select id="teacher-student-subject-filter" class="form-select form-select-sm"
                                        style="width: auto;" onchange="filterTeacherStudents()">
                                        <option value="all">B√ºt√ºn F…ônl…ôr</option>
                                    </select>
                                    <select id="teacher-student-sort" class="form-select form-select-sm"
                                        style="width: auto;" onchange="filterTeacherStudents()">
                                        <option value="desc">√áoxdan aza (Qiym…ôt)</option>
                                        <option value="asc">Azdan √ßoxa (Qiym…ôt)</option>
                                    </select>
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-light" onclick="exportTeacherStudents()">Excel</button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead>
                                            <tr>
                                                <th>≈ûagird</th>
                                                <th>Sinif</th>
                                                <th>F…ônn</th>
                                                <th>Qiym…ôt</th>
                                                <th>Status</th>
                                                <th>∆èks T…ôsir</th>
                                            </tr>
                                        </thead>
                                        <tbody id="teacher-students-table-body"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
            </div>
        </div>
        </section>

        <!-- AI Assistant UI -->
        <div class="ai-chat-btn" id="ai-chat-toggle" title="IMSA S√ºni Z…ôka Assistenti">
            <i class="fas fa-robot"></i>
        </div>

        <div class="ai-chat-window" id="ai-chat-window">
            <div class="ai-chat-header">
                <div class="d-flex align-items-center">
                    <i class="fas fa-robot me-2 fs-4"></i>
                    <div>
                        <div class="fw-bold">IMSA - N…ôsimi kampusu</div>
                        <div class="small opacity-75">Sizin m…ôlumat analiz√ßiniz</div>
                    </div>
                </div>
                <button class="btn btn-sm text-white" onclick="toggleAIChat()"><i class="fas fa-times"></i></button>
            </div>
            <div class="ai-chat-messages" id="ai-chat-messages">
                <div class="ai-message assistant">
                    Salam! M…ôn IMSA m…ôkt…ôb m…ôlumatlarƒ±nƒ± analiz ed…ôn s√ºni z…ôka asistentiy…ôm. Sizin √º√ß√ºn hansƒ±
                    ≈üagirdi v…ô ya sinfi analiz edim?
                    <div class="ai-suggestion-chips">
                        <div class="suggestion-chip" onclick="sendAlSuggestion('√úmumi m…ôkt…ôb v…ôziyy…ôti nec…ôdir?')">
                            üìä √úmumi V…ôziyy…ôt
                        </div>
                        <div class="suggestion-chip" onclick="sendAlSuggestion('B√ºt√ºn f…ônl…ôr √ºzr…ô liderl…ôr kimdir?')">üìö
                            F…ônn Liderl…ôri
                        </div>
                        <div class="suggestion-chip" onclick="sendAlSuggestion('M√ºk…ômm…ôl davamiyy…ôti (0 g√ºn) olanlar')">
                            üèÜ M√ºk…ômm…ôl
                            Davamiyy…ôt</div>
                        <div class="suggestion-chip" onclick="sendAlSuggestion('∆èla√ßƒ±larƒ±n siyahƒ±sƒ±')">üåü
                            ∆èla√ßƒ±larƒ±n Siyahƒ±sƒ±</div>
                        <div class="suggestion-chip"
                            onclick="sendAlSuggestion('Hansƒ± sinfin ortalamasƒ± …ôn y√ºks…ôkdir?')">üè´ ∆èn Yax≈üƒ±
                            Sinif</div>
                        <div class="suggestion-chip"
                            onclick="sendAlSuggestion('Kritik davamsƒ±zlƒ±qda …ôn √ßox olan u≈üaqlar')">üö© Kritik
                            Davamsƒ±zlƒ±q</div>
                    </div>
                </div>
            </div>
            <div class="ai-chat-input-area">
                <input type="text" class="ai-chat-input" id="ai-input" placeholder="Sualƒ±nƒ±zƒ± yazƒ±n..."
                    onkeypress="if(event.key === 'Enter') handleAISend()">
                <button class="btn text-white rounded-circle ms-2 me-2" style="background-color: #00adba;"
                    onclick="handleAISend()"><i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
    </div>
    </div>
    </div>

    <!-- Global Search Modal -->
    <div class="search-modal-overlay" id="searchOverlay" onclick="closeSearch(event)">
        <div class="search-container" onclick="event.stopPropagation()">
            <input type="text" id="global-search-input" placeholder="≈ûagird, sinif v…ô ya f…ônn axtarƒ±n..."
                autocomplete="off">
            <div class="search-results" id="search-results">
                <div class="p-4 text-center text-muted">Axtarƒ±≈üa ba≈ülamaq √º√ß√ºn bir ≈üey yazƒ±n...</div>
            </div>
            <div class="p-2 border-top bg-light-custom d-flex justify-content-between align-items-center px-3">
                <small class="text-muted">Naviqasiya: <kbd>‚Üë‚Üì</kbd> Se√ßim: <kbd>Enter</kbd></small>
                <small class="text-muted">Baƒüla: <kbd>ESC</kbd></small>
            </div>
        </div>
    </div>

    <!-- Modal for Student Details -->
    <div class="modal fade" id="studentModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="studentModalTitle">≈ûagird Detallarƒ±</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="studentModalBody">
                        <!-- Student basic info will be loaded here -->
                    </div>
                    <div class="row mt-4">
                        <div class="col-12">
                            <h5 class="mb-3 text-center"><i class="fas fa-chart-pie me-2"></i>F…ônn Analizi (Radar
                                Qrafiki)</h5>
                            <div style="height: 350px; position: relative;">
                                <canvas id="studentRadarChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Baƒüla</button>
                    <button type="button" class="btn btn-primary" onclick="printStudentReport()">
                        <i class="fas fa-print me-2"></i>√áap et
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Bottom Navigation (Hidden - using top grid instead) -->
    <div class="d-none" id="mobile-nav">
        <div class="mobile-compact-nav">
            <button class="mobile-nav-btn active" data-section="dashboard">
                <i class="fas fa-tachometer-alt"></i>
                <span>√úmumi</span>
            </button>
            <button class="mobile-nav-btn" data-section="students">
                <i class="fas fa-users"></i>
                <span>≈ûagird</span>
            </button>
            <button class="mobile-nav-btn" data-section="attendance">
                <i class="fas fa-calendar-alt"></i>
                <span>Davam</span>
            </button>
            <button class="mobile-nav-btn" data-section="subjects">
                <i class="fas fa-book"></i>
                <span>F…ônn</span>
            </button>
            <button class="mobile-nav-btn" data-section="classes">
                <i class="fas fa-chalkboard"></i>
                <span>Sinif</span>
            </button>
            <button class="mobile-nav-btn" data-section="comparison">
                <i class="fas fa-chart-bar"></i>
                <span>M√ºqayis…ô</span>
            </button>
            <button class="mobile-nav-btn" data-section="export">
                <i class="fas fa-file"></i>
                <span>Hesabat</span>
            </button>
        </div>
    </div>

    <script>
        // =============================================
        // G√ñM√úL√ú EXCEL VERƒ∞LERƒ∞
        // =============================================
        const embeddedExcelData = {
            // 2-4. sƒ±nƒ±flar
            '2-4': [
                ["≈ûagird", "Sinif", "Davamsƒ±zlƒ±q sayƒ±", "Az…ôrbaycan dili", "Riyaziyyat", "H…ôyat bilgisi", "ƒ∞ngilis dili", "Rus dili", "T√ºrk dili", "ƒ∞nformatika", "Texnologiya", "Musiqi", "T…ôsviri ƒ∞nc…ôs…ôn…ôt", "Fiziki t…ôrbiy…ô"],
                ["Aƒüazad…ô ƒ∞brahim", "2.A", 9, 65, 61, 72, 24, 51, 78, 81, 88, 63, 100, 88],
                ["Aslanlƒ± M…ôdin…ô", "2.A", 5, 88, 84, 80, 73, 87, 84, 82, 89, 97, 92, 87],
                ["Aslanlƒ± M…ôry…ôm", "2.A", 2, 89, 94, 70, 86, 95, 93, 86, 91, 97, 92, 89],
                ["Aslanlƒ± Murad", "2.A", 4, 82, 94, 77, 88, 89, 96, 90, 89, 92, 97, 91],
                ["Baxƒ±≈üov K…ônan", "2.A", 10, 55, 79, 85, 27, 35, 63, 81, 65, 82, 88, 89],
                ["∆èmirli ƒ∞brahim", "2.A", 3, 92, 94, 85, 80, 81, 86, 84, 88, 62, 87, 85],
                ["∆ès…ôdli ƒ∞del", "2.A", 1, 98, 94, 90, 80, 95, 92, 95, 99, 100, 100, 89],
                ["Hacƒ±yev Yusub", "2.A", 2, 94, 92, 90, 59, 92, 93, 90, 96, 80, 92, 91],
                ["ƒ∞sk…ônd…ôrzad…ô Rafiq", "2.A", 6, 77, 86, 77, 79, 68, 80, 86, 81, 97, 90, 89],
                ["Qafarzad…ô H√ºseyn", "2.A", 2, 96, 92, 86, 72, 81, 95, 95, 97, 78, 100, 90],
                ["M√∂ns√ºm Yunus", "2.A", 8, 80, 90, 89, 63, 67, 86, 78, 95, 78, 95, 86],
                ["Muradov Tuncay", "2.A", 4, 93, 94, 88, 80, 83, 87, 90, 95, 78, 100, 89],
                ["Nizamova ƒ∞nci", "2.A", 2, 97, 67, 79, 53, 81, 83, 84, 87, 93, 92, 88],
                ["R…ôsulov Rauf", "2.A", 5, 93, 97, 87, 84, 82, 94, 91, 88, 78, 97, 90],
                ["V…ôlizad…ô G√ºlnar…ô", "2.A", 10, 95, 97, 89, 62, 92, 92, 89, 93, 97, 93, 89],
                ["Z√ºlf√ºqarlƒ± M…ôdin…ô", "2.A", 2, 80, 77, 74, 63, 91, 85, 80, 91, 97, 100, 89],
                ["Babayev Uƒüur", "2.B", 15, 95, 97, 87, 96, 84, 84, 89, 95, 82, 83, 92],
                ["∆èliyeva Miray", "2.B", 10, 93, 91, 85, 95, 90, 87, 83, 98, 85, 100, 94],
                ["∆ès…ôdullayeva Z…ôhra", "2.B", 5, 90, 89, 87, 77, 74, 91, 87, 100, 82, 82, 91],
                ["G√∂y√º≈üzad…ô Ahu", "2.B", 9, 31, 34, 40, 12, 39, 52, 66, 55, 67, 100, 84],
                ["H…ôs…ônli R…ôc…ôb", "2.B", 4, 60, 55, 52, 42, 60, 63, 70, 70, 67, 80, 82],
                ["H…ôs…ônzad…ô Hiranur", "2.B", 4, 80, 86, 89, 78, 85, 87, 91, 93, 93, 100, 90],
                ["H√ºseynov ƒ∞brahim", "2.B", 1, 91, 98, 90, 74, 73, 94, 89, 95, 93, 82, 97],
                ["ƒ∞brahimli Mikayƒ±l", "2.B", 4, 87, 90, 86, 95, 98, 85, 88, 98, 80, 90, 93],
                ["Quliyeva S…ôma", "2.B", 16, 88, 81, 94, 98, 84, 85, 79, 92, 90, 87, 89],
                ["M…ômm…ôdova M…ôdin…ô", "2.B", 5, 62, 64, 91, 77, 80, 86, 77, 94, 82, 90, 85],
                ["M…ômm…ôdzad…ô S√ºleyman", "2.B", 6, 100, 97, 92, 100, 82, 92, 91, 97, 79, 83, 88],
                ["Muxtarlƒ± Sevinc", "2.B", 14, 88, 87, 85, 93, 87, 99, 90, 93, 87, 100, 90],
                ["Musayev El≈ü…ôn", "2.B", 0, 94, 98, 82, 75, 78, 91, 95, 98, 77, 100, 92],
                ["M√ºsl√ºm Zeyn…ôb", "2.B", 1, 92, 85, 96, 84, 81, 89, 90, 98, 82, 100, 90],
                ["N…ôsirova Aylin", "2.B", 4, 94, 75, 85, 85, 81, 83, 86, 97, 98, 82, 89],
                ["Nuriyev Atilla", "2.B", 5, 88, 97, 96, 95, 90, 78, 93, 98, 90, 82, 90],
                ["S…ôbizova Mehpar…ô", "2.B", 2, 98, 100, 92, 92, 90, 88, 89, 98, 74, 92, 89],
                ["Allahverdi ƒ∞smail", "3.A", 9, 84, 80, 88, 43, 58, 87, 74, 84, 80, 73, 84],
                ["C…ôf…ôrzad…ô Suada", "3.A", 6, 96, 89, 95, 61, 93, 92, 87, 93, 85, 78, 85],
                ["Xanki≈üiyev Fateh", "3.A", 2, 87, 64, 79, 81, 61, 81, 79, 78, 67, 77, 82],
                ["ƒ∞manlƒ± ∆èli", "3.A", 2, 93, 89, 87, 53, 77, 87, 81, 95, 82, 78, 86],
                ["ƒ∞smayƒ±lova Ai≈ü…ô", "3.A", 1, 80, 47, 64, 20, 53, 63, 75, 70, 55, 77, 81],
                ["Qarayeva Z…ôhra", "3.A", 3, 51, 78, 74, 31, 93, 78, 73, 76, 50, 80, 83],
                ["M…ômm…ôdli C…ôlal", "3.A", 3, 96, 93, 92, 84, 82, 87, 81, 93, 87, 97, 89],
                ["M…ômm…ôdzad…ô ∆èslinur", "3.A", 10, 89, 96, 88, 47, 79, 94, 91, 90, 87, 87, 94],
                ["M…ômm…ôdzad…ô Mahinur", "3.A", 6, 69, 44, 82, 44, 76, 86, 73, 70, 77, 80, 84],
                ["Muradlƒ± √ñm…ôr", "3.A", 0, 87, 96, 81, 67, 76, 74, 79, 79, 55, 73, 97],
                ["Musayev C…ôsur", "3.A", 0, 89, 91, 79, 33, 72, 75, 87, 88, 69, 75, 98],
                ["Novruzlu X…ôdic…ô", "3.A", 2, 84, 87, 81, 68, 79, 77, 81, 81, 65, 90, 83],
                ["R…ôhimli R√ºst…ôm", "3.A", 0, 96, 96, 88, 83, 96, 90, 88, 92, 98, 93, 84],
                ["S…ôrdar Mehdi", "3.A", 10, 49, 36, 56, 39, 94, 59, 70, 74, 52, 62, 85],
                ["∆èliyeva ƒ∞nci", "3.A", 8, 91, 89, 95, 73, 89, 85, 90, 80, 95, 100, 90],
                ["∆èliyeva ≈û…ôms", "3.B", 7, 76, 76, 88, 60, 83, 83, 84, 75, 77, 95, 88],
                ["∆èlizad…ô H√ºmeyra", "3.B", 13, 78, 78, 85, 59, 62, 87, 84, 73, 87, 87, 89],
                ["∆èmirov Ali", "3.B", 14, 71, 96, 86, 53, 35, 86, 82, 70, 62, 80, 86],
                ["H√ºseynzad…ô Enes", "3.B", 4, 89, 93, 97, 89, 91, 84, 91, 85, 80, 90, 89],
                ["Karau√ßoƒülu Alparslan", "3.B", 11, 40, 51, 55, 82, 98, 88, 81, 70, 52, 83, 83],
                ["Kayƒ±k√ßƒ±oƒülu √ñm…ôr Aras", "3.B", 19, 71, 73, 75, 75, 67, 78, 82, 74, 72, 93, 84],
                ["Kazƒ±m M…ôtin", "3.B", 5, 76, 87, 89, 45, 72, 84, 85, 78, 65, 93, 86],
                ["Qayƒ±blƒ± Altay", "3.B", 6, 93, 91, 83, 75, 86, 90, 85, 86, 87, 97, 98],
                ["M…ômm…ôdzad…ô ∆èhm…ôd", "3.B", 9, 93, 100, 93, 87, 81, 85, 80, 89, 92, 97, 93],
                ["Musavi H…ôs…ôn", "3.B", 2, 73, 87, 82, 72, 95, 90, 85, 75, 80, 80, 94],
                ["S…ôf…ôrli Onur", "3.B", 4, 67, 69, 66, 68, 97, 82, 78, 60, 70, 73, 89],
                ["V…ôli D…ôfn…ô", "3.B", 8, 93, 89, 90, 90, 90, 84, 87, 89, 90, 93, 91],
                ["Bekta≈üoƒülu Zelihanur", "4.A", 7, 72, 59, 89, 60, 64, 93, 87, 92, 80, 93, 90],
                ["∆èliyeva N…ôzak…ôt", "4.A", 3, 88, 74, 85, 55, 45, 87, 85, 96, 74, 89, 84],
                ["∆ès…ôdli Zeyn…ôb", "4.A", 2, 99, 90, 95, 65, 89, 94, 88, 99, 73, 93, 99],
                ["H√ºseynzad…ô Melissa", "4.A", 5, 93, 82, 92, 89, 88, 100, 93, 99, 100, 96, 91],
                ["Xanki≈üiyeva ƒ∞layda", "4.A", 2, 82, 65, 82, 78, 62, 87, 83, 98, 88, 100, 85],
                ["ƒ∞brahimov Ziya", "4.A", 2, 85, 92, 87, 76, 91, 81, 82, 98, 88, 84, 89],
                ["Quluzad…ô Murad", "4.A", 2, 70, 76, 77, 67, 90, 74, 86, 97, 63, 89, 87],
                ["M…ômm…ôdova Aylin", "4.A", 6, 84, 74, 89, 69, 91, 98, 86, 98, 92, 90, 89],
                ["Musavi N√ºman", "4.A", 3, 87, 86, 94, 68, 85, 86, 87, 92, 58, 91, 90],
                ["Musayev Adil", "4.A", 0, 97, 98, 93, 55, 87, 88, 83, 98, 92, 94, 90],
                ["Musa-zad…ô Ayxan", "4.A", 6, 82, 69, 93, 45, 47, 85, 80, 97, 73, 86, 95],
                ["V…ôlizad…ô ƒ∞smayƒ±l", "4.A", 6, 86, 72, 85, 50, 67, 76, 75, 97, 90, 82, 95],
                ["Aƒüayeva Fidan", "4.B", 3, 72, 43, 79, 46, 94, 73, 74, 94, 77, 82, 81],
                ["Bayramov Uƒüur", "4.B", 1, 66, 54, 86, 69, 73, 84, 79, 83, 81, 93, 84],
                ["G√∂y√º≈üzad…ô Ayan", "4.B", 21, 59, 25, 76, 25, 23, 65, 65, 94, 40, 71, 81],
                ["ƒ∞brahimova ƒ∞p…ôk", "4.B", 9, 78, 73, 91, 45, 71, 94, 81, 97, 78, 87, 83],
                ["Q…ômb…ôrli Z…ôhra", "4.B", 2, 85, 71, 86, 69, 83, 95, 85, 93, 88, 89, 86],
                ["Mehdizad…ô Aysel", "4.B", 7, 87, 78, 97, 75, 87, 99, 82, 86, 99, 91, 87],
                ["M…ômm…ôdli Emil", "4.B", 3, 77, 40, 84, 34, 45, 82, 75, 95, 56, 90, 86],
                ["Musayev Fateh", "4.B", 0, 90, 79, 92, 43, 70, 79, 91, 99, 85, 92, 90],
                ["N…ôsirov Nihad", "4.B", 5, 84, 78, 88, 69, 70, 88, 84, 93, 64, 89, 82],
                ["Z√ºlf√ºqarlƒ± Hicran", "4.B", 1, 80, 53, 91, 50, 85, 85, 79, 89, 73, 88, 87]
            ],
            // 5. sƒ±nƒ±f
            '5': [
                ["≈ûagird", "Sinif", "Davamsƒ±zlƒ±q sayƒ±", "Az…ôrbaycan dili", "∆èd…ôbiyyat", "Riyaziyyat", "ƒ∞ngilis dili", "Rus dili", "T√ºrk dili", "ƒ∞nformatika", "Texnologiya", "T…ôbi…ôt", "Az…ôrbaycan Tarixi", "Musiqi", "T…ôsviri ƒ∞nc…ôs…ôn…ôt", "Fiziki t…ôrbiy…ô"],
                ["Aƒüazad…ô Z…ôhra", "5A", 3, 47, 73, 31, 39, 38, 82, 81, 85, 53, 40, 69, 73, 94],
                ["Baxƒ±≈ülƒ± Suada", "5A", 9, 73, 87, 64, 82, 84, 88, 83, 88, 77, 63, 88, 78, 93],
                ["√áokal Elif Ece", "5A", 9, 68, 93, 80, 87, 38, 99, 92, 93, 83, 70, 93, 93, 90],
                ["∆èbd√ºlsalamova M√ºjgan", "5A", 5, 74, 87, 31, 68, 66, 90, 80, 84, 53, 37, 77, 88, 86],
                ["∆èliyeva Banu", "5A", 6, 83, 93, 87, 88, 87, 86, 90, 90, 87, 57, 85, 89, 91],
                ["ƒ∞mamzad…ô X…ôdic…ô", "5A", 0, 84, 87, 76, 77, 73, 82, 91, 91, 93, 70, 94, 90, 97],
                ["ƒ∞smayƒ±lov √áingiz", "5A", 7, 74, 93, 96, 84, 86, 82, 95, 95, 93, 80, 94, 92, 94],
                ["Karata≈ü Elif Nur", "5A", 1, 56, 93, 59, 78, 68, 85, 91, 92, 83, 60, 86, 92, 94],
                ["Qasƒ±mova Aylin", "5A", 3, 84, 100, 70, 88, 75, 90, 95, 94, 100, 87, 100, 90, 89],
                ["Mehdizad…ô Fidan", "5A", 6, 53, 67, 42, 55, 78, 81, 81, 83, 50, 50, 65, 73, 88],
                ["M…ômm…ôdova G√ºlay", "5A", 15, 79, 73, 18, 42, 52, 79, 75, 82, 60, 30, 58, 75, 86],
                ["M…ôsimli Zeyn…ôb", "5A", 2, 83, 67, 66, 64, 68, 89, 92, 93, 97, 67, 82, 90, 94],
                ["Musayev Fateh", "5A", 2, 79, 93, 83, 81, 67, 86, 93, 96, 80, 70, 84, 85, 90],
                ["M√ºsl√ºm M…ôry…ôm", "5A", 1, 83, 87, 91, 86, 81, 98, 94, 94, 97, 83, 92, 98, 92],
                ["Novruzlu Kadir", "5A", 3, 82, 100, 90, 87, 51, 96, 94, 94, 83, 50, 89, 82, 84],
                ["R…ôsulov Camal", "5A", 6, 70, 73, 77, 80, 66, 86, 90, 90, 80, 63, 74, 82, 90],
                ["Sadmaliyeva Sara", "5A", 2, 73, 93, 53, 88, 93, 83, 84, 85, 73, 67, 84, 79, 91],
                ["Salmanov √ñm…ôr", "5A", 5, 80, 93, 93, 80, 73, 88, 92, 92, 90, 87, 93, 87, 83],
                ["Z…ôbiyeva Niluf…ôr", "5A", 4, 77, 93, 92, 69, 49, 87, 85, 85, 83, 67, 79, 72, 83],
                ["Aƒüayev √ñm…ôr", "5B", 6, 48, 40, 18, 71, 74, 46, 79, 82, 43, 37, 51, 58, 96],
                ["∆èhm…ôdli R…ô≈üid", "5B", 3, 94, 93, 97, 46, 48, 86, 94, 95, 97, 67, 64, 92, 97],
                ["∆èhm…ôdov Nazim", "5B", 7, 82, 80, 84, 66, 65, 95, 91, 92, 90, 70, 92, 72, 98],
                ["∆èlizad…ô Amal", "5B", 12, 34, 33, 27, 46, 84, 63, 84, 84, 60, 33, 66, 60, 97],
                ["H√ºseynli ≈û…ôbn…ôm", "5B", 9, 41, 53, 23, 22, 30, 67, 76, 82, 33, 13, 56, 70, 86],
                ["H√ºseynli Zeyn…ôb", "5B", 4, 82, 67, 74, 87, 69, 93, 84, 84, 77, 63, 63, 80, 98],
                ["I≈üƒ±lak Esmanur", "5B", 10, 64, 60, 31, 52, 43, 75, 90, 87, 77, 33, 71, 63, 88],
                ["ƒ∞sg…ônd…ôrli ƒ∞layda", "5B", 4, 83, 100, 85, 82, 64, 93, 85, 85, 97, 60, 93, 73, 91],
                ["ƒ∞smayƒ±lov M…ôhy…ôddin", "5B", 3, 76, 100, 77, 84, 68, 100, 84, 90, 93, 90, 80, 87, 96],
                ["M…ômm…ôdli Aida", "5B", 2, 72, 93, 73, 90, 95, 94, 88, 89, 93, 63, 83, 75, 94],
                ["M…ômm…ôdova M…ôry…ôm", "5B", 5, 67, 80, 73, 94, 86, 91, 90, 89, 87, 93, 91, 72, 92],
                ["M…ômm…ôdzad…ô Amin…ô", "5B", 3, 75, 93, 77, 82, 73, 92, 91, 92, 97, 70, 93, 95, 90],
                ["Namazlƒ± Z…ôhra", "5B", 19, 34, 20, 36, 19, 32, 54, 72, 75, 43, 37, 57, 60, 87],
                ["Osmanlƒ± ƒ∞nci", "5B", 0, 77, 93, 84, 86, 90, 86, 85, 84, 90, 67, 79, 73, 92],
                ["Pa≈üa Mahmud", "5B", 7, 91, 93, 88, 71, 61, 93, 94, 94, 93, 87, 86, 87, 90],
                ["Rayi M…ôry…ôm Niluf…ôr", "5B", 3, 36, 60, 18, 25, 43, 75, 82, 86, 30, 30, 74, 70, 86],
                ["Surxayzad…ô X…ôdic…ô", "5B", 9, 73, 73, 49, 35, 35, 91, 79, 85, 87, 67, 83, 82, 93],
                ["Yunus ƒ∞nci", "5B", 0, 65, 47, 40, 81, 94, 75, 87, 88, 73, 33, 93, 73, 94]
            ],
            // 6. sƒ±nƒ±f
            '6': [
                ["≈ûagird", "Sinif", "Davamsƒ±zlƒ±q sayƒ±", "Az…ôrbaycan dili", "∆èd…ôbiyyat", "Riyaziyyat", "ƒ∞ngilis dili", "Rus dili", "T√ºrk dili", "ƒ∞nformatika", "Texnologiya", "T…ôbi…ôt", "Az…ôrbaycan Tarixi", "Tarix", "Coƒürafiya", "Musiqi", "T…ôsviri ƒ∞nc…ôs…ôn…ôt", "Fiziki t…ôrbiy…ô"],
                ["Calalova M…ôry…ôm", "6A", 6, 58, 67, 39, 42, 54, 58, 89, 86, 50, 47, 47, 43, 80, 60, 89],
                ["C…ôf…ôrzad…ô Atilla", "6A", 8, 79, 100, 63, 75, 65, 83, 88, 87, 90, 63, 87, 80, 90, 65, 87],
                ["∆èhm…ôdli M…ôry…ôm", "6A", 1, 72, 87, 38, 97, 68, 88, 82, 86, 73, 43, 53, 63, 83, 98, 93],
                ["∆èlizad…ô Aylin", "6A", 9, 71, 73, 28, 75, 97, 85, 90, 89, 57, 50, 73, 67, 91, 72, 93],
                ["ƒ∞mamzad…ô Fatim…ô", "6A", 0, 63, 93, 31, 51, 46, 87, 88, 87, 67, 43, 60, 80, 81, 80, 93],
                ["ƒ∞smayƒ±llƒ± Xalid", "6A", 5, 53, 73, 25, 46, 31, 63, 78, 83, 43, 47, 33, 63, 67, 59, 89],
                ["Kazƒ±mlƒ± Ceyla", "6A", 1, 90, 93, 92, 69, 63, 86, 86, 87, 87, 73, 87, 90, 82, 73, 88],
                ["Q…ônb…ôrli Turqut", "6A", 5, 81, 93, 75, 93, 66, 88, 97, 95, 97, 70, 100, 83, 88, 78, 88],
                ["Manaflƒ± Murad", "6A", 5, 86, 100, 54, 78, 65, 86, 89, 87, 80, 60, 67, 90, 80, 57, 92],
                ["M…ômm…ôdli F…ôrhad", "6A", 3, 78, 60, 54, 71, 82, 64, 87, 88, 60, 33, 73, 43, 73, 57, 83],
                ["M…ômm…ôdli H√ºseyn", "6A", 4, 50, 73, 28, 67, 39, 75, 89, 85, 50, 53, 40, 77, 77, 57, 92],
                ["Muradova Selcan", "6A", 1, 89, 93, 69, 99, 69, 90, 93, 90, 90, 70, 73, 80, 83, 93, 88],
                ["Naƒüƒ±yev S…ôyyad", "6A", 2, 73, 87, 78, 84, 58, 78, 94, 94, 93, 77, 93, 87, 75, 78, 86],
                ["Osmanova M…ôry…ôm", "6A", 3, 94, 100, 88, 89, 62, 93, 95, 95, 93, 80, 100, 93, 92, 85, 89],
                ["S…ôrdarlƒ± X…ôdic…ô", "6A", 9, 27, 0, 13, 18, 31, 60, 75, 81, 27, 30, 27, 20, 57, 60, 85],
                ["Sultanov Fateh", "6A", 4, 58, 33, 50, 48, 97, 70, 84, 86, 70, 37, 13, 77, 83, 58, 91],
                ["T…ôhm…ôzli Mete", "6A", 0, 65, 87, 59, 48, 48, 80, 90, 90, 50, 50, 67, 70, 77, 75, 92],
                ["V…ôliyeva Z…ôhra", "6A", 5, 67, 87, 54, 68, 43, 79, 78, 84, 37, 37, 60, 63, 81, 85, 87],
                ["Alqayeva Kamil…ô", "6B", 2, 77, 73, 71, 66, 58, 85, 84, 83, 83, 47, 73, 67, 83, 92, 91],
                ["Eyvazova M…ôry…ôm", "6B", 2, 88, 93, 54, 79, 95, 74, 79, 84, 67, 50, 40, 67, 93, 87, 95],
                ["∆èhm…ôdov Az…ôr", "6B", 12, 28, 33, 36, 29, 27, 69, 82, 84, 30, 23, 47, 30, 62, 66, 79],
                ["∆èlirzayev H…ôs…ôn", "6B", 4, 74, 87, 55, 71, 81, 84, 94, 94, 80, 60, 53, 67, 87, 90, 82],
                ["∆èsg…ôrova Aylin", "6B", 0, 99, 100, 97, 86, 81, 94, 85, 85, 93, 70, 100, 83, 95, 95, 97],
                ["H…ô≈üimli Zeyn…ôb", "6B", 7, 67, 87, 44, 54, 57, 79, 89, 90, 73, 60, 33, 57, 87, 75, 83],
                ["H√ºseynli Mustafa", "6B", 3, 85, 100, 72, 80, 74, 85, 93, 93, 100, 83, 80, 97, 97, 97, 88],
                ["H√ºseynli Z…ôhra", "6B", 0, 96, 100, 93, 95, 84, 93, 92, 91, 97, 97, 100, 100, 100, 100, 93],
                ["ƒ∞smayƒ±l Ayxan", "6B", 3, 64, 100, 59, 82, 75, 69, 90, 90, 90, 67, 53, 77, 69, 83, 76],
                ["ƒ∞smayƒ±lzad…ô Mikayƒ±l", "6B", 6, 46, 47, 61, 85, 84, 62, 86, 88, 73, 37, 13, 47, 75, 67, 77],
                ["Mahmudlu Altay", "6B", 2, 95, 100, 96, 94, 77, 90, 96, 96, 100, 97, 100, 93, 80, 95, 82],
                ["Mahmudova Z√ºmr√ºd", "6B", 0, 96, 100, 93, 99, 82, 95, 94, 95, 97, 90, 87, 97, 100, 93, 90],
                ["M…ômm…ôdli Aƒüa", "6B", 5, 29, 47, 23, 19, 27, 57, 78, 83, 43, 37, 27, 33, 55, 65, 70],
                ["M…ômm…ôdova L…ôman", "6B", 2, 99, 100, 97, 94, 95, 97, 97, 96, 97, 90, 100, 97, 100, 93, 92],
                ["Mustafa Muhammed", "6B", 17, 60, 73, 37, 35, 35, 82, 78, 86, 53, 40, 33, 53, 75, 77, 83],
                ["Namazlƒ± Banu", "6B", 11, 78, 100, 42, 72, 63, 91, 88, 87, 73, 67, 80, 73, 85, 87, 83],
                ["Pa≈üazad…ô X…ôdic…ô", "6B", 4, 50, 93, 47, 49, 51, 76, 86, 86, 70, 43, 33, 70, 83, 98, 90],
                ["≈ûahm…ôrdanov Ramal", "6B", 1, 66, 93, 35, 41, 62, 78, 90, 89, 63, 47, 67, 73, 80, 67, 83]
            ],
            // 7-8. sƒ±nƒ±flar
            '7-8': [
                ["≈ûagird", "Sinif", "Davamsƒ±zlƒ±q sayƒ±", "Az…ôrbaycan dili", "∆èd…ôbiyyat", "Riyaziyyat", "ƒ∞ngilis dili", "Rus dili", "T√ºrk dili", "ƒ∞nformatika", "Texnologiya", "Biologiya", "Fizika", "Kimya", "Az…ôrbaycan Tarixi", "Tarix", "Coƒürafiya", "Musiqi", "T…ôsviri ƒ∞nc…ôs…ôn…ôt", "Fiziki t…ôrbiy…ô"],
                ["Aƒüayeva ∆èziz…ô", "7A", 7, 46, 60, 50, 90, 68, 80, 79, 83, 30, 47, 60, 43, 33, 50, 83, 87, 83],
                ["∆èliyev Yusif", "7A", 8, 87, 93, 88, 94, 83, 98, 91, 91, 60, 93, 93, 63, 93, 93, 87, 88, 93],
                ["G√∂y√º≈ül√º Ai≈ü…ô", "7A", 6, 63, 67, 49, 87, 61, 85, 78, 82, 40, 53, 80, 40, 47, 40, 82, 80, 82],
                ["H√ºseynli ∆èmin…ô", "7A", 11, 52, 27, 15, 26, 35, 80, 75, 83, 27, 33, 50, 33, 27, 37, 78, 67, 79],
                ["ƒ∞brahimov √ñm…ôr", "7A", 13, 64, 53, 73, 84, 39, 85, 89, 89, 43, 63, 47, 63, 40, 77, 67, 92, 83],
                ["Karahan Taha", "7A", 1, 36, 40, 30, 56, 41, 91, 78, 84, 37, 40, 37, 27, 60, 50, 77, 72, 84],
                ["Q…ôdm…ôliyev Murad", "7A", 17, 48, 47, 42, 31, 35, 81, 82, 86, 43, 67, 67, 40, 53, 67, 72, 72, 82],
                ["Q…ôhr…ômanova Q…ôm…ôr", "7A", 3, 31, 33, 28, 46, 93, 75, 84, 85, 33, 33, 30, 27, 27, 50, 79, 68, 82],
                ["Quliyev Asim", "7A", 7, 84, 93, 84, 87, 84, 96, 91, 91, 67, 73, 93, 70, 53, 90, 82, 87, 92],
                ["Quliyev √ñm…ôr", "7A", 3, 80, 80, 75, 91, 62, 98, 94, 95, 60, 73, 97, 60, 67, 87, 81, 87, 91],
                ["Quluzad…ô ∆èhm…ôd", "7A", 9, 43, 53, 39, 45, 47, 78, 84, 85, 33, 53, 60, 27, 33, 67, 63, 73, 88],
                ["M…ômm…ôdzad…ô Mustafa", "7A", 6, 61, 60, 58, 76, 36, 84, 87, 87, 30, 50, 60, 33, 33, 40, 63, 82, 87],
                ["Namazlƒ± Zeyn…ôb", "7A", 10, 76, 53, 54, 89, 53, 100, 85, 86, 47, 63, 80, 37, 27, 67, 78, 75, 89],
                ["Pa≈üazad…ô M…ôdin…ô", "7A", 4, 80, 73, 78, 75, 63, 94, 84, 88, 67, 83, 97, 80, 80, 100, 87, 100, 89],
                ["R…ôfiyeva Z…ôhra", "7A", 3, 32, 40, 26, 34, 37, 73, 86, 86, 43, 30, 47, 20, 13, 43, 72, 72, 84],
                ["Abdullayev ƒ∞sk…ônd…ôr", "7B", 3, 76, 67, 72, 87, 62, 84, 94, 93, 57, 87, 87, 80, 80, 77, 92, 82, 84],
                ["Cenikoƒülu Kaan", "7B", 5, 56, 40, 40, 42, 40, 94, 86, 86, 33, 43, 60, 53, 47, 60, 31, 70, 87],
                ["Eyvazova Z…ôhra", "7B", 3, 83, 73, 68, 93, 88, 83, 89, 87, 63, 60, 90, 63, 100, 80, 93, 82, 94],
                ["∆ès…ôdullazad…ô Nur", "7B", 0, 89, 67, 74, 97, 82, 90, 92, 90, 57, 67, 87, 87, 80, 87, 74, 88, 94],
                ["H…ô≈üimli ≈û…ôms", "7B", 4, 77, 67, 81, 84, 86, 86, 88, 88, 53, 67, 93, 47, 53, 83, 62, 82, 88],
                ["Quluzad…ô ƒ∞lkin", "7B", 4, 86, 67, 59, 81, 74, 88, 91, 89, 77, 80, 87, 70, 100, 97, 80, 83, 91],
                ["Mehdizad…ô Ramin", "7B", 8, 54, 53, 56, 55, 65, 95, 89, 89, 47, 53, 60, 50, 73, 63, 73, 85, 91],
                ["N…ôsibli Mehriban", "7B", 2, 78, 53, 62, 57, 34, 79, 81, 82, 43, 67, 90, 33, 40, 73, 68, 73, 89],
                ["N…ôsibov Elcan", "7B", 16, 29, 27, 23, 33, 37, 58, 85, 85, 37, 47, 43, 27, 47, 43, 34, 62, 84],
                ["Novruzov R√∂v≈ü…ôn", "7B", 1, 84, 67, 55, 73, 49, 89, 86, 86, 40, 63, 87, 67, 60, 73, 62, 60, 89],
                ["T…ôhm…ôzli X…ôlil", "7B", 0, 72, 60, 80, 57, 39, 85, 90, 90, 80, 83, 93, 83, 87, 87, 86, 80, 90],
                ["V…ôlizad…ô Ayxan", "7B", 1, 44, 47, 21, 44, 32, 75, 94, 94, 43, 33, 23, 43, 20, 67, 55, 83, 87],
                ["Zalov Levent", "7B", 2, 56, 53, 44, 65, 48, 77, 88, 88, 37, 23, 33, 33, 40, 63, 76, 80, 90],
                ["Calalova Zeyn…ôb", "8A", 5, 59, 60, 64, 49, 35, 85, 89, 89, 43, 47, 53, 27, 53, 50, 90, 55, 89],
                ["H√ºseynli Fatim…ô", "8A", 0, 48, 40, 68, 38, 47, 86, 90, 89, 50, 50, 47, 23, 40, 23, 89, 60, 89],
                ["K…ôrimli F…ôrhad", "8A", 2, 62, 20, 55, 52, 78, 95, 85, 84, 47, 60, 63, 40, 67, 60, 91, 67, 86],
                ["Quluzad…ô N…ôzrin", "8A", 4, 59, 47, 50, 80, 84, 90, 93, 91, 33, 50, 60, 23, 33, 53, 91, 82, 83],
                ["Manaflƒ± M√ºrs…ôl", "8A", 7, 65, 53, 61, 55, 53, 90, 87, 87, 30, 47, 83, 53, 67, 57, 97, 50, 87],
                ["M…ômm…ôdov Tuncay", "8A", 13, 54, 40, 18, 38, 31, 83, 81, 84, 47, 13, 33, 40, 40, 20, 74, 47, 87],
                ["M…ômm…ôdzad…ô Nuriyy…ô", "8A", 7, 86, 87, 89, 68, 61, 95, 90, 90, 87, 90, 83, 93, 93, 87, 98, 85, 91],
                ["N…ôsibli Cavan≈üir", "8A", 2, 65, 47, 48, 54, 42, 82, 92, 92, 70, 73, 73, 57, 73, 70, 71, 77, 90],
                ["N…ôzirli Uƒüur", "8A", 2, 64, 77, 66, 58, 80, 83, 81, 82, 57, 57, 68, 79, 93, 72, 97, 87, 93],
                ["Novruzlu Elcan", "8A", 6, 62, 53, 73, 44, 48, 88, 78, 85, 40, 53, 50, 53, 47, 57, 85, 40, 87],
                ["Cahangirov G√ºnd√ºz", "8B", 4, 64, 60, 45, 42, 31, 83, 86, 86, 50, 60, 73, 93, 93, 90, 71, 53, 81],
                ["∆èkb…ôrli √ñm…ôr", "8B", 4, 66, 73, 42, 53, 45, 79, 84, 84, 30, 43, 37, 43, 60, 57, 66, 38, 92],
                ["∆èlizad…ô Cavad", "8B", 2, 76, 73, 64, 62, 84, 71, 82, 87, 40, 77, 43, 80, 73, 90, 84, 37, 89],
                ["Hacƒ±yev Cavan≈üir", "8B", 2, 66, 47, 40, 55, 49, 80, 86, 88, 43, 67, 77, 63, 73, 87, 62, 35, 91],
                ["H…ôs…ônova Nurg√ºl", "8B", 7, 82, 73, 73, 94, 96, 98, 98, 97, 87, 90, 90, 73, 67, 83, 97, 98, 88],
                ["H√ºseynli Leyla", "8B", 11, 69, 53, 54, 33, 36, 93, 85, 84, 40, 47, 57, 33, 27, 40, 75, 68, 89],
                ["ƒ∞smayƒ±lzad…ô S…ôdi", "8B", 4, 69, 27, 77, 78, 92, 81, 97, 95, 27, 70, 57, 67, 47, 67, 76, 50, 93],
                ["Quluzad…ô Safiyy…ô", "8B", 6, 88, 100, 100, 90, 82, 96, 95, 93, 87, 97, 100, 93, 100, 100, 90, 90, 90],
                ["M…ôlikova Aylin", "8B", 7, 74, 87, 76, 74, 76, 89, 96, 95, 63, 90, 70, 70, 73, 90, 80, 83, 85],
                ["Musayeva Fidan", "8B", 3, 72, 53, 56, 59, 58, 97, 87, 87, 30, 33, 63, 33, 33, 53, 84, 72, 93],
                ["Sultanova Fatim…ô", "8B", 5, 46, 27, 53, 46, 98, 77, 80, 85, 37, 37, 57, 23, 27, 60, 81, 45, 89],
                ["≈û…ôrifova ≈û…ôrqiyy…ô", "8B", 0, 76, 60, 55, 78, 41, 96, 86, 86, 33, 47, 60, 53, 67, 70, 83, 68, 89]
            ],
            // 9. sƒ±nƒ±f
            '9': [
                ["≈ûagird", "Sinif", "Davamsƒ±zlƒ±q sayƒ±", "Az…ôrbaycan dili", "Riyaziyyat", "ƒ∞ngilis dili"],
                ["Abbaslƒ± Ruq…ôyya", "9A", 0, 54, 69, 81],
                ["∆èhm…ôdli G√ºlbahar", "9A", 2, 66, 67, 96],
                ["∆èlizad…ô Pakiz…ô", "9A", 0, 82, 79, 91],
                ["∆èmirov Amin", "9A", 5, 83, 93, 81],
                ["H√ºseynli D…ôniz", "9A", 2, 77, 72, 90],
                ["ƒ∞brahimov Ayaz", "9A", 4, 69, 69, 86],
                ["Mahmudov Xalid", "9A", 2, 82, 84, 93],
                ["M…ômm…ôdzad…ô K√ºrs√ºm", "9A", 5, 69, 82, 86],
                ["M√ºt…ôllimli Selcan", "9A", 0, 84, 70, 83],
                ["Zalova S√ºheyla", "9A", 3, 71, 57, 90],
                ["Zeynalov ƒ∞brahim", "9A", 4, 73, 43, 91],
                ["∆èsg…ôrova L…ôman", "9B", 4, 65, 62, 79],
                ["M…ômm…ôdxanlƒ± Aslan", "9B", 10, 47, 17, 34],
                ["M…ômm…ôdova Nuray", "9B", 3, 62, 50, 83],
                ["Murad Renat", "9B", 3, 47, 63, 90],
                ["Novruzlu N√ºbar", "9B", 4, 69, 26, 59],
                ["V…ôlizad…ô ƒ∞nci", "9B", 4, 62, 41, 87]
            ]
        };

        // =============================================
        // GLOBAL DEƒûƒ∞≈ûKENLER
        // =============================================
        let schoolData = {
            students: [],
            subjects: [],
            classes: [],
            overallStats: {}
        };

        let charts = {};

        const CLASS_TEACHERS = {
            '2A': 'M…ôdin…ô Naƒüƒ±yeva', '2.A': 'M…ôdin…ô Naƒüƒ±yeva',
            '2B': 'F…ôrid…ô Sultanzad…ô', '2.B': 'F…ôrid…ô Sultanzad…ô',
            '3A': 'N…ôrmin…ô ƒ∞brahimli', '3.A': 'N…ôrmin…ô ƒ∞brahimli',
            '3B': '≈û…ôlal…ô M…ôcidova', '3.B': '≈û…ôlal…ô M…ôcidova',
            '4A': 'G√ºlnar ƒ∞brahimli', '4.A': 'G√ºlnar ƒ∞brahimli',
            '4B': 'S…ônub…ôr Bax≈ü…ôliyeva', '4.B': 'S…ônub…ôr Bax≈ü…ôliyeva',
            '5A': 'G√ºnel H…ôt…ômzad…ô', '5B': 'Aytac Musab…ôyli',
            '6A': 'Adil √áaxoyev', '6B': 'P…ôrvin ∆è≈üari',
            '7A': 'K√∂n√ºl ∆èhm…ôdova', '7B': 'ƒ∞lah…ô ∆èkb…ôrova',
            '8A': 'G√ºls…ôba Akta≈ü', '8B': 'M…ôhbub…ô Talƒ±blƒ±',
            '9A': 'G√ºnel Axundova', '9B': 'G√ºnel H√ºseynova'
        };

        // =============================================
        // SUBJECT TEACHER DATA (EXTRACTED FROM PDF)
        // =============================================
        const SUBJECT_TEACHERS = {
            '2A': { 'Az…ôrbaycan dili': 'M…ôdin…ô Naƒüƒ±yeva', 'Riyaziyyat': 'M…ôdin…ô Naƒüƒ±yeva', 'H…ôyat bilgisi': 'M…ôdin…ô Naƒüƒ±yeva', 'ƒ∞ngilis dili': 'Sura K…ôrimova', 'T√ºrk dili': 'Saffet Yƒ±lmaz', 'Rus dili': 'G√ºls…ôba Akta≈ü', 'ƒ∞nformatika': '≈û…ôbn…ôm Zeynalova', 'Texnologiya': 'M…ôdin…ô Naƒüƒ±yeva', 'T…ôsviri ƒ∞nc…ôs…ôn…ôt': 'Fatma Valiyev', 'Musiqi': 'P…ôrvin ∆è≈üari', 'Fiziki t…ôrbiy…ô': '≈ûamil S√ºleymanov' },
            '2B': { 'Az…ôrbaycan dili': 'F…ôrid…ô Sultanzad…ô', 'Riyaziyyat': 'F…ôrid…ô Sultanzad…ô', 'H…ôyat bilgisi': 'F…ôrid…ô Sultanzad…ô', 'ƒ∞ngilis dili': 'T√ºrkan Qurbanova', 'T√ºrk dili': 'Saffet Yƒ±lmaz', 'Rus dili': 'G√ºls…ôba Akta≈ü', 'ƒ∞nformatika': '≈û…ôbn…ôm Zeynalova', 'Texnologiya': 'F…ôrid…ô Sultanzad…ô', 'T…ôsviri ƒ∞nc…ôs…ôn…ôt': 'Fatma Valiyev', 'Musiqi': 'P…ôrvin ∆è≈üari', 'Fiziki t…ôrbiy…ô': '≈ûamil S√ºleymanov' },
            '3A': { 'Az…ôrbaycan dili': 'N…ôrmin…ô ƒ∞brahimli', 'Riyaziyyat': 'N…ôrmin…ô ƒ∞brahimli', 'H…ôyat bilgisi': 'N…ôrmin…ô ƒ∞brahimli', 'ƒ∞ngilis dili': 'Sura K…ôrimova', 'T√ºrk dili': 'Saffet Yƒ±lmaz', 'Rus dili': 'G√ºls…ôba Akta≈ü', 'ƒ∞nformatika': '≈û…ôbn…ôm Zeynalova', 'Texnologiya': 'N…ôrmin…ô ƒ∞brahimli', 'T…ôsviri ƒ∞nc…ôs…ôn…ôt': 'Fatma Valiyev', 'Musiqi': 'P…ôrvin ∆è≈üari', 'Fiziki t…ôrbiy…ô': '≈ûamil S√ºleymanov' },
            '3B': { 'Az…ôrbaycan dili': '≈û…ôlal…ô M…ôcidova', 'Riyaziyyat': '≈û…ôlal…ô M…ôcidova', 'H…ôyat bilgisi': '≈û…ôlal…ô M…ôcidova', 'ƒ∞ngilis dili': 'G√ºnel H√ºseynova', 'T√ºrk dili': 'Saffet Yƒ±lmaz', 'Rus dili': 'G√ºls…ôba Akta≈ü', 'ƒ∞nformatika': '≈û…ôbn…ôm Zeynalova', 'Texnologiya': '≈û…ôlal…ô M…ôcidova', 'T…ôsviri ƒ∞nc…ôs…ôn…ôt': 'Fatma Valiyev', 'Musiqi': 'P…ôrvin ∆è≈üari', 'Fiziki t…ôrbiy…ô': '≈ûamil S√ºleymanov' },
            '4A': { 'Az…ôrbaycan dili': 'G√ºlnar ƒ∞brahimli', 'Riyaziyyat': 'G√ºlnar ƒ∞brahimli', 'H…ôyat bilgisi': 'G√ºlnar ƒ∞brahimli', 'ƒ∞ngilis dili': 'G√ºnel H…ôt…ômzad…ô', 'T√ºrk dili': 'Saffet Yƒ±lmaz', 'Rus dili': 'G√ºls…ôba Akta≈ü', 'ƒ∞nformatika': '≈û…ôbn…ôm Zeynalova', 'Texnologiya': 'G√ºlnar ƒ∞brahimli', 'T…ôsviri ƒ∞nc…ôs…ôn…ôt': 'Fatma Valiyev', 'Musiqi': 'P…ôrvin ∆è≈üari', 'Fiziki t…ôrbiy…ô': '≈ûamil S√ºleymanov' },
            '4B': { 'Az…ôrbaycan dili': 'S…ônub…ôr Bax≈ü…ôliyeva', 'Riyaziyyat': 'S…ônub…ôr Bax≈ü…ôliyeva', 'H…ôyat bilgisi': 'S…ônub…ôr Bax≈ü…ôliyeva', 'ƒ∞ngilis dili': 'ƒ∞lah…ô ∆èkb…ôrova', 'T√ºrk dili': 'Saffet Yƒ±lmaz', 'Rus dili': 'G√ºls…ôba Akta≈ü', 'ƒ∞nformatika': '≈û…ôbn…ôm Zeynalova', 'Texnologiya': 'S…ônub…ôr Bax≈ü…ôliyeva', 'T…ôsviri ƒ∞nc…ôs…ôn…ôt': 'Fatma Valiyev', 'Musiqi': 'P…ôrvin ∆è≈üari', 'Fiziki t…ôrbiy…ô': '≈ûamil S√ºleymanov' },
            '5A': { 'Az…ôrbaycan dili': 'N…ôn…ôxanƒ±m Qafarova', '∆èd…ôbiyyat': 'M…ôdin…ô M…ômm…ôdova', 'Riyaziyyat': 'G√ºnel ƒ∞zz…ôtgil', 'ƒ∞ngilis dili': 'G√ºnel H…ôt…ômzad…ô', 'T√ºrk dili': 'Saffet Yƒ±lmaz', 'Rus dili': 'G√ºls…ôba Akta≈ü', 'Az…ôrbaycan Tarixi': 'X…ôyal…ô ∆èsg…ôrli', 'T…ôbi…ôt': 'G√ºnel Axundova', 'ƒ∞nformatika': 'Adil √áaxoyev', 'Texnologiya': 'Adil √áaxoyev', 'T…ôsviri ƒ∞nc…ôs…ôn…ôt': 'Fatma Valiyev', 'Musiqi': 'P…ôrvin ∆è≈üari', 'Fiziki t…ôrbiy…ô': '≈ûamil S√ºleymanov' },
            '5B': { 'Az…ôrbaycan dili': 'K√∂n√ºl ∆èhm…ôdova', '∆èd…ôbiyyat': 'K√∂n√ºl ∆èhm…ôdova', 'Riyaziyyat': 'F…ôrid…ô Alqayeva', 'ƒ∞ngilis dili': 'Aytac Musab…ôyli', 'T√ºrk dili': 'Saffet Yƒ±lmaz', 'Rus dili': 'G√ºls…ôba Akta≈ü', 'Az…ôrbaycan Tarixi': 'X…ôyal…ô ∆èsg…ôrli', 'T…ôbi…ôt': 'G√ºnel Axundova', 'ƒ∞nformatika': 'Adil √áaxoyev', 'Texnologiya': 'Adil √áaxoyev', 'T…ôsviri ƒ∞nc…ôs…ôn…ôt': 'Fatma Valiyev', 'Musiqi': 'P…ôrvin ∆è≈üari', 'Fiziki t…ôrbiy…ô': '≈ûamil S√ºleymanov' },
            '6A': { 'Az…ôrbaycan dili': 'Aynur…ô Qurban', '∆èd…ôbiyyat': 'M…ôdin…ô M…ômm…ôdova', 'T√ºrk dili': 'Saffet Yƒ±lmaz', 'Rus dili': 'G√ºls…ôba Akta≈ü', 'Az…ôrbaycan Tarixi': 'X…ôyal…ô ∆èsg…ôrli', 'Tarix': 'X…ôyal…ô ∆èsg…ôrli', 'Coƒürafiya': 'G√ºlnar S…ôttarlƒ±', 'T…ôbi…ôt': 'G√ºnel Axundova', 'ƒ∞nformatika': 'Adil √áaxoyev', 'Texnologiya': 'Adil √áaxoyev', 'T…ôsviri ƒ∞nc…ôs…ôn…ôt': 'Fatma Valiyev', 'Musiqi': 'P…ôrvin ∆è≈üari', 'Fiziki t…ôrbiy…ô': '≈ûamil S√ºleymanov' },
            '6B': { 'Az…ôrbaycan dili': 'M…ôdin…ô M…ômm…ôdova', '∆èd…ôbiyyat': 'M…ôdin…ô M…ômm…ôdova', 'T√ºrk dili': 'Saffet Yƒ±lmaz', 'Rus dili': 'G√ºls…ôba Akta≈ü', 'Az…ôrbaycan Tarixi': 'X…ôyal…ô ∆èsg…ôrli', 'Tarix': 'X…ôyal…ô ∆èsg…ôrli', 'Coƒürafiya': 'G√ºlnar S…ôttarlƒ±', 'T…ôbi…ôt': 'G√ºnel Axundova', 'ƒ∞nformatika': 'Adil √áaxoyev', 'Texnologiya': 'Adil √áaxoyev', 'T…ôsviri ƒ∞nc…ôs…ôn…ôt': 'Fatma Valiyev', 'Musiqi': 'P…ôrvin ∆è≈üari', 'Fiziki t…ôrbiy…ô': 'Emin Sultanzad…ô' },
            '7A': { 'Az…ôrbaycan dili': 'K√∂n√ºl ∆èhm…ôdova', '∆èd…ôbiyyat': 'K√∂n√ºl ∆èhm…ôdova', 'T√ºrk dili': 'Saffet Yƒ±lmaz', 'Rus dili': 'G√ºls…ôba Akta≈ü', 'Az…ôrbaycan Tarixi': 'X…ôyal…ô ∆èsg…ôrli', 'Tarix': 'X…ôyal…ô ∆èsg…ôrli', 'Coƒürafiya': 'G√ºlnar S…ôttarlƒ±', 'Biologiya': 'F…ôrqan…ô Q…ônb…ôrli', 'Fizika': 'Aytac ∆èhm…ôdova', 'Kimya': 'G√ºnel Axundova', 'ƒ∞nformatika': 'Adil √áaxoyev', 'Texnologiya': 'Adil √áaxoyev', 'T…ôsviri ƒ∞nc…ôs…ôn…ôt': 'Fatma Valiyev', 'Musiqi': 'P…ôrvin ∆è≈üari', 'Fiziki t…ôrbiy…ô': 'X…ôyal…ô Qiyasova' },
            '7B': { 'Az…ôrbaycan dili': 'Aynur…ô Qurban', '∆èd…ôbiyyat': 'Aynur…ô Qurban', 'T√ºrk dili': 'Saffet Yƒ±lmaz', 'Rus dili': 'G√ºls…ôba Akta≈ü', 'Az…ôrbaycan Tarixi': 'X…ôyal…ô ∆èsg…ôrli', 'Tarix': 'X…ôyal…ô ∆èsg…ôrli', 'Coƒürafiya': 'G√ºlnar S…ôttarlƒ±', 'Biologiya': 'F…ôrqan…ô Q…ônb…ôrli', 'Fizika': 'Aytac ∆èhm…ôdova', 'Kimya': 'G√ºnel Axundova', 'ƒ∞nformatika': 'Adil √áaxoyev', 'Texnologiya': 'Adil √áaxoyev', 'T…ôsviri ƒ∞nc…ôs…ôn…ôt': 'Fatma Valiyev', 'Musiqi': 'P…ôrvin ∆è≈üari', 'Fiziki t…ôrbiy…ô': '≈ûamil S√ºleymanov' },
            '8A': { 'Az…ôrbaycan dili': 'K√∂n√ºl ∆èhm…ôdova', '∆èd…ôbiyyat': 'K√∂n√ºl ∆èhm…ôdova', 'T√ºrk dili': 'Saffet Yƒ±lmaz', 'Rus dili': 'G√ºls…ôba Akta≈ü', 'Az…ôrbaycan Tarixi': 'X…ôyal…ô ∆èsg…ôrli', 'Tarix': 'X…ôyal…ô ∆èsg…ôrli', 'Coƒürafiya': 'G√ºlnar S…ôttarlƒ±', 'Biologiya': 'F…ôrqan…ô Q…ônb…ôrli', 'Fizika': 'Aytac ∆èhm…ôdova', 'Kimya': 'G√ºnel Axundova', 'ƒ∞nformatika': 'Adil √áaxoyev', 'Texnologiya': 'Adil √áaxoyev', 'T…ôsviri ƒ∞nc…ôs…ôn…ôt': 'Fatma Valiyev', 'Musiqi': 'P…ôrvin ∆è≈üari', 'Fiziki t…ôrbiy…ô': 'X…ôyal…ô Qiyasova' },
            '8B': { 'Az…ôrbaycan dili': 'K√∂n√ºl ∆èhm…ôdova', '∆èd…ôbiyyat': 'K√∂n√ºl ∆èhm…ôdova', 'T√ºrk dili': 'Saffet Yƒ±lmaz', 'Rus dili': 'G√ºls…ôba Akta≈ü', 'Az…ôrbaycan Tarixi': 'X…ôyal…ô ∆èsg…ôrli', 'Tarix': 'X…ôyal…ô ∆èsg…ôrli', 'Coƒürafiya': 'G√ºlnar S…ôttarlƒ±', 'Biologiya': 'F…ôrqan…ô Q…ônb…ôrli', 'Fizika': 'Aytac ∆èhm…ôdova', 'Kimya': 'G√ºnel Axundova', 'ƒ∞nformatika': 'Adil √áaxoyev', 'Texnologiya': 'Adil √áaxoyev', 'T…ôsviri ƒ∞nc…ôs…ôn…ôt': 'Fatma Valiyev', 'Musiqi': 'P…ôrvin ∆è≈üari', 'Fiziki t…ôrbiy…ô': 'X…ôyal…ô Qiyasova' },
            '9A': { 'Az…ôrbaycan dili': 'Aynur…ô Qurban', 'Riyaziyyat': 'M…ôhbub…ô Talƒ±blƒ±', 'ƒ∞ngilis dili': 'Aysu Mirz…ôyeva' },
            '9B': { 'Az…ôrbaycan dili': 'N…ôn…ôxanƒ±m Qafarova', 'Riyaziyyat': '≈ûahnaz Sarƒ±yeva', 'ƒ∞ngilis dili': 'Aynur M…ômm…ôdova' }
        };

        const SUBGROUP_TEACHERS = {
            'Riyaziyyat': {
                '6A': { 'G√ºnel ƒ∞zz…ôtgil': ['Calalova M…ôry…ôm', '∆èhm…ôdli M…ôry…ôm', '∆èlizad…ô Aylin', 'ƒ∞mamzad…ô Fatim…ô', 'ƒ∞smayƒ±llƒ± Xalid', 'M…ômm…ôdli H√ºseyn', 'S…ôrdarlƒ± X…ôdic…ô', 'Sultanov Fateh', 'T…ôhm…ôzli Mete'], 'M…ôhbub…ô Talƒ±blƒ±': ['C…ôf…ôrzad…ô Atilla', 'Kazƒ±mlƒ± Ceyla', 'Q…ônb…ôrli Turqut', 'Manaflƒ± Murad', 'M…ômm…ôdli F…ôrhad', 'Muradova Selcan', 'Naƒüƒ±yev S…ôyyad', 'Osmanova M…ôry…ôm', 'V…ôliyeva Z…ôhra'] },
                '6B': { 'G√ºnel ƒ∞zz…ôtgil': ['Eyvazova M…ôry…ôm', '∆èhm…ôdov Az…ôr', 'H…ô≈üimli Zeyn…ôb', 'ƒ∞smayƒ±lzad…ô Mikayƒ±l', 'M…ômm…ôdli Aƒüa', 'Mustafa Muhammed', 'Namazlƒ± Banu', 'Pa≈üazad…ô X…ôdic…ô', '≈ûahm…ôrdanov Ramal'], 'M…ôhbub…ô Talƒ±blƒ±': ['Alqayeva Kamil…ô', '∆èlirzayev H…ôs…ôn', '∆èsg…ôrova Aylin', 'H√ºseynli Mustafa', 'H√ºseynli Z…ôhra', 'ƒ∞smayƒ±l Ayxan', 'Mahmudlu Altay', 'Mahmudova Z√ºmr√ºd', 'M…ômm…ôdova L…ôman'] },
                '7A': { 'G√ºnel ƒ∞zz…ôtgil': ['∆èliyev Yusif', 'ƒ∞brahimov √ñm…ôr', 'Quliyev Asim', 'Quliyev √ñm…ôr', 'M…ômm…ôdzad…ô Mustafa', 'Pa≈üazad…ô M…ôdin…ô'], 'M…ôhbub…ô Talƒ±blƒ±': ['Aƒüayeva ∆èziz…ô', 'G√∂y√º≈ül√º Ai≈ü…ô', 'H√ºseynli ∆èmin…ô', 'Karahan Taha', 'Q…ôdm…ôliyev Murad', 'Q…ôhr…ômanova Q…ôm…ôr', 'Quluzad…ô ∆èhm…ôd', 'Namazlƒ± Zeyn…ôb', 'R…ôfiyeva Z…ôhra'] },
                '7B': { 'G√ºnel ƒ∞zz…ôtgil': ['Abdullayev ƒ∞sk…ônd…ôr', 'Eyvazova Z…ôhra', '∆ès…ôdullazad…ô Nur', 'H…ô≈üimli ≈û…ôms', 'Quluzad…ô ƒ∞lkin', 'Novruzov R√∂v≈ü…ôn', 'T…ôhm…ôzli X…ôlil', 'Zalov Levent'], 'M…ôhbub…ô Talƒ±blƒ±': ['Cenikoƒülu Kaan', 'Mehdizad…ô Ramin', 'N…ôsibli Mehriban', 'N…ôsibov Elcan', 'V…ôlizad…ô Ayxan'] },
                '8A': { 'F…ôrid…ô Alqayeva': ['Calalova Zeyn…ôb', 'H√ºseynli Fatim…ô', 'K…ôrimli F…ôrhad', 'Manaflƒ± M√ºrs…ôl', 'M…ômm…ôdov Tuncay', 'N…ôzirli Uƒüur', 'Novruzlu Elcan'], 'M…ôhbub…ô Talƒ±blƒ±': ['Quluzad…ô N…ôzrin', 'M…ômm…ôdzad…ô Nuriyy…ô', 'N…ôsibli Cavan≈üir'] },
                '8B': { 'F…ôrid…ô Alqayeva': ['∆èkb…ôrli √ñm…ôr', '≈û…ôrifova ≈û…ôrqiyy…ô'], 'M…ôhbub…ô Talƒ±blƒ±': ['Cahangirov G√ºnd√ºz', '∆èlizad…ô Cavad', 'Hacƒ±yev Cavan≈üir', 'H…ôs…ônova Nurg√ºl', 'H√ºseynli Leyla', 'ƒ∞smayƒ±lzad…ô S…ôdi', 'Quluzad…ô Safiyy…ô', 'M…ôlikova Aylin', 'Musayeva Fidan', 'Sultanova Fatim…ô'] }
            },
            'ƒ∞ngilis dili': {
                '6A': { 'G√ºnel H√ºseynova': ['Calalova M…ôry…ôm', '∆èlizad…ô Aylin', 'ƒ∞mamzad…ô Fatim…ô', 'ƒ∞smayƒ±llƒ± Xalid', 'M…ômm…ôdli F…ôrhad', 'M…ômm…ôdli H√ºseyn', 'S…ôrdarlƒ± X…ôdic…ô', 'Sultanov Fateh', 'T…ôhm…ôzli Mete', 'V…ôliyeva Z…ôhra'], 'ƒ∞lah…ô ∆èkb…ôrova': ['C…ôf…ôrzad…ô Atilla', '∆èhm…ôdli M…ôry…ôm', 'Kazƒ±mlƒ± Ceyla', 'Q…ônb…ôrli Turqut', 'Manaflƒ± Murad', 'Muradova Selcan', 'Naƒüƒ±yev S…ôyyad', 'Osmanova M…ôry…ôm'] },
                '6B': { 'G√ºnel H√ºseynova': ['Eyvazova M…ôry…ôm', '∆èhm…ôdov Az…ôr', '∆èlirzayev H…ôs…ôn', 'H…ô≈üimli Zeyn…ôb', 'M…ômm…ôdli Aƒüa', 'Mustafa Muhammed', 'Pa≈üazad…ô X…ôdic…ô', '≈ûahm…ôrdanov Ramal'], 'ƒ∞lah…ô ∆èkb…ôrova': ['Alqayeva Kamil…ô', '∆èsg…ôrova Aylin', 'H√ºseynli Mustafa', 'H√ºseynli Z…ôhra', 'ƒ∞smayƒ±l Ayxan', 'ƒ∞smayƒ±lzad…ô Mikayƒ±l', 'Mahmudlu Altay', 'Mahmudova Z√ºmr√ºd', 'M…ômm…ôdova L…ôman', 'Namazlƒ± Banu'] },
                '7A': { 'T√ºrkan Qurbanova': ['Aƒüayeva ∆èziz…ô', '∆èliyev Yusif', 'ƒ∞brahimov √ñm…ôr', 'Quliyev Asim', 'Quliyev √ñm…ôr', 'M…ômm…ôdzad…ô Mustafa', 'Namazlƒ± Zeyn…ôb', 'Pa≈üazad…ô M…ôdin…ô'], 'ƒ∞lah…ô ∆èkb…ôrova': ['G√∂y√º≈ül√º Ai≈ü…ô', 'H√ºseynli ∆èmin…ô', 'Karahan Taha', 'Q…ôdm…ôliyev Murad', 'Q…ôhr…ômanova Q…ôm…ôr', 'Quluzad…ô ∆èhm…ôd', 'R…ôfiyeva Z…ôhra'] },
                '7B': { 'T√ºrkan Qurbanova': ['Abdullayev ƒ∞sk…ônd…ôr', 'Eyvazova Z…ôhra', '∆ès…ôdullazad…ô Nur', 'H…ô≈üimli ≈û…ôms', 'Quluzad…ô ƒ∞lkin', 'Novruzov R√∂v≈ü…ôn', 'T…ôhm…ôzli X…ôlil'], 'ƒ∞lah…ô ∆èkb…ôrova': ['Cenikoƒülu Kaan', 'Mehdizad…ô Ramin', 'N…ôsibli Mehriban', 'N…ôsibov Elcan', 'V…ôlizad…ô Ayxan', 'Zalov Levent'] },
                '8A': { 'G√ºnel H…ôt…ômzad…ô': ['Calalova Zeyn…ôb', 'H√ºseynli Fatim…ô', 'K…ôrimli F…ôrhad', 'Manaflƒ± M√ºrs…ôl', 'M…ômm…ôdov Tuncay', 'N…ôsibli Cavan≈üir', 'Novruzlu Elcan'], 'Sura K…ôrimova': ['Quluzad…ô N…ôzrin', 'M…ômm…ôdzad…ô Nuriyy…ô', 'N…ôzirli Uƒüur'] },
                '8B': { 'G√ºnel H…ôt…ômzad…ô': ['Cahangirov G√ºnd√ºz', '∆èkb…ôrli √ñm…ôr', 'H√ºseynli Leyla', 'Musayeva Fidan', 'Sultanova Fatim…ô'], 'Sura K…ôrimova': ['∆èlizad…ô Cavad', 'Hacƒ±yev Cavan≈üir', 'H…ôs…ônova Nurg√ºl', 'ƒ∞smayƒ±lzad…ô S…ôdi', 'Quluzad…ô Safiyy…ô', 'M…ôlikova Aylin', '≈û…ôrifova ≈û…ôrqiyy…ô'] }
            }
        };

        // =============================================
        // SAYFA Y√úKLENDƒ∞ƒûƒ∞NDE √áALI≈ûACAK KOD
        // =============================================
        document.addEventListener('DOMContentLoaded', function () {
            // Theme initialization
            initTheme();
            document.getElementById('theme-toggle').addEventListener('click', toggleTheme);

            // Canlƒ± Saatƒ± ba≈ülat
            updateLiveClock();
            setInterval(updateLiveClock, 1000);

            // G√∂m√ºl√º verileri y√ºkle
            loadEmbeddedData();

            // Navigation event listener'larƒ±nƒ± ayarla
            document.querySelectorAll('.nav-link, .mobile-nav-btn, .modern-nav-btn').forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();

                    // Show selected section
                    const sectionName = this.getAttribute('data-section');
                    showSection(`${sectionName}-section`);

                    // Mobil cihazlarda yumu≈üak kaydƒ±rma
                    if (window.innerWidth <= 768) {
                        setTimeout(() => {
                            window.scrollTo({
                                top: 120,
                                behavior: 'smooth'
                            });
                        }, 100);
                    }
                });
            });

            // Sistem bilgisini g√ºncelle
            const dataInfo = document.getElementById('data-info');
            if (dataInfo) dataInfo.textContent = 'G√∂m√ºl√º veril…ôr (2-9. sinifl…ôr)';

            const lastUpdate = document.getElementById('last-update');
            if (lastUpdate) lastUpdate.textContent = `Son yenil…ôm…ô: ${new Date().toLocaleTimeString('az-AZ')}`;

            // Mobil nav pozisyonunu ayarla
            adjustMobileNavPosition();
            window.addEventListener('resize', adjustMobileNavPosition);

            // Global Arama Eventleri
            initGlobalSearch();

            // Filtre Event Listener'larƒ±nƒ± ayarla
            setupFilterEventListeners();

            // Heatmap Merge Toggle Listener
            const heatmapMergeToggle = document.getElementById('heatmap-merge-toggle');
            if (heatmapMergeToggle) {
                heatmapMergeToggle.addEventListener('change', generateHeatmap);
            }

            // AI Assistant initialization
            initAIAssistant();
        });

        // =============================================
        // CANLI SAAT V∆è TARƒ∞X LOGƒ∞KASI
        // =============================================
        function updateLiveClock() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('az-AZ', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
            const dateStr = now.toLocaleDateString('az-AZ', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            const clockEl = document.getElementById('current-clock');
            const dateEl = document.getElementById('current-date');
            if (clockEl) clockEl.textContent = timeStr;
            if (dateEl) dateEl.textContent = dateStr;
        }

        // =============================================
        // AI ASSISTANT LOGIC
        // =============================================
        function initAIAssistant() {
            const toggle = document.getElementById('ai-chat-toggle');
            if (toggle) toggle.addEventListener('click', toggleAIChat);
        }

        function toggleAIChat() {
            const window = document.getElementById('ai-chat-window');
            const btn = document.getElementById('ai-chat-toggle');
            const isVisible = window.style.display === 'flex';

            if (isVisible) {
                window.style.display = 'none';
                if (btn) btn.style.display = 'flex'; // Show button when chat closed
            } else {
                window.style.display = 'flex';
                // On mobile, hide the floating button so it doesn't overlap
                if (document.documentElement.clientWidth <= 576) {
                    if (btn) btn.style.display = 'none';
                }
                setTimeout(() => document.getElementById('ai-input').focus(), 100);
            }
        }

        function sendAlSuggestion(text) {
            document.getElementById('ai-input').value = text;
            handleAISend();
        }

        function handleAISend() {
            const input = document.getElementById('ai-input');
            const query = input.value.trim();
            if (!query) return;

            addAIMessage(query, 'user');
            input.value = '';

            // Simulate "thinking"
            setTimeout(() => {
                const response = processAIQuery(query);
                addAIMessage(response, 'assistant');
            }, 600);
        }

        function addAIMessage(text, sender) {
            const container = document.getElementById('ai-chat-messages');
            const msg = document.createElement('div');
            msg.className = `ai-message ${sender}`;
            msg.innerHTML = text;
            container.appendChild(msg);
            container.scrollTop = container.scrollHeight;
        }

        function getGradeBadgeClass(grade) {
            if (grade >= 90) return 'bg-success';
            if (grade >= 70) return 'bg-primary';
            if (grade >= 50) return 'bg-warning text-dark';
            return 'bg-danger';
        }

        // G√ºcl√º Normalizasiya: B√ºt√ºn simvollarƒ± (., -, bo≈üluq) t…ômizl…ôyir
        const cleanForMatch = (text) => {
            if (!text) return "";
            return text.toString().toLowerCase()
                .replace(/ƒ±/g, 'i').replace(/√ß/g, 'c').replace(/≈ü/g, 's').replace(/ƒü/g, 'g')
                .replace(/[^a-z0-9]/g, ''); // Yalnƒ±z h…ôrf v…ô r…ôq…ôm saxla
        };

        // =============================================
        // IMSA COGNITIVE ENGINE (V5 - SEMANTIC ANALYTICS)
        // =============================================
        function processAIQuery(query) {
            const rawQ = query.toLowerCase().trim();
            const stats = schoolData.overallStats;

            // 1. ULTRA-ROBUST NORMALIZATION (A-centric)
            const heavyClean = (text) => {
                if (!text) return "";
                return text.toString().toLowerCase()
                    .replace(/…ô/g, 'a').replace(/e/g, 'a').replace(/√∂/g, 'o').replace(/√º/g, 'u').replace(/ƒ±/g, 'i').replace(/√ß/g, 'c').replace(/≈ü/g, 's').replace(/ƒü/g, 'g')
                    .replace(/\s+/g, '') // B√ºt√ºn bo≈üluqlarƒ± sil
                    .replace(/[^a-z0-9]/g, ''); // B√ºt√ºn simvollarƒ± sil
            };

            const qClean = heavyClean(rawQ);

            // --- AI VOICE RESPONSES ---
            const AI_VOICE = {
                greet: "Salam! IMSA Aƒüƒ±llƒ± Analitika m√ºh…ôrriki hazƒ±rdƒ±r. ü§ñ M…ôkt…ôb √ºzr…ô ist…ônil…ôn statistikaya v…ô ya ≈üagird/sinif m…ôlumatƒ±na baxa bil…ôrik.",
                thanks: "Buyurun! Ba≈üqa bir sualƒ±nƒ±z v…ô ya analiz ehtiyacƒ±nƒ±z varmƒ±? üòä",
                notfound: (hint) => `Soru≈üduƒüunuz m√∂vzu haqqƒ±nda m…ôlumat bazasƒ±nda d…ôqiq uyƒüunluq tapmadƒ±m. üßê<br><small class="text-muted">B…ôlk…ô bunlarƒ± yoxlayasƒ±nƒ±z: <b>${hint}</b></small>`,
                clue: "2A sinfi, Aƒüazad…ô ƒ∞brahim, Top 5 ≈üagird, Davamiyy…ôt problemi"
            };

            // Conversational triggers
            if (['salam', 'hey', 'hi', 'alo'].includes(qClean)) return AI_VOICE.greet;
            if (['necesen', 'veziyyetnece'].some(t => qClean.includes(t))) return "Siz…ô xidm…ôt ed…ônd…ô √∂z√ºm√º …ôla hiss edir…ôm! üìä Buyurun, hansƒ± m…ôlumatƒ± analiz ed…ôk?";
            if (['sagol', 'tesekkur', 'minnetdar', 'ok', 'oldu'].some(t => qClean.includes(t))) return AI_VOICE.thanks;

            // --- TEMPLATE SEARCH (ROBUST KEYWORDS) ---

            // T1 & T9: √úmumi Statistika (umumivaziyyat)
            if (qClean.includes('umumivaziyyat') || qClean.includes('umumimaktab') || qClean.includes('umumistatistik')) {
                return `üìä <b>M…ôkt…ôbin √úmumi Statistika Hesabatƒ±:</b><br><div class='small mt-1'>
                ‚Ä¢ Toplam ≈ûagird Sayƒ±: <b>${stats.totalStudents}</b><br>
                ‚Ä¢ Orta Akademik Bal: <b>${stats.overallAverage.toFixed(1)}</b><br>
                ‚Ä¢ Orta Davamsƒ±zlƒ±q: <b>${stats.averageAttendance.toFixed(1)} g√ºn</b><br>
                ‚Ä¢ Sistemd…ôki Sinif Sayƒ±: <b>${schoolData.classes.length}</b></div>`;
            }

            // T2: Top 5 ≈ûagird (top5)
            if (qClean.includes('top5') || qClean.includes('anyaksi5') || qClean.includes('lidarsagird')) {
                const top = [...schoolData.students].sort((a, b) => b.average - a.average).slice(0, 5);
                let res = "üèÜ <b>M…ôkt…ôbin Lider ≈ûagirdl…ôri (Top 5):</b><br><ul class='ps-3 mb-0 small'>";
                top.forEach(s => res += `<li>${s.name} (${s.className}) - <b>${s.average.toFixed(1)}</b></li>`);
                return res + "</ul>";
            }

            // T3: ∆èn yax≈üƒ± sinif (hansisinfin...)
            if (qClean.includes('hansisinfin') || qClean.includes('ortalamasianyuksak') || qClean.includes('anyaxsisinif')) {
                const sortedClasses = [...schoolData.classes].sort((a, b) => (stats.classAverages[b]?.average || 0) - (stats.classAverages[a]?.average || 0));
                const best = sortedClasses[0];
                let res = `üè´ <b>Akademik Lider Sinif:</b> <b>${best}</b> (Orta bal: <b>${stats.classAverages[best].average.toFixed(1)}</b>)<br><br>`;
                res += `üö∂ <b>Sinifl…ôrin C…ômi Davamsƒ±zlƒ±ƒüƒ± (Alt-alta):</b><br>`;
                [...schoolData.classes].sort().forEach(c => {
                    const cStudents = schoolData.students.filter(s => s.className === c);
                    const totalAtt = cStudents.reduce((sum, s) => sum + s.attendance, 0);
                    res += `‚Ä¢ ${c}: <b>${totalAtt} g√ºn</b><br>`;
                });
                return res;
            }

            // T5: Kritik Davamsƒ±zlƒ±q (kritikdavamsizliq)
            if (qClean.includes('kritikdavamsizliq') || qClean.includes('encoxdavamsizliq')) {
                const critical = [...schoolData.students].sort((a, b) => b.attendance - a.attendance).slice(0, 15);
                let res = "üö© <b>Kritik Davamsƒ±zlƒ±q - ∆èn √ßox d…ôrs qa√ßƒ±ran ≈üagirdl…ôr:</b><br>";
                if (critical.length > 0) critical.forEach((s, idx) => {
                    if (s.attendance > 0) res += `${idx + 1}. ${s.name} (${s.className}): <b>${s.attendance} g√ºn</b><br>`;
                });
                else res += "Sistemd…ô davamsƒ±zlƒ±ƒüƒ± olan ≈üagird tapƒ±lmadƒ±.";
                return res;
            }

            // T6: F…ônn Liderl…ôri (fan + lidar v…ô ya konkret f…ônn)
            const isLidarQuery = qClean.includes('lidar') || qClean.includes('birinci') || qClean.includes('anyaxsi') || qClean.includes('alaci');
            const mentionedSubject = schoolData.subjects.find(sub => qClean.includes(heavyClean(sub)));

            if (isLidarQuery && (qClean.includes('fan') || mentionedSubject)) {
                if (mentionedSubject && !qClean.includes('butun')) {
                    // Specific subject leader
                    let topS = null;
                    let maxVal = -1;
                    schoolData.students.forEach(s => {
                        if (s.subjects[mentionedSubject] !== undefined && s.subjects[mentionedSubject] > maxVal) {
                            maxVal = s.subjects[mentionedSubject];
                            topS = s;
                        }
                    });
                    if (topS) {
                        return `üìö <b>${mentionedSubject}</b> √ºzr…ô m…ôkt…ôb lideri: <br>üë§ <b>${topS.name}</b> (${topS.className}) - <span class="badge bg-success">${maxVal} bal</span>`;
                    }
                } else {
                    // All subjects leaders
                    let res = "üìö <b>H…ôr f…ônn √ºzr…ô m…ôkt…ôb liderl…ôri (Top N…ôtic…ô):</b><br>";
                    schoolData.subjects.forEach(sub => {
                        let topS = null;
                        let maxVal = -1;
                        schoolData.students.forEach(s => {
                            if (s.subjects[sub] !== undefined && s.subjects[sub] > maxVal) {
                                maxVal = s.subjects[sub];
                                topS = s;
                            }
                        });
                        if (topS) {
                            res += `‚Ä¢ ${sub}: <b>${topS.name}</b> (${topS.className}) - <span class="badge bg-success">${maxVal} bal</span><br>`;
                        }
                    });
                    return res;
                }
            }

            // T7: ∆èla√ßƒ±larƒ±n siyahƒ±sƒ± (alacilar)
            if (qClean.includes('alaci') || qClean.includes('anyaksisagird') || qClean.includes('lidersagird')) {
                let res = `üåü <b>H…ôr sinif √ºzr…ô akademik lider ≈üagirdl…ôr:</b><br>`;
                [...schoolData.classes].sort().forEach(c => {
                    const cStudents = schoolData.students.filter(s => s.className === c);
                    if (cStudents.length > 0) {
                        const top = cStudents.sort((a, b) => b.average - a.average)[0];
                        res += `‚Ä¢ ${c}: <b>${top.name}</b> - <b>${top.average.toFixed(1)} bal</b><br>`;
                    }
                });
                return res;
            }

            // T8: M√ºk…ômm…ôl Davamiyy…ôt (0 g√ºn)
            if (qClean.includes('0gun') || qClean.includes('mukammaldavam') || qClean.includes('qayibsiz')) {
                const perfect = schoolData.students.filter(s => s.attendance === 0).sort((a, b) => b.average - a.average);
                let res = "üèÜ <b>M√ºk…ômm…ôl Davamiyy…ôti olan (0 qayƒ±b) N√ºmun…ôvi ≈ûagirdl…ôr:</b><br>";
                if (perfect.length > 0) {
                    perfect.slice(0, 20).forEach((s, idx) => {
                        res += `${idx + 1}. ${s.name} (${s.className})<br>`;
                    });
                    if (perfect.length > 20) res += `<small>...v…ô daha ${perfect.length - 20} n…ôf…ôr.</small>`;
                } else res += "T…ô…ôss√ºf ki, tam qayƒ±bsƒ±z ≈üagird tapƒ±lmadƒ±.";
                return res;
            }

            // --- 2. DYNAMIC SEARCH (CLASS & STUDENT) ---
            const foundClasses = schoolData.classes.filter(c => qClean.includes(heavyClean(c)));
            const matchedStudents = schoolData.students.filter(s => {
                const sClean = heavyClean(s.name);
                const tokens = rawQ.split(' ').map(t => heavyClean(t)).filter(t => t.length > 2);
                return tokens.every(t => sClean.includes(t)) || sClean.includes(qClean);
            });

            const intents = {
                attendance: qClean.includes('davam') || qClean.includes('gelme') || qClean.includes('qacir')
            };

            let responseParts = [];

            // Case: Class Search (Vertical student list)
            if (foundClasses.length > 0) {
                foundClasses.forEach(c => {
                    const d = stats.classAverages[c];
                    const cStudents = schoolData.students.filter(s => s.className === c);
                    let part = `<div class="ai-analysis-card border-success">
                        <h6 class="text-success mb-1"><b>${c} Sinfi Analizi</b></h6>
                        <div class="small text-muted mb-1">üë§ Sinif R…ôhb…ôri: <b>${CLASS_TEACHERS[c.replace('.', '')] || 'T…ôyin edilm…ôyib'}</b></div>
                        <div class="small mb-2">üìà Orta: <b>${d.average.toFixed(1)}</b> | Davamsƒ±zlƒ±q: <b>${d.attendance.toFixed(1)} g√ºn</b></div>`;

                    if (intents.attendance) {
                        const badAtt = cStudents.filter(s => s.attendance > 5).sort((a, b) => b.attendance - a.attendance);
                        part += `<div class='mt-2 border-top pt-1 small'>üö© <b>Davamsƒ±zlƒ±q (5+ g√ºn):</b><br>`;
                        badAtt.forEach(s => part += `‚Ä¢ ${s.name} (${s.attendance} g√ºn)<br>`);
                        part += `</div>`;
                    } else {
                        const sList = [...cStudents].sort((a, b) => b.average - a.average);
                        part += `<div class='mt-2 border-top pt-1 small'><b>≈ûagirdl…ôrin Siyahƒ±sƒ± (Alt-alta):</b><br>`;
                        sList.forEach((s, idx) => {
                            part += `${idx + 1}. ${s.name} - <b>${s.average.toFixed(1)}</b><br>`;
                        });
                        part += `</div>`;
                    }
                    part += `</div>`;
                    responseParts.push(part);
                });
            }

            // Case: Student Search
            if (matchedStudents.length > 0 && foundClasses.length === 0) {
                let stRes = `üë§ <b>≈ûagird Tapƒ±ldƒ± (${matchedStudents.length}):</b><br>`;
                matchedStudents.slice(0, 5).forEach(s => {
                    stRes += `<div class="ai-analysis-card">
                        <b>${s.name}</b> <small class="text-muted">(${s.className} - ${CLASS_TEACHERS[s.className.replace('.', '')] || ''})</small><br>
                        <div class="small">üéØ Bal: <b>${s.average.toFixed(1)}</b> | üö∂ Davamsƒ±zlƒ±q: <b>${s.attendance} g√ºn</b></div>
                    </div>`;
                });
                responseParts.push(stRes);
            }

            // T10: M√º…ôllim Analizi (Direct Name or Keyword)
            const teacherAnalysis = {};
            schoolData.students.forEach(student => {
                for (const subject in student.subjects) {
                    const tName = getTeacherForSubject(student, subject);
                    if (tName === 'T…ôyin edilm…ôyib') continue;
                    if (!teacherAnalysis[tName]) teacherAnalysis[tName] = { name: tName, subjects: new Set(), studentCount: 0, totalScore: 0 };
                    teacherAnalysis[tName].subjects.add(subject);
                    teacherAnalysis[tName].studentCount++;
                    teacherAnalysis[tName].totalScore += student.subjects[subject];
                }
            });

            const matchedTeacherName = Object.keys(teacherAnalysis).find(t => {
                const tNameClean = heavyClean(t);
                // Allow matching by full name or just lastname if long enough
                return qClean.includes(tNameClean) || (tNameClean.length > 5 && qClean.includes(tNameClean.split(' ').pop()));
            });

            if (matchedTeacherName && (qClean.includes('muallim') || qClean.includes('oretnmen') || qClean.length > 5)) {
                const t = teacherAnalysis[matchedTeacherName];
                const avg = (t.totalScore / t.studentCount).toFixed(1);
                return `üë®‚Äçüè´ <b>M√º…ôllim Hesabatƒ±: ${matchedTeacherName}</b><br><div class='small mt-2'>
                ‚Ä¢ T…ôdris f…ônl…ôri: <b>${Array.from(t.subjects).join(', ')}</b><br>
                ‚Ä¢ C…ômi ≈üagird: <b>${t.studentCount}</b><br>
                ‚Ä¢ Orta performans: <span class="badge ${getGradeBadgeClass(parseFloat(avg))}">${avg} bal</span><br><br>
                <button class="btn btn-sm btn-outline-primary w-100 mt-1" onclick="handleSearchResultClick('teacher', '${matchedTeacherName.replace(/'/g, "\\'")}'); toggleAIChat();">
                    <i class="fas fa-external-link-alt me-1"></i>Tam Hesabata Bax
                </button></div>`;
            }

            if (responseParts.length > 0) return responseParts.join('<br>');

            return AI_VOICE.notfound(AI_VOICE.clue);
        }

        // K√∂m…ôk√ßi funksiya: Sinif ortalamalarƒ±nƒ± hesablayƒ±r (Bunu processAIQuery-d…ôn k…ônara √ßƒ±xaraq t…ômizl…ôy…ôk)
        function getAggregatedClassStats(classes) {
            let totalAvg = 0;
            let totalAtt = 0;
            let count = 0;
            classes.forEach(c => {
                const d = schoolData.overallStats.classAverages[c];
                if (d) { totalAvg += d.average; totalAtt += d.attendance; count++; }
            });
            return { avg: totalAvg / count, att: totalAtt / count };
        }

        function calculateBestGradeLevel() {
            const gradeStats = schoolData.overallStats.gradeAverages;
            let max = 0;
            let bestGrade = "";
            for (let g in gradeStats) {
                if (gradeStats[g] > max) { max = gradeStats[g]; bestGrade = g; }
            }
            return bestGrade;
        }

        function calculateWorstAttendanceClass() {
            let worst = '';
            let max = 0;
            schoolData.classes.forEach(c => {
                const studentsInClass = schoolData.students.filter(s => s.className === c);
                if (studentsInClass.length > 0) {
                    const totalAttendance = studentsInClass.reduce((acc, s) => acc + s.attendance, 0);
                    const avg = totalAttendance / studentsInClass.length;
                    if (avg > max) { max = avg; worst = c; }
                }
            });
            return worst;
        }

        function calculateBestClassForSubject(subject) {
            let bestClass = '';
            let maxAvg = 0;
            schoolData.classes.forEach(c => {
                const students = schoolData.students.filter(s => s.className === c && s.subjects[subject] !== undefined);
                if (students.length > 0) {
                    const avg = students.reduce((acc, s) => acc + s.subjects[subject], 0) / students.length;
                    if (avg > maxAvg) {
                        maxAvg = avg;
                        bestClass = c;
                    }
                }
            });
            return bestClass || "M…ôlumat yoxdur";
        }

        function setupFilterEventListeners() {
            // ≈ûagird Analizi Filtreleri
            ['student-class-filter', 'student-sort'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.addEventListener('change', updateStudentsView);
            });
            const studentSearch = document.getElementById('student-search');
            if (studentSearch) studentSearch.addEventListener('input', updateStudentsView);

            // Davamsƒ±zlƒ±q Filtreleri
            ['attendance-class-filter', 'attendance-threshold'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.addEventListener('change', updateAttendanceView);
            });

            // F…ônn Filtreleri
            const subjectFilters = ['subject-sort', 'subject-detailed-filter', 'subject-merge-toggle'];
            subjectFilters.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.addEventListener('change', updateSubjectsView);
            });

            // Populate Subject Filter
            const subjectSelect = document.getElementById('subject-detailed-filter');
            if (subjectSelect && schoolData.subjects.length > 0) {
                schoolData.subjects.sort().forEach(s => {
                    const opt = document.createElement('option');
                    opt.value = s;
                    opt.textContent = s;
                    subjectSelect.appendChild(opt);
                });
            }

            // Merged Class Toggle
            const mergeToggle = document.getElementById('merge-classes-toggle');
            if (mergeToggle) mergeToggle.addEventListener('change', updateClassesView);

            // Comparison Merge Toggle
            const comparisonToggle = document.getElementById('comparison-merge-toggle');
            if (comparisonToggle) comparisonToggle.addEventListener('change', updateComparisonView);
        }

        // =============================================
        // GLOBAL SEARCH LOGIC
        // =============================================
        function initGlobalSearch() {
            const searchInput = document.getElementById('global-search-input');
            const searchResults = document.getElementById('search-results');

            // Keyboard Shortcuts
            document.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    openSearch();
                }
                if (e.key === 'Escape' && document.getElementById('searchOverlay').style.display === 'flex') {
                    closeSearch();
                }
            });

            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase().trim();
                if (query.length < 2) {
                    searchResults.innerHTML = '<div class="p-4 text-center text-muted">Axtarƒ±≈üa ba≈ülamaq √º√ß√ºn …ôn azƒ± 2 h…ôrf yazƒ±n...</div>';
                    return;
                }

                const results = [];

                // ≈ûagirdl…ôrd…ô axtar
                schoolData.students.forEach(s => {
                    if (s.name.toLowerCase().includes(query)) {
                        const teacher = CLASS_TEACHERS[s.className.replace('.', '')] || '';
                        results.push({ type: 'student', title: s.name, sub: `${s.className}${teacher ? ` - ${teacher}` : ''}`, id: s.id, icon: 'fa-user' });
                    }
                });

                // Sinifl…ôrd…ô axtar
                schoolData.classes.forEach(c => {
                    if (c.toLowerCase().includes(query)) {
                        const teacher = CLASS_TEACHERS[c.replace('.', '')] || '';
                        results.push({ type: 'class', title: c, sub: teacher ? `R…ôhb…ôr: ${teacher}` : 'Sinif', id: c, icon: 'fa-chalkboard' });
                    }
                });

                // F…ônl…ôrd…ô axtar
                schoolData.subjects.forEach(s => {
                    if (s.toLowerCase().includes(query)) {
                        results.push({ type: 'subject', title: s, sub: 'F…ônn', id: s, icon: 'fa-book' });
                    }
                });

                // M√º…ôlliml…ôrd…ô axtar
                const uniqueTeachers = new Set();
                Object.values(CLASS_TEACHERS).forEach(t => uniqueTeachers.add(t));
                Object.values(SUBJECT_TEACHERS).forEach(classMap => {
                    Object.values(classMap).forEach(t => uniqueTeachers.add(t));
                });
                if (typeof SUBGROUP_TEACHERS !== 'undefined') {
                    Object.values(SUBGROUP_TEACHERS).forEach(subMap => {
                        Object.values(subMap).forEach(teacherMap => {
                            Object.keys(teacherMap).forEach(t => uniqueTeachers.add(t));
                        });
                    });
                }

                uniqueTeachers.forEach(t => {
                    if (t.toLowerCase().includes(query)) {
                        results.push({ type: 'teacher', title: t, sub: 'M√º…ôllim', id: t, icon: 'fa-chalkboard-teacher' });
                    }
                });

                renderSearchResults(results.slice(0, 10));
            });
        }

        function openSearch() {
            const overlay = document.getElementById('searchOverlay');
            overlay.style.display = 'flex';
            setTimeout(() => document.getElementById('global-search-input').focus(), 100);
        }

        function closeSearch(event) {
            if (!event || event.target.id === 'searchOverlay') {
                document.getElementById('searchOverlay').style.display = 'none';
            }
        }

        function renderSearchResults(results) {
            const container = document.getElementById('search-results');
            if (results.length === 0) {
                container.innerHTML = '<div class="p-4 text-center text-muted">N…ôtic…ô tapƒ±lmadƒ±.</div>';
                return;
            }

            container.innerHTML = results.map(r => `
                <div class="search-item" onclick="handleSearchResultClick('${r.type}', '${r.id}')">
                    <i class="fas ${r.icon}"></i>
                    <div>
                        <div class="fw-bold">${r.title}</div>
                        <div class="small text-muted">${r.sub}</div>
                    </div>
                </div>
            `).join('');
        }

        function handleSearchResultClick(type, id) {
            closeSearch();
            if (type === 'student') {
                viewStudentDetails(parseInt(id));
            } else if (type === 'class') {
                showSection('classes-section');
                // Sƒ±nƒ±f analizi b√∂lm…ôsind…ô x√ºsusi bir sinif filtri yoxdur, 
                // lakin g…ôl…ôc…ôkd…ô …ôlav…ô edil…ôrs…ô bura kod yazƒ±la bil…ôr.
            } else if (type === 'subject') {
                showSection('subjects-section');
                setTimeout(() => {
                    const select = document.getElementById('subject-detailed-filter');
                    if (select) {
                        select.value = id;
                        updateSubjectsView();
                    }
                }, 100);
            } else if (type === 'teacher') {
                showSection('teachers-section');
                setTimeout(() => {
                    showTeacherDetail(id);
                }, 100);
            }
        }

        // =============================================
        // NAVIGASYON MANTIƒûI
        // =============================================
        function showSection(sectionId) {
            // T√ºm b√∂lmeleri gizle
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
                section.classList.remove('animate-fade-in');
            });

            // Hedef b√∂lmeyi g√∂ster
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.style.display = 'block';
                targetSection.classList.add('animate-fade-in');

                // Trigger animations for cards inside
                targetSection.querySelectorAll('.card, .stat-card').forEach((el, idx) => {
                    el.classList.add('animate-slide-up');
                    el.style.animationDelay = `${idx * 0.1}s`;
                });

                // B√∂lmeye √∂zel g√ºncellemeleri tetikle
                if (sectionId === 'comparison-section') updateComparisonView();
                if (sectionId === 'subjects-section') updateSubjectsView();
                if (sectionId === 'classes-section') updateClassesView();
                if (sectionId === 'export-section') generateHeatmap();
                if (sectionId === 'dashboard-section') updateDashboard();
                if (sectionId === 'attendance-section') updateAttendanceView();
                if (sectionId === 'students-section') updateStudentsView();
            }

            // Aktif linkleri g√ºncelle (nav barlar i√ßin)
            const sectionName = sectionId.replace('-section', '');
            document.querySelectorAll('.nav-link, .mobile-nav-btn, .modern-nav-btn').forEach(btn => {
                if (btn.getAttribute('data-section') === sectionName) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        // =============================================
        // THEME LOGIC
        // =============================================
        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                setTheme(savedTheme);
            } else {
                const hour = new Date().getHours();
                const isNight = hour < 7 || hour > 19;
                setTheme(isNight ? 'dark' : 'light');
            }

            // Global Chart Animation Settings
            if (window.Chart) {
                Chart.defaults.animation = {
                    duration: 1500,
                    easing: 'easeOutQuart'
                };
            }
        }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            const icon = document.querySelector('#theme-toggle i');
            if (icon) {
                icon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            }

            // Update Chart.js Defaults
            if (window.Chart) {
                const textColor = theme === 'dark' ? '#f1f5f9' : '#374151';
                const gridColor = theme === 'dark' ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';

                Chart.defaults.color = textColor;
                // Add scale overrides
                Chart.defaults.scales = Chart.defaults.scales || {};
                if (Chart.defaults.scales.linear) {
                    Chart.defaults.scales.linear.grid = Chart.defaults.scales.linear.grid || {};
                    Chart.defaults.scales.linear.grid.color = gridColor;
                }
            }

            // Re-render all charts to apply new theme colors
            if (schoolData.overallStats.totalStudents > 0) {
                updateDashboard();
                updateStudentsView();
                updateAttendanceView();
                updateSubjectsView();
                updateClassesView();
                updateComparisonView();

                // Update teacher view if active
                if (document.getElementById('teachers-section').style.display !== 'none') {
                    updateTeachersView();
                }
            }
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            setTheme(currentTheme === 'dark' ? 'light' : 'dark');
        }

        // Mobil nav pozisyonunu ayarla
        function adjustMobileNavPosition() {
            // Disabled: Using CSS-only bottom navigation
        }

        // =============================================
        // G√ñM√úL√ú VERƒ∞LERƒ∞ Y√úKLE
        // =============================================
        function loadEmbeddedData() {
            console.log('üìä G√∂m√ºl√º veriler y√ºkleniyor...');

            // T√ºm sheet'leri i≈üle
            for (const [sheetName, sheetData] of Object.entries(embeddedExcelData)) {
                processSheetData(sheetData, sheetName);
            }

            // Verileri analiz et
            analyzeData();

            console.log('‚úÖ Veriler ba≈üarƒ±yla y√ºklendi!');
            console.log(`   Toplam √∂ƒürenci: ${schoolData.students.length}`);
            console.log(`   Sƒ±nƒ±flar: ${schoolData.classes.join(', ')}`);
            console.log(`   Dersler: ${schoolData.subjects.length} adet`);
        }

        // =============================================
        // EXCEL SHEET VERƒ∞LERƒ∞Nƒ∞ ƒ∞≈ûLE
        // =============================================
        function processSheetData(sheetData, sheetName) {
            if (!sheetData || sheetData.length < 2) return;

            const headers = sheetData[0];
            const rows = sheetData.slice(1);

            rows.forEach((row, index) => {
                if (row.length < 3) return;

                const student = {
                    id: schoolData.students.length + 1,
                    name: row[0] || '',
                    className: (row[1] || '').replace('.', ''),
                    attendance: parseInt(row[2]) || 0,
                    gradeLevel: getGradeLevel(row[1]),
                    sheetName: sheetName,
                    subjects: {}
                };

                // Ders notlarƒ±nƒ± parse et
                for (let i = 3; i < headers.length; i++) {
                    if (i < row.length) {
                        const subject = headers[i];
                        const grade = parseFloat(row[i]) || 0;
                        student.subjects[subject] = grade;
                    }
                }

                // √ñƒürenci ortalamasƒ±nƒ± hesapla
                const grades = Object.values(student.subjects).filter(g => !isNaN(g));
                student.average = grades.length > 0 ?
                    grades.reduce((a, b) => a + b, 0) / grades.length : 0;

                // En iyi ve en k√∂t√º dersleri bul
                const subjectEntries = Object.entries(student.subjects);
                if (subjectEntries.length > 0) {
                    subjectEntries.sort((a, b) => b[1] - a[1]);
                    student.bestSubject = subjectEntries[0][0];
                    student.bestGrade = subjectEntries[0][1];
                    student.worstSubject = subjectEntries[subjectEntries.length - 1][0];
                    student.worstGrade = subjectEntries[subjectEntries.length - 1][1];
                }

                // Durumu belirle
                if (student.average >= 91) student.status = '∆èla (Y√ºks…ôk)';
                else if (student.average >= 81) student.status = '∆èla';
                else if (student.average >= 61) student.status = 'Yax≈üƒ±';
                else if (student.average >= 31) student.status = 'Kafi';
                else student.status = 'Z…ôif';

                // Davamsƒ±zlƒ±k durumunu belirle
                if (student.attendance === 0) student.attendanceStatus = 'M√ºk…ômm…ôl';
                else if (student.attendance <= 4) student.attendanceStatus = 'Yax≈üƒ±';
                else if (student.attendance <= 9) student.attendanceStatus = 'Orta';
                else if (student.attendance <= 14) student.attendanceStatus = 'Y√ºks…ôk';
                else student.attendanceStatus = 'T…ôhl√ºk…ôli';

                schoolData.students.push(student);
            });
        }

        // =============================================
        // SINIF SEVƒ∞YESƒ∞Nƒ∞ BELƒ∞RLE
        // =============================================
        function getGradeLevel(className) {
            if (!className) return '';
            const match = className.match(/(\d+)/);
            if (match) {
                return parseInt(match[1]);
            }
            return '';
        }

        // =============================================
        // VERƒ∞LERƒ∞ ANALƒ∞Z ET
        // =============================================
        function analyzeData() {
            // Benzersiz sƒ±nƒ±flarƒ± √ßƒ±kar
            const classSet = new Set();

            // 2-9 sinifl…ôrin hamƒ±sƒ±nƒ± (A v…ô B paralell…ôri) …ôvv…ôlc…ôd…ôn …ôlav…ô ed…ôk (C…ômi 16 sinif)
            for (let grade = 2; grade <= 9; grade++) {
                classSet.add(`${grade}A`);
                classSet.add(`${grade}B`);
            }

            schoolData.students.forEach(s => classSet.add(s.className));
            schoolData.classes = Array.from(classSet).sort((a, b) => {
                const gradeA = parseInt(a);
                const gradeB = parseInt(b);
                if (gradeA !== gradeB) return gradeA - gradeB;
                return a.localeCompare(b);
            });

            // T√ºm dersleri topla
            const allSubjects = new Set();
            schoolData.students.forEach(student => {
                Object.keys(student.subjects).forEach(subject => {
                    allSubjects.add(subject);
                });
            });
            schoolData.subjects = Array.from(allSubjects).sort();

            // Genel istatistikleri hesapla
            calculateOverallStats();

            // T√ºm g√∂r√ºn√ºmleri g√ºncelle
            // G√∂r√ºn√ºmleri g√ºncelle
            updateDashboard();
            updateStudentsView();
            updateAttendanceView();
            updateSubjectsView();
            updateClassesView();
            updateComparisonView();

            // Yeni Professional G√∂r√ºn√ºml…ôr
            generateHeatmap();
            updateImpactAnalysis();
            updateFilters();
        }

        // =============================================
        // GENEL ƒ∞STATƒ∞STƒ∞KLERƒ∞ HESAPLA
        // =============================================
        function calculateOverallStats() {
            const stats = {
                totalStudents: schoolData.students.length,
                totalClasses: schoolData.classes.length,
                totalSubjects: schoolData.subjects.length,
                overallAverage: 0,
                averageAttendance: 0,
                classAverages: {},
                subjectAverages: {},
                gradeAverages: {},
                attendanceStats: {
                    excellent: 0,
                    good: 0,
                    medium: 0,
                    high: 0,
                    dangerous: 0
                },
                warningStudents: 0
            };

            // Genel ortalama
            const allAverages = schoolData.students.map(s => s.average).filter(a => !isNaN(a));
            stats.overallAverage = allAverages.length > 0 ?
                allAverages.reduce((a, b) => a + b, 0) / allAverages.length : 0;

            // Davamsƒ±zlƒ±k istatistikleri
            const allAttendance = schoolData.students.map(s => s.attendance).filter(a => !isNaN(a));
            stats.averageAttendance = allAttendance.length > 0 ?
                allAttendance.reduce((a, b) => a + b, 0) / allAttendance.length : 0;

            // Davamsƒ±zlƒ±k kategorileri
            schoolData.students.forEach(student => {
                if (student.attendance === 0) stats.attendanceStats.excellent++;
                else if (student.attendance <= 4) stats.attendanceStats.good++;
                else if (student.attendance <= 9) stats.attendanceStats.medium++;
                else if (student.attendance <= 14) stats.attendanceStats.high++;
                else stats.attendanceStats.dangerous++;
            });

            // Diqq…ôt lazƒ±m olan ≈üagirdl…ôr
            stats.warningStudents = schoolData.students.filter(s =>
                s.average < 50 || s.attendance >= 10
            ).length;

            // Sƒ±nƒ±f ortalamalarƒ±
            schoolData.classes.forEach(className => {
                const classStudents = schoolData.students.filter(s => s.className === className);
                const classAverages = classStudents.map(s => s.average).filter(a => !isNaN(a));
                const classAttendance = classStudents.map(s => s.attendance).filter(a => !isNaN(a));

                stats.classAverages[className] = {
                    average: classAverages.length > 0 ?
                        classAverages.reduce((a, b) => a + b, 0) / classAverages.length : 0,
                    attendance: classAttendance.length > 0 ?
                        classAttendance.reduce((a, b) => a + b, 0) / classAttendance.length : 0,
                    studentCount: classStudents.length
                };
            });

            // Ders ortalamalarƒ±
            schoolData.subjects.forEach(subject => {
                const allGrades = schoolData.students.map(s => s.subjects[subject]).filter(g => !isNaN(g));
                stats.subjectAverages[subject] = allGrades.length > 0 ?
                    allGrades.reduce((a, b) => a + b, 0) / allGrades.length : 0;

                // Sƒ±nƒ±f seviyesine g√∂re ders ortalamalarƒ±
                stats.subjectAverages[subject + '_byGrade'] = {};
                for (let grade = 2; grade <= 9; grade++) {
                    const gradeStudents = schoolData.students.filter(s => s.gradeLevel === grade);
                    const gradeGrades = gradeStudents.map(s => s.subjects[subject]).filter(g => !isNaN(g));
                    if (gradeGrades.length > 0) {
                        stats.subjectAverages[subject + '_byGrade'][grade] =
                            gradeGrades.reduce((a, b) => a + b, 0) / gradeGrades.length;
                    }
                }
            });

            // Sƒ±nƒ±f seviyesi ortalamalarƒ±
            for (let grade = 2; grade <= 9; grade++) {
                const gradeStudents = schoolData.students.filter(s => s.gradeLevel === grade);
                const gradeAverages = gradeStudents.map(s => s.average).filter(a => !isNaN(a));
                if (gradeAverages.length > 0) {
                    stats.gradeAverages[grade] = gradeAverages.reduce((a, b) => a + b, 0) / gradeAverages.length;
                }
            }

            schoolData.overallStats = stats;

            // Quick stats'i g√ºncelle
            const quickTotalStudents = document.getElementById('quick-total-students');
            if (quickTotalStudents) quickTotalStudents.textContent = stats.totalStudents;

            const quickTotalClasses = document.getElementById('quick-total-classes');
            if (quickTotalClasses) quickTotalClasses.textContent = stats.totalClasses;
        }

        // =============================================
        // DASHBOARD'U G√úNCELLE
        // =============================================
        function updateDashboard() {
            const stats = schoolData.overallStats;

            // ƒ∞statistik kartlarƒ±nƒ± g√ºncelle
            document.getElementById('total-students').textContent = stats.totalStudents;
            document.getElementById('total-classes-info').textContent = `${stats.totalClasses} sinif`;
            document.getElementById('overall-average').textContent = stats.overallAverage.toFixed(1);
            document.getElementById('avg-attendance').textContent = stats.averageAttendance.toFixed(1);
            document.getElementById('warning-students').textContent = stats.warningStudents;

            // Trend bilgileri
            const avgAttendance = stats.averageAttendance;
            let attendanceStatus = 'Yax≈üƒ±';
            if (avgAttendance <= 3) attendanceStatus = 'M√ºk…ômm…ôl';
            else if (avgAttendance <= 6) attendanceStatus = 'Yax≈üƒ±';
            else if (avgAttendance <= 10) attendanceStatus = 'Orta';
            else attendanceStatus = 'Narahatlƒ±q doƒüurur';

            document.getElementById('attendance-status').textContent = attendanceStatus;
            document.getElementById('warning-info').textContent = `${stats.warningStudents} ≈üagird n…ôz…ôr…ô alƒ±nmalƒ±dƒ±r`;

            // Grafikleri g√ºncelle
            updateSubjectAvgChart();
            updateAttendanceChart();

            // Listeleri g√ºncelle
            updateTopStudentsList();
            updateWarningStudentsList();
            updateLowestStudentsList();
            updateHighestAttendanceStudentsList();
        }

        // =============================================
        // DERS ORTALAMALARI GRAFƒ∞ƒûƒ∞
        // =============================================
        function updateSubjectAvgChart() {
            const canvas = document.getElementById('subjectAvgChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const stats = schoolData.overallStats;

            if (!stats || !schoolData.subjects) return;

            const subjects = schoolData.subjects;
            const averages = subjects.map(subject => stats.subjectAverages[subject] || 0);

            const sortedIndices = averages.map((_, i) => i)
                .sort((a, b) => averages[b] - averages[a])
                .slice(0, 8);

            const sortedSubjects = sortedIndices.map(i => subjects[i]);
            const sortedAverages = sortedIndices.map(i => averages[i]);

            if (charts.subjectAvgChart) {
                charts.subjectAvgChart.destroy();
            }

            // Create Gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(0, 173, 186, 0.8)');
            gradient.addColorStop(1, 'rgba(0, 82, 93, 0.5)');

            charts.subjectAvgChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedSubjects,
                    datasets: [{
                        label: 'Ortalama Bal',
                        data: sortedAverages,
                        backgroundColor: sortedAverages.map(avg => {
                            if (avg >= 91) return 'rgba(4, 120, 87, 0.85)';
                            if (avg >= 81) return 'rgba(16, 185, 129, 0.85)';
                            if (avg >= 61) return 'rgba(0, 173, 186, 0.85)';
                            if (avg >= 31) return 'rgba(245, 158, 11, 0.85)';
                            return 'rgba(239, 68, 68, 0.85)';
                        }),
                        borderColor: sortedAverages.map(avg => {
                            if (avg >= 91) return 'rgb(4, 120, 87)';
                            if (avg >= 81) return 'rgb(16, 185, 129)';
                            if (avg >= 61) return 'rgb(0, 173, 186)';
                            if (avg >= 31) return 'rgb(245, 158, 11)';
                            return 'rgb(239, 68, 68)';
                        }),
                        borderWidth: 1,
                        borderRadius: 6,
                        hoverBackgroundColor: 'rgba(0, 173, 186, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            titleFont: { size: 14, family: "'Poppins', sans-serif" },
                            bodyFont: { size: 13 },
                            callbacks: {
                                label: function (context) {
                                    return ` Ortalama: ${context.raw.toFixed(1)} bal`;
                                },
                                afterLabel: function (context) {
                                    const subject = context.label;
                                    const studentCount = schoolData.students.filter(s => s.subjects[subject] !== undefined).length;
                                    return ` ≈ûagird sayƒ±: ${studentCount}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        // =============================================
        // DAVAMSIZLIK GRAFƒ∞ƒûƒ∞
        // =============================================
        function updateAttendanceChart() {
            const ctx = document.getElementById('attendanceChart').getContext('2d');
            const stats = schoolData.overallStats.attendanceStats;

            const data = {
                excellent: stats.excellent,
                good: stats.good,
                medium: stats.medium,
                high: stats.high,
                dangerous: stats.dangerous
            };

            if (charts.attendanceChart) {
                charts.attendanceChart.destroy();
            }

            charts.attendanceChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['M√ºk…ômm…ôl (0 g√ºn)', 'Yax≈üƒ± (1-4 g√ºn)', 'Orta (5-9 g√ºn)', 'Y√ºks…ôk (10-14 g√ºn)', 'T…ôhl√ºk…ôli (15+ g√ºn)'],
                    datasets: [{
                        data: Object.values(data),
                        backgroundColor: [
                            'rgba(79, 209, 197, 0.8)',
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(139, 92, 246, 0.8)'
                        ],
                        borderColor: [
                            'rgb(79, 209, 197)',
                            'rgb(16, 185, 129)',
                            'rgb(245, 158, 11)',
                            'rgb(239, 68, 68)',
                            'rgb(139, 92, 246)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} ≈üagird (${percentage}%)`;
                                }
                            }
                        },
                        colors: {
                            forceOverride: true
                        }
                    }
                }
            });
        }

        // =============================================
        // EN ƒ∞Yƒ∞ √ñƒûRENCƒ∞LER Lƒ∞STESƒ∞
        // =============================================
        function updateTopStudentsList() {
            const topStudents = [...schoolData.students]
                .sort((a, b) => b.average - a.average)
                .slice(0, 5);

            const container = document.getElementById('top-students-list');
            container.innerHTML = '';

            if (topStudents.length === 0) {
                container.innerHTML = '<p class="text-muted">M…ôlumat yoxdur</p>';
                return;
            }

            topStudents.forEach((student, index) => {
                const medal = ['ü•á', 'ü•à', 'ü•â', '4.', '5.'][index];
                const studentEl = document.createElement('div');
                studentEl.className = 'd-flex justify-content-between align-items-center mb-2 p-2 border rounded';
                studentEl.innerHTML = `
                    <div class="d-flex align-items-center">
                        <span class="fs-5 me-2">${medal}</span>
                        <div>
                            <strong style="cursor: pointer; color: var(--primary-blue);" onclick="viewStudentDetails(${student.id})">${student.name}</strong><br>
                            <small class="text-muted">${student.className} (${CLASS_TEACHERS[student.className.replace('.', '')] || 'T…ôyin edilm…ôyib'}) | Ortalama: ${student.average.toFixed(1)} | Davamsƒ±zlƒ±q: ${student.attendance} g√ºn</small>
                        </div>
                    </div>
                    <span class="badge ${getStatusBadgeClass(student.status)}">${student.status}</span>
                `;
                container.appendChild(studentEl);
            });
        }

        // =============================================
        // Dƒ∞QQ∆èT LAZIM OLANLAR Lƒ∞STESƒ∞
        // =============================================
        function updateWarningStudentsList() {
            const warningStudents = [...schoolData.students]
                .filter(s => s.average < 50 || s.attendance >= 10)
                .sort((a, b) => {
                    if (a.average < 50 && b.average < 50) {
                        return a.average - b.average;
                    }
                    if (a.attendance >= 10 && b.attendance >= 10) {
                        return b.attendance - a.attendance;
                    }
                    return (a.average < 50 ? 0 : 1) - (b.average < 50 ? 0 : 1);
                })
                .slice(0, 5);

            const container = document.getElementById('warning-students-list');
            container.innerHTML = '';

            if (warningStudents.length === 0) {
                container.innerHTML = '<div class="text-center p-3"><i class="fas fa-check-circle fa-2x text-success mb-2"></i><p>T…ôbrikl…ôr! Diqq…ôt lazƒ±m olan ≈üagird yoxdur.</p></div>';
                return;
            }

            warningStudents.forEach((student, index) => {
                const reason = student.average < 50 ? 'A≈üaƒüƒ± ortalama' : 'Y√ºks…ôk davamsƒ±zlƒ±q';
                const studentEl = document.createElement('div');
                studentEl.className = 'd-flex justify-content-between align-items-center mb-2 p-2 border rounded';
                studentEl.innerHTML = `
                    <div>
                        <strong style="cursor: pointer; color: var(--primary-blue);" onclick="viewStudentDetails(${student.id})">${student.name}</strong><br>
                        <small class="text-muted">${student.className} (${CLASS_TEACHERS[student.className.replace('.', '')] || 'T…ôyin edilm…ôyib'}) | ${reason}</small>
                    </div>
                    <div class="text-end">
                        <div class="badge ${student.average < 50 ? 'bg-danger' : 'bg-warning'}">
                            ${student.average < 50 ? student.average.toFixed(1) : student.attendance + ' g√ºn'}
                        </div>
                        <div><small>${student.average < 50 ? 'Ortalama' : 'Davamsƒ±zlƒ±q'}</small></div>
                    </div>
                `;
                container.appendChild(studentEl);
            });
        }

        // =============================================
        // ∆èN A≈ûAƒûI N∆èTƒ∞C∆èLƒ∞ ≈ûAGƒ∞RDL∆èR Lƒ∞STESƒ∞
        // =============================================
        function updateLowestStudentsList() {
            const lowestStudents = [...schoolData.students]
                .sort((a, b) => a.average - b.average)
                .slice(0, 5);

            const container = document.getElementById('lowest-students-list');
            if (!container) return;
            container.innerHTML = '';

            lowestStudents.forEach((student, index) => {
                const studentEl = document.createElement('div');
                studentEl.className = 'd-flex justify-content-between align-items-center mb-2 p-2 border rounded';
                studentEl.innerHTML = `
                    <div>
                        <strong style="cursor: pointer; color: var(--primary-blue);" onclick="viewStudentDetails(${student.id})">${student.name}</strong><br>
                        <small class="text-muted">${student.className} | Ortalama: <b>${student.average.toFixed(1)}</b></small>
                    </div>
                    <span class="badge bg-danger">${student.average.toFixed(1)}</span>
                `;
                container.appendChild(studentEl);
            });
        }

        // =============================================
        // ∆èN √áOX DAVAMSIZLIQ ED∆èN ≈ûAGƒ∞RDL∆èR Lƒ∞STESƒ∞
        // =============================================
        function updateHighestAttendanceStudentsList() {
            const highAttStudents = [...schoolData.students]
                .sort((a, b) => b.attendance - a.attendance)
                .slice(0, 5);

            const container = document.getElementById('highest-attendance-list');
            if (!container) return;
            container.innerHTML = '';

            highAttStudents.forEach((student, index) => {
                const studentEl = document.createElement('div');
                studentEl.className = 'd-flex justify-content-between align-items-center mb-2 p-2 border rounded';
                studentEl.innerHTML = `
                    <div>
                        <strong style="cursor: pointer; color: var(--primary-blue);" onclick="viewStudentDetails(${student.id})">${student.name}</strong><br>
                        <small class="text-muted">${student.className} | Davamsƒ±zlƒ±q: <b>${student.attendance} g√ºn</b></small>
                    </div>
                    <span class="badge bg-dark">${student.attendance} g√ºn</span>
                `;
                container.appendChild(studentEl);
            });
        }

        // =============================================
        // Fƒ∞LTRELERƒ∞ G√úNCELLE
        // =============================================
        function updateFilters() {
            // Sƒ±nƒ±f filtrelerini g√ºncelle
            const classFilters = [
                'student-class-filter',
                'attendance-class-filter'
            ];

            classFilters.forEach(filterId => {
                const select = document.getElementById(filterId);
                if (!select) return;
                select.innerHTML = '<option value="all">Hamƒ±sƒ±</option>';

                // Sƒ±nƒ±flarƒ± grupla
                const classGroups = {};
                schoolData.classes.forEach(className => {
                    const gradeLevel = getGradeLevel(className);
                    if (!classGroups[gradeLevel]) {
                        classGroups[gradeLevel] = [];
                    }
                    classGroups[gradeLevel].push(className);
                });

                // Her sƒ±nƒ±f seviyesi i√ßin optgroup olu≈ütur
                Object.keys(classGroups).sort().forEach(gradeLevel => {
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = `${gradeLevel}-ci sinif`;

                    classGroups[gradeLevel].sort().forEach(className => {
                        const option = document.createElement('option');
                        option.value = className;
                        option.textContent = className;
                        optgroup.appendChild(option);
                    });

                    select.appendChild(optgroup);
                });
            });
        }

        // =============================================
        // √ñƒûRENCƒ∞ G√ñR√úN√úM√úN√ú G√úNCELLE
        // =============================================
        function updateStudentsView() {
            const tableBody = document.getElementById('students-table-body');
            tableBody.innerHTML = '';

            const classFilter = document.getElementById('student-class-filter').value;
            const searchTerm = document.getElementById('student-search').value.toLowerCase();
            const sortBy = document.getElementById('student-sort').value;

            let filteredStudents = schoolData.students;

            // Filtreleri uygula
            if (classFilter !== 'all') {
                filteredStudents = filteredStudents.filter(s => s.className === classFilter);
            }

            if (searchTerm) {
                filteredStudents = filteredStudents.filter(s =>
                    s.name.toLowerCase().includes(searchTerm)
                );
            }

            // Sƒ±ralamayƒ± uygula
            if (sortBy === 'name') {
                filteredStudents.sort((a, b) => a.name.localeCompare(b.name));
            } else if (sortBy === 'average_desc') {
                filteredStudents.sort((a, b) => b.average - a.average);
            } else if (sortBy === 'average_asc') {
                filteredStudents.sort((a, b) => a.average - b.average);
            } else if (sortBy === 'attendance_desc') {
                filteredStudents.sort((a, b) => b.attendance - a.attendance);
            } else if (sortBy === 'attendance_asc') {
                filteredStudents.sort((a, b) => a.attendance - b.attendance);
            }

            // Sayacƒ± g√ºncelle
            document.getElementById('student-count').textContent = `${filteredStudents.length} ≈üagird`;

            // Tabloyu doldur
            filteredStudents.forEach((student, index) => {
                const row = document.createElement('tr');

                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="student-photo">
                                <img src="https://i.imgur.com/a3FuVV8.png" 
                                     alt="IMSA Logo"
                                     onerror="this.onerror=null; this.src='https://placehold.co/36x36/00525d/ffffff?text=IMSA';">
                            </div>
                            <div class="ms-2">
                                <strong style="cursor: pointer; color: var(--primary-blue);" onclick="viewStudentDetails(${student.id})">${student.name}</strong><br>
                                <small class="text-muted">${student.bestSubject || '-'}: ${student.bestGrade || 0}</small>
                            </div>
                        </div>
                    </td>
                    <td><span class="badge bg-primary">${student.className}</span><div class="small text-muted" style="font-size: 0.7rem;">${CLASS_TEACHERS[student.className.replace('.', '')] || ''}</div></td>
                    <td>
                        <div class="d-flex align-items-center">
                            <strong>${student.average.toFixed(1)}</strong>
                            <div class="progress progress-custom ms-2" style="width: 50px;">
                                <div class="progress-bar ${getProgressBarClass(student.average)}" 
                                     style="width: ${student.average}%"></div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="attendance-badge ${getAttendanceClass(student.attendance)}">
                            ${student.attendance} g√ºn
                        </span>
                    </td>
                    <td>
                        <span class="badge ${getStatusBadgeClass(student.status)}">
                            ${student.status}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" 
                                onclick="viewStudentDetails(${student.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // =============================================
        // DAVAMSIZLIK G√ñR√úN√úM√úN√ú G√úNCELLE
        // =============================================
        function updateAttendanceView() {
            const tableBody = document.getElementById('attendance-table-body');
            tableBody.innerHTML = '';

            const classFilter = document.getElementById('attendance-class-filter').value;
            const threshold = parseInt(document.getElementById('attendance-threshold').value);

            let filteredStudents = schoolData.students;

            // Filtreleri uygula
            if (classFilter !== 'all') {
                filteredStudents = filteredStudents.filter(s => s.className === classFilter);
            }

            // E≈üik deƒüerine g√∂re filtrele
            filteredStudents = filteredStudents.filter(s => s.attendance >= threshold);

            // Davamsƒ±zlƒ±ƒüa g√∂re sƒ±rala (y√ºksekten d√º≈ü√ºƒüe)
            filteredStudents.sort((a, b) => b.attendance - a.attendance);

            // ƒ∞statistikleri g√ºncelle
            updateAttendanceStats(filteredStudents);

            // Tabloyu doldur
            filteredStudents.forEach((student, index) => {
                const row = document.createElement('tr');

                let impact = 'A≈üaƒüƒ±';
                if (student.attendance >= 15) impact = '√áox y√ºks…ôk';
                else if (student.attendance >= 10) impact = 'Y√ºks…ôk';
                else if (student.attendance >= 5) impact = 'Orta';

                row.innerHTML = `
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="student-photo me-2">
                                <img src="https://i.imgur.com/a3FuVV8.png" 
                                     alt="IMSA Logo"
                                     onerror="this.onerror=null; this.src='https://placehold.co/36x36/00525d/ffffff?text=IMSA';">
                            </div>
                            <strong>${student.name}</strong>
                        </div>
                    </td>
                    <td><span class="badge bg-primary">${student.className}</span><div class="small text-muted" style="font-size: 0.7rem;">${CLASS_TEACHERS[student.className.replace('.', '')] || ''}</div></td>
                    <td>
                        <span class="attendance-badge ${getAttendanceClass(student.attendance)}">
                            <i class="fas fa-calendar-times me-1"></i>${student.attendance} g√ºn
                        </span>
                    </td>
                    <td>
                        <div class="d-flex align-items-center">
                            <strong>${student.average.toFixed(1)}</strong>
                            <div class="progress progress-custom ms-2" style="width: 50px;">
                                <div class="progress-bar ${getProgressBarClass(student.average)}" 
                                     style="width: ${student.average}%"></div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="badge ${getAttendanceStatusBadgeClass(student.attendanceStatus)}">
                            ${student.attendanceStatus}
                        </span>
                    </td>
                    <td>
                        <span class="badge ${impact === '√áox y√ºks…ôk' ? 'bg-danger' : impact === 'Y√ºks…ôk' ? 'bg-warning' : 'bg-info'}">
                            ${impact}
                        </span>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            // Sayacƒ± g√ºncelle
            document.getElementById('attendance-count').textContent = `${filteredStudents.length} ≈üagird`;

            // Sƒ±nƒ±f bazlƒ± davamsƒ±zlƒ±k grafiƒüini g√ºncelle
            updateClassAttendanceChart();
        }

        // =============================================
        // DAVAMSIZLIK ƒ∞STATƒ∞STƒ∞KLERƒ∞Nƒ∞ G√úNCELLE
        // =============================================
        function updateAttendanceStats(students) {
            let good = 0, medium = 0, high = 0;

            students.forEach(student => {
                if (student.attendance <= 4) good++;
                else if (student.attendance <= 9) medium++;
                else high++;
            });

            document.getElementById('good-attendance-count').textContent = good;
            document.getElementById('medium-attendance-count').textContent = medium;
            document.getElementById('high-attendance-count').textContent = high;
        }

        // =============================================
        // SINIF BAZLI DAVAMSIZLIK GRAFƒ∞ƒûƒ∞
        // =============================================
        function updateClassAttendanceChart() {
            const canvas = document.getElementById('classAttendanceChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const stats = schoolData.overallStats;

            const classNames = schoolData.classes;
            const attendanceAverages = classNames.map(className => stats.classAverages[className]?.attendance || 0);

            if (charts.classAttendanceChart) {
                charts.classAttendanceChart.destroy();
            }

            charts.classAttendanceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: classNames,
                    datasets: [{
                        label: 'Orta Davamsƒ±zlƒ±q (g√ºn)',
                        data: attendanceAverages,
                        backgroundColor: attendanceAverages.map(avg => {
                            if (avg <= 3) return 'rgba(79, 209, 197, 0.7)';
                            if (avg <= 6) return 'rgba(16, 185, 129, 0.7)';
                            if (avg <= 10) return 'rgba(245, 158, 11, 0.7)';
                            return 'rgba(239, 68, 68, 0.7)';
                        }),
                        borderColor: attendanceAverages.map(avg => {
                            if (avg <= 3) return 'rgb(79, 209, 197)';
                            if (avg <= 6) return 'rgb(16, 185, 129)';
                            if (avg <= 10) return 'rgb(245, 158, 11)';
                            return 'rgb(239, 68, 68)';
                        }),
                        borderWidth: 1,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `Orta Davamsƒ±zlƒ±q: ${context.parsed.y.toFixed(1)} g√ºn`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Davamsƒ±zlƒ±q (g√ºn)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Sinifl…ôr'
                            }
                        }
                    }
                }
            });
        }

        // =============================================
        // F∆èNN G√ñR√úN√úM√úN√ú G√úNCELLE
        // =============================================
        // =============================================
        // F∆èNN G√ñR√úN√úM√úN√ú G√úNCELLE
        // =============================================
        function updateSubjectsView() {
            const tableBody = document.getElementById('subjects-table-body');
            const tableHead = document.querySelector('#subjects-table thead tr');
            tableBody.innerHTML = '';

            const detailedFilter = document.getElementById('subject-detailed-filter').value;
            const isMerged = document.getElementById('subject-merge-toggle').checked;
            const sortBy = document.getElementById('subject-sort').value;

            const stats = schoolData.overallStats;

            if (detailedFilter === 'all') {
                // VIEW 1: ALL SUBJECTS OVERVIEW (Original View)
                // Restore headers if needed
                tableHead.innerHTML = `
                    <th>F…ônn Adƒ±</th>
                    <th>√úmumi Orta</th>
                    <th>2-ci</th>
                    <th>3-c√º</th>
                    <th>4-c√º</th>
                    <th>5-ci</th>
                    <th>6-cƒ±</th>
                    <th>7-ci</th>
                    <th>8-ci</th>
                    <th>9-cu</th>
                    <th>Uƒüur Faizi</th>
                `;

                schoolData.subjects.forEach(subject => {
                    const avg = stats.subjectAverages[subject] || 0;
                    const row = document.createElement('tr');

                    let gradeCells = '';
                    let successCount = 0;
                    let totalCount = 0;

                    for (let grade = 2; grade <= 9; grade++) {
                        const gradeAvg = stats.subjectAverages[subject + '_byGrade']?.[grade];
                        const val = gradeAvg !== undefined ? gradeAvg.toFixed(1) : '-';
                        gradeCells += `<td>${val}</td>`;

                        if (gradeAvg !== undefined) {
                            if (gradeAvg >= 50) successCount++;
                            totalCount++;
                        }
                    }

                    // Simple success rate calc based on class averages (can be improved)
                    const successRate = totalCount > 0 ? Math.round((successCount / totalCount) * 100) : 0;

                    row.innerHTML = `
                        <td><strong>${subject}</strong></td>
                        <td><span class="badge ${getGradeBadgeClass(avg)}">${avg.toFixed(1)}</span></td>
                        ${gradeCells}
                        <td>
                            <div class="progress progress-custom" style="height: 20px;">
                                <div class="progress-bar ${successRate >= 80 ? 'bg-success' : successRate >= 60 ? 'bg-primary' : 'bg-warning'}" 
                                     style="width: ${successRate}%"></div>
                            </div>
                            <small class="d-block text-center mt-1">${successRate}%</small>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });

                updateSubjectComparisonChart(); // Default chart
                document.getElementById('subject-student-ranking-container').style.display = 'none';

            } else {
                // VIEW 2: SINGLE SUBJECT BREAKDOWN BY CLASS
                const subjectName = detailedFilter;

                // Update Headers
                tableHead.innerHTML = `
                    <th>Sinif</th>
                    <th>≈ûagird Sayƒ±</th>
                    <th>Ortalama</th>
                    <th>Status</th>
                    <th>Max/Min</th>
                `;

                let classesData = [];

                if (isMerged) {
                    // Merged: Group by Grade Level (2, 3, 4...)
                    for (let grade = 2; grade <= 9; grade++) {
                        const gradeStudents = schoolData.students.filter(s => s.gradeLevel === grade && s.subjects[subjectName] !== undefined);
                        if (gradeStudents.length > 0) {
                            const avg = gradeStudents.reduce((a, s) => a + s.subjects[subjectName], 0) / gradeStudents.length;
                            const grades = gradeStudents.map(s => s.subjects[subjectName]);
                            classesData.push({
                                className: `${grade}-ci sinifl…ôr`,
                                count: gradeStudents.length,
                                average: avg,
                                max: Math.max(...grades),
                                min: Math.min(...grades)
                            });
                        }
                    }
                } else {
                    // Unmerged: Show individual classes (2A, 2B...)
                    schoolData.classes.forEach(c => {
                        const classStudents = schoolData.students.filter(s => s.className === c && s.subjects[subjectName] !== undefined);
                        if (classStudents.length > 0) {
                            const avg = classStudents.reduce((a, s) => a + s.subjects[subjectName], 0) / classStudents.length;
                            const grades = classStudents.map(s => s.subjects[subjectName]);
                            classesData.push({
                                className: c,
                                count: classStudents.length,
                                average: avg,
                                max: Math.max(...grades),
                                min: Math.min(...grades)
                            });
                        }
                    });
                }

                // Sort Logic
                if (sortBy === 'average_desc') classesData.sort((a, b) => b.average - a.average);
                else if (sortBy === 'average_asc') classesData.sort((a, b) => a.average - b.average);
                else classesData.sort((a, b) => a.className.localeCompare(b.className)); // Name sort

                // Render Rows
                // Render Rows
                classesData.forEach(d => {
                    const row = document.createElement('tr');

                    let statusHtml = '';
                    if (d.average >= 81) statusHtml = '<span class="text-success fw-bold">∆èla</span>';
                    else if (d.average >= 61) statusHtml = '<span class="text-primary fw-bold">Yax≈üƒ±</span>';
                    else if (d.average >= 31) statusHtml = '<span class="text-warning fw-bold">Kafi</span>';
                    else statusHtml = '<span class="text-danger fw-bold">Pis</span>';

                    row.innerHTML = `
                        <td><strong>${d.className}</strong><br><small class="text-muted" style="font-size: 0.7rem;">${CLASS_TEACHERS[d.className.replace('.', '')] || ''}</small></td>
                        <td>${d.count}</td>
                        <td><span class="badge ${getGradeBadgeClass(d.average)}">${d.average.toFixed(1)}</span></td>
                        <td>${statusHtml}</td>
                        <td><small class="text-muted">Max: ${d.max} | Min: ${d.min}</small></td>
                    `;
                    tableBody.appendChild(row);
                });

                // Update Chart for Detailed View
                updateDetailedSubjectChart(subjectName, classesData);

                // Initialize Student Ranking Section
                const rankingContainer = document.getElementById('subject-student-ranking-container');
                rankingContainer.style.display = 'block';

                const classDropdown = document.getElementById('subject-student-class-dropdown');
                const dropdownButton = document.getElementById('classFilterDropdownButton');

                // Get classes that have this subject
                const relevantClasses = new Set();
                schoolData.students.forEach(s => {
                    if (s.subjects[subjectName] !== undefined && !isNaN(s.subjects[subjectName])) {
                        relevantClasses.add(s.className);
                    }
                });

                classDropdown.innerHTML = '';

                // Add "All" option back
                const liAll = document.createElement('li');
                liAll.innerHTML = `
                    <label class="dropdown-item d-flex align-items-center cursor-pointer py-1 px-2 mb-0 fw-bold border-bottom">
                        <input class="form-check-input class-filter-checkbox me-2 mt-0" type="checkbox" value="all" id="class-filter-all" checked onchange="handleClassFilterChange(this)">
                        <span>B√ºt√ºn Sinifl…ôr</span>
                    </label>
                `;
                classDropdown.appendChild(liAll);

                const sortedClasses = Array.from(relevantClasses).sort();

                sortedClasses.forEach((c, idx) => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                         <label class="dropdown-item d-flex align-items-center cursor-pointer py-1 px-2 mb-0">
                            <input class="form-check-input class-filter-checkbox me-2 mt-0" type="checkbox" value="${c}" checked onchange="handleClassFilterChange(this)">
                            <span class="text-truncate">${c}</span>
                        </label>
                    `;
                    classDropdown.appendChild(li);
                });

                // Reset button text
                const span = dropdownButton.querySelector('span');
                if (span) span.textContent = 'B√ºt√ºn Sinifl…ôr';

                updateSubjectStudentRankings();
            }

            // Stats card updates (generic)
            const subjectTotalCountEl = document.getElementById('subject-total-count');
            if (subjectTotalCountEl) subjectTotalCountEl.textContent = schoolData.subjects.length;

            // Update best/worst subject cards
            const subAvgs = schoolData.subjects.map(s => ({ name: s, avg: stats.subjectAverages[s] || 0 }));
            if (subAvgs.length > 0) {
                subAvgs.sort((a, b) => b.avg - a.avg);
                const bestSubEl = document.getElementById('best-subject');
                const worstSubEl = document.getElementById('worst-subject');
                if (bestSubEl) bestSubEl.textContent = subAvgs[0].name;
                if (worstSubEl) worstSubEl.textContent = subAvgs[subAvgs.length - 1].name;
            }
        }

        function handleClassFilterChange(checkbox) {
            const container = document.getElementById('subject-student-class-dropdown');
            const checkboxes = container.querySelectorAll('.class-filter-checkbox');
            const allCheckbox = document.getElementById('class-filter-all');
            const dropdownButton = document.getElementById('classFilterDropdownButton');
            const span = dropdownButton.querySelector('span');

            if (checkbox.value === 'all') {
                const isChecked = checkbox.checked;
                checkboxes.forEach(cb => {
                    cb.checked = isChecked;
                });
            } else {
                const individualCheckboxes = Array.from(checkboxes).filter(cb => cb.value !== 'all');
                const allChecked = individualCheckboxes.every(cb => cb.checked);
                if (allCheckbox) allCheckbox.checked = allChecked;
            }

            const checkedClasses = Array.from(checkboxes).filter(cb => cb.checked && cb.value !== 'all');
            const totalClasses = Array.from(checkboxes).filter(cb => cb.value !== 'all').length;

            if (checkedClasses.length === 0) {
                span.textContent = 'He√ß biri se√ßilm…ôyib';
            } else if (checkedClasses.length === totalClasses) {
                span.textContent = 'B√ºt√ºn Sinifl…ôr';
            } else if (checkedClasses.length === 1) {
                span.textContent = checkedClasses[0].value;
            } else {
                span.textContent = `${checkedClasses.length} sinif se√ßildi`;
            }
        }

        function updateSubjectStudentRankings() {
            const subject = document.getElementById('subject-detailed-filter').value;
            const sortOrder = document.getElementById('subject-student-sort-filter').value;

            // Get selected classes from the specific dropdown
            const container = document.getElementById('subject-student-class-dropdown');
            const selectedClasses = Array.from(container.querySelectorAll('.class-filter-checkbox:checked'))
                .map(cb => cb.value);

            const tbody = document.getElementById('subject-student-table-body');

            if (subject === 'all') return;

            tbody.innerHTML = '<tr><td colspan="5" class="text-center">Y√ºkl…ônir...</td></tr>';

            // Filter students
            let students = schoolData.students.filter(s =>
                s.subjects[subject] !== undefined &&
                s.subjects[subject] !== null &&
                !isNaN(s.subjects[subject])
            );

            // Filter by selected classes
            if (selectedClasses.length === 0) {
                students = [];
            } else {
                students = students.filter(s => selectedClasses.includes(s.className));
            }

            // Sort logic
            students.sort((a, b) => {
                const valA = a.subjects[subject];
                const valB = b.subjects[subject];
                if (sortOrder === 'asc') {
                    return valA - valB;
                } else {
                    return valB - valA;
                }
            });

            tbody.innerHTML = '';

            if (students.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted">M…ôlumat tapƒ±lmadƒ±</td></tr>';
                return;
            }

            students.forEach((s, i) => {
                const grade = s.subjects[subject];

                // Determine badge color
                let badgeClass = 'bg-danger';
                if (grade >= 91) badgeClass = 'bg-dark-green';
                else if (grade >= 81) badgeClass = 'bg-success';
                else if (grade >= 61) badgeClass = 'bg-info text-dark';
                else if (grade >= 31) badgeClass = 'bg-warning text-dark';

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${i + 1}</td>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="student-photo me-2" style="width:30px;height:30px;">
                                <img src="https://i.imgur.com/a3FuVV8.png" 
                                     onerror="this.onerror=null; this.src='https://placehold.co/30x30/00525d/ffffff?text=IMSA';">
                            </div>
                            <strong style="cursor: pointer; color: var(--primary-blue);" onclick="viewStudentDetails(${s.id})">${s.name}</strong>
                        </div>
                    </td>
                    <td><span class="badge bg-secondary">${s.className}</span></td>
                    <td><span class="badge ${badgeClass}" style="font-size: 0.9rem;">${grade}</span></td>
                    <td>
                        ${grade >= 50
                        ? '<span class="text-success"><i class="fas fa-check-circle me-1"></i>Ke√ßdi</span>'
                        : '<span class="text-danger"><i class="fas fa-times-circle me-1"></i>K…ôsildi</span>'}
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function updateDetailedSubjectChart(subject, data) {
            const canvas = document.getElementById('subjectComparisonChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            if (charts.subjectComparisonChart) charts.subjectComparisonChart.destroy();

            charts.subjectComparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.className),
                    datasets: [{
                        label: `${subject} Ortalamasƒ±`,
                        data: data.map(d => d.average),
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `Ortala: ${context.parsed.y.toFixed(1)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: { beginAtZero: true, max: 100 }
                    }
                }
            });
        }

        // =============================================
        // F∆èNN M√úQAYƒ∞S∆è GRAFƒ∞ƒûƒ∞
        // =============================================
        function updateSubjectComparisonChart() {
            const canvas = document.getElementById('subjectComparisonChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const stats = schoolData.overallStats;

            const subjects = schoolData.subjects.slice(0, 10); // ƒ∞lk 10 f…ônni g√∂st…ôr
            const averages = subjects.map(subject => stats.subjectAverages[subject] || 0);

            if (charts.subjectComparisonChart) {
                charts.subjectComparisonChart.destroy();
            }

            charts.subjectComparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: subjects,
                    datasets: [{
                        label: 'Ortalama',
                        data: averages,
                        backgroundColor: averages.map(avg => {
                            if (avg >= 91) return 'rgba(4, 120, 87, 0.8)';
                            if (avg >= 81) return 'rgba(16, 185, 129, 0.8)';
                            if (avg >= 61) return 'rgba(0, 173, 186, 0.8)';
                            if (avg >= 31) return 'rgba(245, 158, 11, 0.8)';
                            return 'rgba(239, 68, 68, 0.8)';
                        }),
                        borderColor: averages.map(avg => {
                            if (avg >= 91) return 'rgb(4, 120, 87)';
                            if (avg >= 81) return 'rgb(16, 185, 129)';
                            if (avg >= 61) return 'rgb(0, 173, 186)';
                            if (avg >= 31) return 'rgb(245, 158, 11)';
                            return 'rgb(239, 68, 68)';
                        }),
                        borderWidth: 1,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `Ortalama: ${context.parsed.y.toFixed(1)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Ortalama'
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }

        // =============================================
        // SINIF G√ñR√úN√úM√úN√ú G√úNCELLE
        // =============================================
        function updateClassesView() {
            const tableBody = document.getElementById('classes-table-body');
            const topClassesList = document.getElementById('top-classes-list');
            const isMerged = document.getElementById('merge-classes-toggle').checked;

            tableBody.innerHTML = '';
            topClassesList.innerHTML = '';

            const stats = schoolData.overallStats;
            let classDataList = [];

            if (isMerged) {
                // Group by grade
                const gradeGroups = {};
                schoolData.classes.forEach(className => {
                    const grade = getGradeLevel(className);
                    if (!gradeGroups[grade]) {
                        gradeGroups[grade] = {
                            name: grade + "-ci sinifl…ôr",
                            students: []
                        };
                    }
                    const classStudents = schoolData.students.filter(s => s.className === className);
                    gradeGroups[grade].students.push(...classStudents);
                });

                Object.values(gradeGroups).forEach(group => {
                    if (group.students.length > 0) {
                        const avg = group.students.reduce((acc, s) => acc + s.average, 0) / group.students.length;
                        const att = group.students.reduce((acc, s) => acc + s.attendance, 0) / group.students.length;
                        classDataList.push({
                            className: group.name,
                            average: avg,
                            attendance: att,
                            studentCount: group.students.length,
                            students: group.students
                        });
                    }
                });
            } else {
                // Individual classes
                schoolData.classes.forEach(className => {
                    const classData = stats.classAverages[className];
                    if (classData) {
                        const classStudents = schoolData.students.filter(s => s.className === className);
                        classDataList.push({
                            className: className,
                            average: classData.average,
                            attendance: classData.attendance,
                            studentCount: classData.studentCount,
                            students: classStudents
                        });
                    }
                });
            }

            // Sort by average desc
            classDataList.sort((a, b) => b.average - a.average);

            // Show top 3
            classDataList.slice(0, 3).forEach((cls, index) => {
                const medal = ['ü•á', 'ü•à', 'ü•â'][index];
                const classEl = document.createElement('div');
                classEl.className = 'd-flex justify-content-between align-items-center mb-2 p-2 border rounded';
                classEl.innerHTML = `
                    <div class="d-flex align-items-center">
                        <span class="fs-5 me-2">${medal}</span>
                        <div>
                            <strong>${cls.className}</strong><br>
                            <small class="text-muted">Ortalama: ${cls.average.toFixed(1)} | ≈ûagird: ${cls.studentCount}</small>
                        </div>
                    </div>
                    <span class="badge ${getProgressBarClass(cls.average)}">
                        ${cls.average.toFixed(1)}
                    </span>
                `;
                topClassesList.appendChild(classEl);
            });

            // Fill Table
            classDataList.forEach(cls => {
                const classStudents = cls.students;

                // Find best/worst subject
                let bestSubject = '';
                let bestAvg = 0;
                let worstSubject = '';
                let worstAvg = 100;

                schoolData.subjects.forEach(subject => {
                    const subjectGrades = classStudents.map(s => s.subjects[subject]).filter(g => !isNaN(g));
                    if (subjectGrades.length > 0) {
                        const avg = subjectGrades.reduce((a, b) => a + b, 0) / subjectGrades.length;
                        if (avg > bestAvg) {
                            bestAvg = avg;
                            bestSubject = subject;
                        }
                        if (avg < worstAvg) {
                            worstAvg = avg;
                            worstSubject = subject;
                        }
                    }
                });

                // Success rate
                const successRate = classStudents.length > 0 ?
                    (classStudents.filter(s => s.average >= 50).length / classStudents.length * 100).toFixed(1) : '0.0';

                // Status
                let status = 'Yax≈üƒ±';
                if (cls.average >= 91) status = '∆èla (Y√ºks…ôk)';
                else if (cls.average >= 81) status = '∆èla';
                else if (cls.average >= 61) status = 'Yax≈üƒ±';
                else if (cls.average >= 31) status = 'Kafi';
                else status = 'Z…ôif';

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <strong>${cls.className}</strong><br>
                        <small class="text-muted" style="font-size: 0.75rem;">
                            <i class="fas fa-user-tie me-1"></i>${CLASS_TEACHERS[cls.className.replace('.', '')] || (isMerged ? 'M√ºxt…ôlif' : 'T…ôyin edilm…ôyib')}
                        </small>
                    </td>
                    <td>${cls.studentCount}</td>
                    <td>
                        <span class="badge ${getGradeBadgeClass(cls.average)}">
                            ${cls.average.toFixed(1)}
                        </span>
                    </td>
                    <td>
                        <span class="attendance-badge ${getAttendanceClass(cls.attendance)}">
                            ${cls.attendance.toFixed(1)} g√ºn
                        </span>
                    </td>
                    <td>${bestSubject || '-'} (${bestAvg.toFixed(1)})</td>
                    <td>${worstSubject || '-'} (${worstAvg.toFixed(1)})</td>
                    <td>
                        <div class="progress progress-custom" style="height: 20px;">
                            <div class="progress-bar ${successRate >= 80 ? 'bg-success' : successRate >= 60 ? 'bg-primary' : 'bg-warning'}" 
                                 style="width: ${successRate}%"></div>
                        </div>
                        <small class="d-block text-center mt-1">${successRate}%</small>
                    </td>
                    <td>
                        <span class="badge ${getStatusBadgeClass(status)}">
                            ${status}
                        </span>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            // Update Chart
            updateClassAvgChart(classDataList);
        }

        // =============================================
        // SINIF ORTALAMALARI GRAFƒ∞ƒûƒ∞
        // =============================================
        function updateClassAvgChart(dataList) {
            const canvas = document.getElementById('classAvgChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');

            // If called without data (initial load), create default data
            if (!dataList) {
                const stats = schoolData.overallStats;
                dataList = schoolData.classes.map(className => {
                    const cData = stats.classAverages[className];
                    return {
                        className: className,
                        average: cData ? cData.average : 0,
                        attendance: cData ? cData.attendance : 0
                    };
                });
            }

            const labels = dataList.map(d => d.className);
            const averages = dataList.map(d => d.average);
            const attendances = dataList.map(d => d.attendance);

            if (charts.classAvgChart) {
                charts.classAvgChart.destroy();
            }

            charts.classAvgChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Sinif Ortalamasƒ±',
                            data: averages,
                            backgroundColor: 'rgba(0, 82, 93, 0.7)',
                            borderColor: 'rgb(0, 82, 93)',
                            borderWidth: 1,
                            borderRadius: 5,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Orta Davamsƒ±zlƒ±q (g√ºn)',
                            data: attendances,
                            type: 'line',
                            borderColor: 'rgba(239, 68, 68, 0.8)',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.4,
                            pointRadius: 4,
                            pointBackgroundColor: 'rgba(239, 68, 68, 1)',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            titleColor: '#333',
                            bodyColor: '#333',
                            borderColor: '#ddd',
                            borderWidth: 1,
                            padding: 10,
                            callbacks: {
                                label: function (context) {
                                    let label = context.dataset.label || '';
                                    if (label) label += ': ';
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y.toFixed(1);
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            max: 100,
                            title: { display: true, text: 'Ortalama' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            grid: { drawOnChartArea: false },
                            title: { display: true, text: 'Davamsƒ±zlƒ±q (g√ºn)' }
                        },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        // =============================================
        // M√úQAYƒ∞S∆è G√ñR√úN√úM√úN√ú G√úNCELLE
        // =============================================
        function updateComparisonView() {
            const tableBody = document.getElementById('comparison-table-body');
            const tableHead = document.querySelector('#comparison-table thead tr');

            tableBody.innerHTML = '';

            const isMerged = document.getElementById('comparison-merge-toggle')?.checked ?? true;
            const stats = schoolData.overallStats;

            // Kar≈üƒ±la≈ütƒ±rma verilerini hazƒ±rla (Satƒ±rlar)
            const comparisonData = [
                { label: '√úmumi Orta', values: [] },
                { label: '≈ûagird Sayƒ±', values: [] },
                { label: 'Davamsƒ±zlƒ±q (orta)', values: [] },
                { label: 'Uƒüurlu ≈ûagird (%)', values: [] },
                { label: '∆èla N…ôtic…ô (%)', values: [] }
            ];

            let entities = [];
            let headerHtml = '<th>G√∂st…ôrici</th>';

            if (isMerged) {
                // MERGED: By Grade Level (2-9)
                for (let grade = 2; grade <= 9; grade++) {
                    entities.push({ name: `${grade}-ci Sinif`, id: grade, type: 'grade' });
                    headerHtml += `<th>${grade}-ci Sinif</th>`;
                }
            } else {
                // UNMERGED: By Individual Class (2A, 2B...)
                schoolData.classes.forEach(cls => {
                    const teacher = CLASS_TEACHERS[cls.replace('.', '')] || '';
                    entities.push({ name: cls, id: cls, type: 'class', teacher: teacher });
                    headerHtml += `<th>${cls}${teacher ? `<br><small class='fw-normal' style='font-size: 0.7rem;'>${teacher}</small>` : ''}</th>`;
                });
            }
            headerHtml += '<th>Qalib</th>';
            tableHead.innerHTML = headerHtml;

            // Verileri topla
            entities.forEach(entity => {
                let students = [];
                if (entity.type === 'grade') {
                    students = schoolData.students.filter(s => s.gradeLevel === entity.id);
                } else {
                    students = schoolData.students.filter(s => s.className === entity.id);
                }

                if (students.length > 0) {
                    // Ortalama
                    const averages = students.map(s => s.average).filter(a => !isNaN(a));
                    const avg = averages.length > 0 ? averages.reduce((a, b) => a + b, 0) / averages.length : 0;
                    comparisonData[0].values.push(avg.toFixed(1));

                    // √ñƒürenci sayƒ±
                    comparisonData[1].values.push(students.length);

                    // Davamsƒ±zlƒ±k
                    const attendances = students.map(s => s.attendance).filter(a => !isNaN(a));
                    const attAvg = attendances.length > 0 ? attendances.reduce((a, b) => a + b, 0) / attendances.length : 0;
                    comparisonData[2].values.push(attAvg.toFixed(1));

                    // Ba≈üarƒ± oranƒ± (%50 √ºst√º)
                    const successRate = (students.filter(s => s.average >= 50).length / students.length * 100).toFixed(1);
                    comparisonData[3].values.push(successRate);

                    // M√ºkemmel oranƒ± (%85 √ºst√º)
                    const excellentRate = (students.filter(s => s.average >= 85).length / students.length * 100).toFixed(1);
                    comparisonData[4].values.push(excellentRate);
                } else {
                    // Veri yoksa bo≈ü deƒüerler
                    comparisonData.forEach(data => data.values.push('-'));
                }
            });

            // Tabloyu doldur
            comparisonData.forEach(rowData => {
                const row = document.createElement('tr');
                let cells = `<td><strong>${rowData.label}</strong></td>`;

                // En y√ºksek deƒüeri bul
                let maxValue = -1;
                let maxIndex = -1;
                let minValue = 99999;
                let minIndex = -1;

                if (rowData.label !== '≈ûagird Sayƒ±') {
                    rowData.values.forEach((value, index) => {
                        if (value !== '-') {
                            const val = parseFloat(value);
                            if (val > maxValue) { maxValue = val; maxIndex = index; }
                            if (val < minValue) { minValue = val; minIndex = index; }
                        }
                    });
                }

                // Determine winner index (Highest for grades, Lowest for attendance)
                let winnerIndex = (rowData.label.includes('Davamsƒ±zlƒ±q')) ? minIndex : maxIndex;

                // H√ºcreleri olu≈ütur
                rowData.values.forEach((value, index) => {
                    let cellClass = '';
                    if (index === winnerIndex && winnerIndex !== -1 && rowData.label !== '≈ûagird Sayƒ±') {
                        cellClass = 'bg-success text-white fw-bold';
                    }

                    // Add tooltip title for easier reading
                    let headerName = 'N/A';
                    let teacherName = '';
                    if (entities[index]) {
                        headerName = entities[index].name;
                        teacherName = entities[index].teacher || '';
                    }

                    cells += `<td class="${cellClass}" data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="top" title="<div class='text-center'><strong>${headerName}</strong>${teacherName ? `<br><small>${teacherName}</small>` : ''}<br>${rowData.label}: ${value}</div>">${value}</td>`;
                });

                // Kazanan sƒ±nƒ±fƒ± ekle
                let winnerName = '-';
                if (winnerIndex !== -1 && rowData.label !== '≈ûagird Sayƒ±') {
                    winnerName = entities[winnerIndex].name;
                }
                cells += `<td><span class="badge bg-success">${winnerName}</span></td>`;

                row.innerHTML = cells;
                tableBody.appendChild(row);
            });

            // Initialize Bootstrap Tooltips
            setTimeout(() => {
                const tooltipTriggerList = [].slice.call(document.querySelectorAll('#comparison-table [data-bs-toggle="tooltip"]'));
                tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl);
                });
            }, 100);

            // Grafikleri g√ºncelle (Sadece merged state i√ßin varsayƒ±lan grafikleri tutuyoruz, isterseniz burayƒ± da dinamikle≈ütirebiliriz ama tablo √∂ncelikliydi)
            updateGradeComparisonChart(); // Keep grade chart for now or update if needed
            updateAttendanceCorrelationChart();
        }

        // =============================================
        // SINIF SEVƒ∞YESƒ∞ KAR≈ûILA≈ûTIRMA GRAFƒ∞ƒûƒ∞
        // =============================================
        function updateGradeComparisonChart() {
            const ctx = document.getElementById('gradeComparisonChart').getContext('2d');
            const stats = schoolData.overallStats;

            const grades = [2, 3, 4, 5, 6, 7, 8, 9];
            const averages = grades.map(grade => stats.gradeAverages[grade] || 0);

            if (charts.gradeComparisonChart) {
                charts.gradeComparisonChart.destroy();
            }

            charts.gradeComparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: grades.map(g => `${g}-ci sinif`),
                    datasets: [{
                        label: 'Ortalama',
                        data: averages,
                        backgroundColor: averages.map(avg => {
                            if (avg >= 91) return 'rgba(4, 120, 87, 0.8)';
                            if (avg >= 81) return 'rgba(16, 185, 129, 0.8)';
                            if (avg >= 61) return 'rgba(0, 173, 186, 0.8)';
                            if (avg >= 31) return 'rgba(245, 158, 11, 0.8)';
                            return 'rgba(239, 68, 68, 0.8)';
                        }),
                        borderColor: averages.map(avg => {
                            if (avg >= 91) return 'rgb(4, 120, 87)';
                            if (avg >= 81) return 'rgb(16, 185, 129)';
                            if (avg >= 61) return 'rgb(0, 173, 186)';
                            if (avg >= 31) return 'rgb(245, 158, 11)';
                            return 'rgb(239, 68, 68)';
                        }),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        colors: {
                            forceOverride: true
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `Ortalama: ${context.parsed.y}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Ortalama'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Sinif S…ôviyy…ôsi'
                            }
                        }
                    }
                }
            });
        }

        // =============================================
        // DAVAMSIZLIK VE ORTALAMA ƒ∞Lƒ∞≈ûKƒ∞Sƒ∞ GRAFƒ∞ƒûƒ∞
        // =============================================
        function updateAttendanceCorrelationChart() {
            const ctx = document.getElementById('attendanceCorrelationChart').getContext('2d');

            // √ñƒürencilerin davamsƒ±zlƒ±k ve ortalama verilerini al
            const dataPoints = schoolData.students.map(student => ({
                x: student.attendance,
                y: student.average,
                studentName: student.name,
                className: student.className
            }));

            if (charts.attendanceCorrelationChart) {
                charts.attendanceCorrelationChart.destroy();
            }

            charts.attendanceCorrelationChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: '≈ûagirdl…ôr',
                        data: dataPoints,
                        backgroundColor: 'rgba(0, 82, 93, 0.6)',
                        borderColor: 'rgb(0, 82, 93)',
                        borderWidth: 1,
                        pointRadius: 5,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'nearest',
                        axis: 'xy',
                        intersect: false // Allow finding nearest point without being exactly on top
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const point = context.raw;
                                    return `${point.studentName} (${point.className}): ${point.y.toFixed(1)} ortalama, ${point.x} g√ºn`;
                                }
                            }
                        },
                        colors: {
                            forceOverride: true
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Davamsƒ±zlƒ±q (g√ºn)'
                            },
                            beginAtZero: true
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Ortalama'
                            },
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        // =============================================
        // YARDIMCI FONKSƒ∞YONLAR
        // =============================================
        function getStatusBadgeClass(status) {
            switch (status) {
                case '∆èla (Y√ºks…ôk)': return 'bg-dark-green';
                case '∆èla': return 'bg-success';
                case 'Yax≈üƒ±': return 'bg-primary'; // Mavi
                case 'Kafi': return 'bg-warning'; // Sarƒ±
                case 'Z…ôif': return 'bg-danger';  // Qƒ±rmƒ±zƒ±
                default: return 'bg-secondary';
            }
        }

        function getAttendanceClass(attendance) {
            if (attendance === 0) return 'attendance-excellent';
            if (attendance <= 4) return 'attendance-good';
            if (attendance <= 9) return 'attendance-medium';
            return 'attendance-low';
        }

        function getAttendanceStatusBadgeClass(status) {
            switch (status) {
                case 'M√ºk…ômm…ôl': return 'bg-success';
                case 'Yax≈üƒ±': return 'bg-primary';
                case 'Orta': return 'bg-warning';
                case 'Y√ºks…ôk': return 'bg-danger';
                case 'T…ôhl√ºk…ôli': return 'bg-dark';
                default: return 'bg-secondary';
            }
        }

        function getProgressBarClass(value) {
            if (value >= 91) return 'bg-dark-green';
            if (value >= 81) return 'bg-success';
            if (value >= 61) return 'bg-primary';
            if (value >= 31) return 'bg-warning';
            return 'bg-danger';
        }

        function getGradeBadgeClass(grade) {
            if (grade >= 91) return 'bg-dark-green';
            if (grade >= 81) return 'bg-success';
            if (grade >= 61) return 'bg-primary';
            if (grade >= 31) return 'bg-warning';
            return 'bg-danger';
        }

        // =============================================
        // √ñƒûRENCƒ∞ DETAYLARINI G√ñSTER
        // =============================================
        function viewStudentDetails(studentId) {
            const student = schoolData.students.find(s => s.id === studentId);
            if (!student) return;

            const modalElement = document.getElementById('studentModal');
            const modal = new bootstrap.Modal(modalElement);
            document.getElementById('studentModalTitle').textContent = student.name;

            // √ñƒürenci detaylarƒ±nƒ± olu≈ütur
            let detailsHTML = `
                <div class="row">
                    <div class="col-md-4 text-center">
                        <div class="student-photo mx-auto" style="width: 100px; height: 100px;">
                            <img src="https://i.imgur.com/a3FuVV8.png" 
                                 alt="IMSA Logo"
                                 onerror="this.onerror=null; this.src='https://placehold.co/100x100/00525d/ffffff?text=IMSA';">
                        </div>
                        <h4 class="mt-3">${student.name}</h4>
                        <div class="mb-2">
                            <span class="badge bg-primary fs-6">${student.className}</span>
                        </div>
                        <div class="text-muted small">
                            <i class="fas fa-user-tie me-1"></i>Sinif R…ôhb…ôri:<br>
                            <strong>${CLASS_TEACHERS[student.className.replace('.', '')] || 'T…ôyin edilm…ôyib'}</strong>
                        </div>
                    </div>
                    
                    <div class="col-md-8">
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <div class="card bg-light-custom">
                                    <div class="card-body text-center p-2">
                                        <h6 class="text-muted">√úmumi Orta</h6>
                                        <h3 class="${getTextColorClass(student.average)} mb-1">${student.average.toFixed(1)}</h3>
                                        <span class="badge ${getStatusBadgeClass(student.status)}">
                                            ${student.status}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-light-custom">
                                    <div class="card-body text-center p-2">
                                        <h6 class="text-muted">Davamsƒ±zlƒ±q</h6>
                                        <h3 class="${student.attendance <= 4 ? 'text-success' : student.attendance <= 9 ? 'text-warning' : 'text-danger'} mb-1">${student.attendance}</h3>
                                        <span class="badge ${getAttendanceStatusBadgeClass(student.attendanceStatus)}">
                                            ${student.attendanceStatus}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-light-custom">
                                    <div class="card-body text-center p-2">
                                        <h6 class="text-muted">F…ônn Sayƒ±</h6>
                                        <h3 class="mb-1">${Object.keys(student.subjects).length}</h3>
                                        <small class="text-muted">Qiym…ôt veril…ôn</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <hr>
                
                <div class="row mt-3">
                    <div class="col-md-6 mb-3">
                        <div class="card border-success h-100">
                            <div class="card-body py-2">
                                <h6 class="text-success"><i class="fas fa-trophy me-2"></i>∆èn Yax≈üƒ± F…ônn</h6>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>${student.bestSubject}</span>
                                    <span class="badge bg-success fs-6">${student.bestGrade}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card border-danger h-100">
                            <div class="card-body py-2">
                                <h6 class="text-danger"><i class="fas fa-exclamation-triangle me-2"></i>∆èn A≈üaƒüƒ± F…ônn</h6>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>${student.worstSubject}</span>
                                    <span class="badge bg-danger fs-6">${student.worstGrade}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert ${student.attendance >= 10 ? 'alert-warning' : 'alert-info'} mt-2 py-2">
                    <h6 class="mb-1"><i class="fas fa-lightbulb me-2"></i>T√∂vsiy…ô</h6>
                    <p class="mb-0 small">
                        ${getStudentRecommendations(student)}
                    </p>
                </div>

                <div class="mt-4">
                    <h6 class="mb-3 text-primary"><i class="fas fa-chalkboard-teacher me-2"></i>F…ônn M√º…ôlliml…ôri</h6>
                    <div class="table-responsive" style="max-height: 250px; overflow-y: auto;">
                        <table class="table table-sm table-hover border small align-middle">
                            <thead class="sticky-top bg-white border-bottom shadow-sm">
                                <tr>
                                    <th>F…ônn</th>
                                    <th>M√º…ôllim</th>
                                    <th class="text-center">Qiym…ôt</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${Object.keys(student.subjects).sort().map(subject => `
                                    <tr>
                                        <td class="fw-semibold">${subject}</td>
                                        <td class="text-muted"><i class="fas fa-user-circle me-1"></i>${getTeacherForSubject(student, subject)}</td>
                                        <td class="text-center"><span class="badge ${getGradeBadgeClass(student.subjects[subject])}">${student.subjects[subject]}</span></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            document.getElementById('studentModalBody').innerHTML = detailsHTML;
            modal.show();

            // Render Radar Chart after modal is shown
            setTimeout(() => {
                drawStudentRadarChart(student);
            }, 500);
        }

        // =============================================
        // RADAR QRAFƒ∞Kƒ∞ √á∆èK
        // =============================================
        function drawStudentRadarChart(student) {
            const ctx = document.getElementById('studentRadarChart').getContext('2d');

            const labels = Object.keys(student.subjects);
            const data = Object.values(student.subjects);

            if (charts.studentRadarChart) {
                charts.studentRadarChart.destroy();
            }

            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            const color = isDark ? 'rgba(79, 209, 197, 0.6)' : 'rgba(0, 82, 93, 0.6)';
            const borderColor = isDark ? 'rgb(79, 209, 197)' : 'rgb(0, 82, 93)';
            const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
            const textColor = isDark ? '#f1f5f9' : '#374151';

            charts.studentRadarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Qiym…ôtl…ôr',
                        data: data,
                        fill: true,
                        backgroundColor: color,
                        borderColor: borderColor,
                        pointBackgroundColor: borderColor,
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: borderColor
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: {
                        line: {
                            borderWidth: 3
                        }
                    },
                    scales: {
                        r: {
                            angleLines: {
                                color: gridColor
                            },
                            grid: {
                                color: gridColor
                            },
                            pointLabels: {
                                color: textColor,
                                font: {
                                    size: 11,
                                    family: "'Poppins', sans-serif"
                                }
                            },
                            ticks: {
                                backdropColor: 'transparent',
                                color: textColor,
                                beginAtZero: true,
                                max: 100,
                                stepSize: 20
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        colors: {
                            forceOverride: true
                        }
                    }
                }
            });
        }

        function getStudentRecommendations(student) {
            let recommendations = [];

            if (student.average < 50) {
                recommendations.push(`${student.worstSubject} f…ônnind…ô x√ºsusi diqq…ôt yetirin.`);
            }

            if (student.attendance >= 5) {
                recommendations.push(`Davamsƒ±zlƒ±ƒüƒ±nƒ±z (${student.attendance} g√ºn) n…ôz…ôr…ô alƒ±nmalƒ±dƒ±r.`);
            }

            if (student.average >= 85 && student.attendance <= 4) {
                recommendations.push(`∆èla n…ôtic…ô! Davam edin.`);
            }

            if (recommendations.length === 0) {
                return "≈ûagirdin performansƒ± q…ôna…ôtb…ôx≈üdir. Davam etsin.";
            }

            return recommendations.join(' ');
        }

        function getTextColorClass(value) {
            if (value >= 91) return 'text-dark-green';
            if (value >= 81) return 'text-success';
            if (value >= 61) return 'text-primary';
            if (value >= 31) return 'text-warning';
            return 'text-danger';
        }

        // =============================================
        // ƒ∞HRAC FONKSƒ∞YONLAR
        // =============================================
        function exportPDF() {
            // PDF ixraci √º√ß√ºn b√ºt√ºn gizli b√∂lm…ôl…ôri m√ºv…ôqq…ôti aktivl…ô≈üdir…ôk ki, hamƒ±sƒ± √ßap olunsun
            const allSections = document.querySelectorAll('.content-section');
            const originalDisplays = [];

            allSections.forEach(section => {
                originalDisplays.push(section.style.display);
                section.style.display = 'block';
            });

            // Gec…ô rejimind…ôdirs…ô i≈üƒ±qlƒ± rejim…ô ke√ß…ôk (√ßap √º√ß√ºn daha yax≈üƒ±dƒ±r)
            const currentTheme = document.documentElement.getAttribute('data-theme');
            if (currentTheme === 'dark') {
                setTheme('light');
            }

            window.print();

            // Geri qaytaraq
            allSections.forEach((section, i) => {
                section.style.display = originalDisplays[i];
            });

            if (currentTheme === 'dark') {
                setTheme('dark');
            }
        }

        function exportExcel() {
            try {
                // Analiz √ßalƒ±≈üma sayfasƒ± olu≈ütur
                const analysisData = [
                    ['IMSA M…ôkt…ôbi - Analiz Raporu'],
                    ['Rapor tarixi:', new Date().toLocaleDateString('az-AZ')],
                    ['√úmumi ≈üagird sayƒ±:', schoolData.students.length],
                    ['Sinif sayƒ±:', schoolData.classes.length],
                    ['F…ônn sayƒ±:', schoolData.subjects.length],
                    ['√úmumi ortalama:', schoolData.overallStats.overallAverage.toFixed(2)],
                    ['Orta davamsƒ±zlƒ±q:', schoolData.overallStats.averageAttendance.toFixed(2)],
                    [],
                    ['Davamsƒ±zlq Statistikasƒ±'],
                    ['Kateqoriya', '≈ûagird sayƒ±', 'Faiz']
                ];

                // Davamsƒ±zlƒ±k istatistiklerini ekle
                const attendanceStats = schoolData.overallStats.attendanceStats;
                const total = schoolData.students.length;

                analysisData.push(['M√ºk…ômm…ôl (0 g√ºn)', attendanceStats.excellent, ((attendanceStats.excellent / total) * 100).toFixed(2) + '%']);
                analysisData.push(['Yax≈üƒ± (1-4 g√ºn)', attendanceStats.good, ((attendanceStats.good / total) * 100).toFixed(2) + '%']);
                analysisData.push(['Orta (5-9 g√ºn)', attendanceStats.medium, ((attendanceStats.medium / total) * 100).toFixed(2) + '%']);
                analysisData.push(['Y√ºks…ôk (10-14 g√ºn)', attendanceStats.high, ((attendanceStats.high / total) * 100).toFixed(2) + '%']);
                analysisData.push(['T…ôhl√ºk…ôli (15+ g√ºn)', attendanceStats.dangerous, ((attendanceStats.dangerous / total) * 100).toFixed(2) + '%']);

                analysisData.push([], ['Sinif Statistikasƒ±']);
                analysisData.push(['Sinif', '≈ûagird sayƒ±', 'Ortalama', 'Davamsƒ±zlƒ±q (orta)', 'Uƒüur nisb…ôti (%)']);

                // Sƒ±nƒ±f istatistiklerini ekle
                schoolData.classes.forEach(className => {
                    const classStudents = schoolData.students.filter(s => s.className === className);
                    const average = calculateAverage(classStudents.map(s => s.average));
                    const attendanceAvg = calculateAverage(classStudents.map(s => s.attendance));
                    const successRate = (classStudents.filter(s => s.average >= 50).length / classStudents.length * 100);

                    analysisData.push([
                        className,
                        classStudents.length,
                        average.toFixed(2),
                        attendanceAvg.toFixed(2),
                        successRate.toFixed(2)
                    ]);
                });

                analysisData.push([], ['F…ônn Statistikasƒ±']);
                analysisData.push(['F…ônn', '√úmumi orta', '∆èn y√ºks…ôk', '∆èn a≈üaƒüƒ±', 'Uƒüur nisb…ôti (%)']);

                // Ders istatistiklerini ekle
                schoolData.subjects.forEach(subject => {
                    const grades = schoolData.students.map(s => s.subjects[subject]).filter(g => !isNaN(g));

                    if (grades.length > 0) {
                        const average = calculateAverage(grades);
                        const max = Math.max(...grades);
                        const min = Math.min(...grades);
                        const successRate = (grades.filter(g => g >= 50).length / grades.length * 100);

                        analysisData.push([
                            subject,
                            average.toFixed(2),
                            max,
                            min,
                            successRate.toFixed(2)
                        ]);
                    }
                });

                // √áalƒ±≈üma kitabƒ± olu≈ütur
                const wb = XLSX.utils.book_new();
                const ws1 = XLSX.utils.aoa_to_sheet(analysisData);
                const ws2 = XLSX.utils.json_to_sheet(schoolData.students.map(s => ({
                    '≈ûagird': s.name,
                    'Sinif': s.className,
                    'Davamsƒ±zlƒ±q (g√ºn)': s.attendance,
                    '√úmumi orta': s.average.toFixed(2),
                    'Status': s.status,
                    ...s.subjects
                })));

                XLSX.utils.book_append_sheet(wb, ws1, 'Analiz');
                XLSX.utils.book_append_sheet(wb, ws2, '≈ûagirdl…ôr');

                // Dosyayƒ± kaydet
                XLSX.writeFile(wb, `IMSA_Mektebi_Raporu_${new Date().toISOString().slice(0, 10)}.xlsx`);

                alert('Excel faylƒ± uƒüurla y√ºkl…ôndi!');

            } catch (error) {
                alert('Excel ixracƒ± zamanƒ± x…ôta: ' + error.message);
            }
        }

        function exportCharts() {
            alert('Qrafikl…ôrin ixracƒ± hazƒ±rlanƒ±r...');
        }

        function printStudentReport() {
            window.print();
        }

        function calculateAverage(values) {
            const validValues = values.filter(v => !isNaN(v));
            if (validValues.length === 0) return 0;
            return validValues.reduce((a, b) => a + b, 0) / validValues.length;
        }

        // =============================================
        // HEATMAP GENERATION
        // =============================================
        function generateHeatmap() {
            const container = document.getElementById('heatmap-container');
            if (!container) return;

            // Prioritize specific subjects
            const prioritySubjects = ["Az…ôrbaycan dili", "Riyaziyyat", "ƒ∞ngilis dili"];

            // Calculate subject frequencies
            const subjectCounts = {};
            schoolData.students.forEach(s => {
                Object.keys(s.subjects).forEach(sub => {
                    subjectCounts[sub] = (subjectCounts[sub] || 0) + 1;
                });
            });

            const subjects = [...new Set(schoolData.students.flatMap(s => Object.keys(s.subjects)))].sort((a, b) => {
                const indexA = prioritySubjects.indexOf(a);
                const indexB = prioritySubjects.indexOf(b);

                // 1. Top 3 priority subjects first
                if (indexA !== -1 && indexB !== -1) return indexA - indexB;
                if (indexA !== -1) return -1;
                if (indexB !== -1) return 1;

                // 2. Sort by frequency (descending) - more common subjects come first
                const countDiff = subjectCounts[b] - subjectCounts[a];
                if (countDiff !== 0) return countDiff;

                // 3. Alphabetical fallback
                return a.localeCompare(b, 'az');
            });

            // Get Toggle State
            const isMerged = document.getElementById('heatmap-merge-toggle')?.checked || false;

            let classes = [];
            if (isMerged) {
                // Get unique grade levels
                classes = [...new Set(schoolData.students.map(s => getGradeLevel(s.className) + "-ci sinifl…ôr"))].sort((a, b) => {
                    return parseInt(a) - parseInt(b);
                });
            } else {
                classes = [...new Set(schoolData.students.map(s => s.className))].sort();
            }

            // Structure
            let html = `<div class="table-responsive">
                <div class="heatmap-grid" style="grid-template-columns: 150px repeat(${subjects.length}, 1fr); display: grid;">`;

            // Headers
            html += `<div class="heatmap-header sticky-col" style="background: var(--light-gray); color: var(--text-color);">Sinif / F…ônn</div>`;
            subjects.forEach(s => {
                html += `<div class="heatmap-header text-center" style="background: var(--light-gray); color: var(--text-color);" title="${s} (${subjectCounts[s]} ≈üagird)">${s}</div>`;
            });

            // Data Rows
            classes.forEach(c => {
                html += `<div class="heatmap-header fw-bold sticky-col" style="background: var(--card-bg); color: var(--text-color);">${c}</div>`;
                subjects.forEach(s => {
                    let avg = null;

                    if (isMerged) {
                        // Extract grade number from "X-ci sinifl…ôr"
                        const grade = parseInt(c);
                        const gradeStudents = schoolData.students.filter(st => getGradeLevel(st.className) === grade && st.subjects[s] !== undefined);

                        if (gradeStudents.length > 0) {
                            avg = gradeStudents.reduce((acc, st) => acc + st.subjects[s], 0) / gradeStudents.length;
                        }
                    } else {
                        const classStudents = schoolData.students.filter(st => st.className === c && st.subjects[s] !== undefined);
                        if (classStudents.length > 0) {
                            avg = classStudents.reduce((acc, st) => acc + st.subjects[s], 0) / classStudents.length;
                        }
                    }

                    let bgColor = 'var(--light-gray)';
                    let textColor = 'var(--text-color)';

                    if (avg !== null) {
                        if (avg >= 91) bgColor = 'var(--dark-green)';
                        else if (avg >= 81) bgColor = 'var(--success-green)';
                        else if (avg >= 61) bgColor = 'var(--primary-blue)';
                        else if (avg >= 31) bgColor = 'var(--warning-orange)';
                        else bgColor = 'var(--danger-red)';
                        textColor = 'white';
                    }

                    html += `<div class="heatmap-cell" style="background: ${bgColor}; color: ${textColor}" title="${c} - ${s}: ${avg ? avg.toFixed(1) : 'N/A'}">
                        ${avg ? avg.toFixed(0) : '-'}
                    </div>`;
                });
            });

            html += '</div></div>';
            container.innerHTML = html;
        }

        // =============================================
        // IMPACT ANALYSIS (CORRELATION)
        // =============================================
        function updateImpactAnalysis() {
            const chartCanvas = document.getElementById('impactAnalysisChart');
            if (!chartCanvas) return;
            const ctx = chartCanvas.getContext('2d');

            const impactData = {
                '0 g√ºn': { total: 0, count: 0 },
                '1-3 g√ºn': { total: 0, count: 0 },
                '4-7 g√ºn': { total: 0, count: 0 },
                '8-14 g√ºn': { total: 0, count: 0 },
                '15+ g√ºn': { total: 0, count: 0 }
            };

            schoolData.students.forEach(s => {
                let range = '';
                if (s.attendance === 0) range = '0 g√ºn';
                else if (s.attendance <= 3) range = '1-3 g√ºn';
                else if (s.attendance <= 7) range = '4-7 g√ºn';
                else if (s.attendance <= 14) range = '8-14 g√ºn';
                else range = '15+ g√ºn';

                impactData[range].total += s.average;
                impactData[range].count++;
            });

            const labels = Object.keys(impactData);
            const data = labels.map(l => impactData[l].count > 0 ? (impactData[l].total / impactData[l].count).toFixed(1) : 0);

            if (charts.impactChart) charts.impactChart.destroy();

            charts.impactChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Ortalama Bal',
                        data: data,
                        backgroundColor: '#00adba',
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, max: 100 }
                    },
                    plugins: {
                        legend: { display: false },
                        colors: { forceOverride: true },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `Ortalama: ${context.parsed.y}`;
                                },
                                title: function (context) {
                                    return `Davamsƒ±zlƒ±q: ${context[0].label}`;
                                }
                            }
                        }
                    }
                }
            });

            const zeroAvg = parseFloat(data[0]) || 0;
            const chronicAvg = parseFloat(data[4]) || 0;
            const diff = (zeroAvg - chronicAvg).toFixed(1);

            const insightBox = document.getElementById('insight-content');
            if (insightBox) {
                insightBox.innerHTML = `
                    <ul class="list-unstyled mb-0 small">
                        <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i> Davamsƒ±zlƒ±ƒüƒ± 0 olan ≈üagirdl…ôrin ortalamasƒ±: <b>${zeroAvg}</b></li>
                        <li class="mb-2"><i class="fas fa-exclamation-circle text-danger me-2"></i> Xroniki davamsƒ±zlƒ±ƒüƒ± olanlarƒ±n ortalamasƒ±: <b>${chronicAvg}</b></li>
                        <li class="mb-2"><i class="fas fa-arrow-down text-warning me-2"></i> Davamsƒ±zlƒ±q artdƒ±qca n…ôtic…ôl…ôrd…ô orta hesabla <b>${diff} bal</b> eni≈ü m√º≈üahid…ô olunur.</li>
                        <li><i class="fas fa-info-circle text-primary me-2"></i> T√∂vsiy…ô: 5 g√ºnd…ôn √ßox d…ôrs qa√ßƒ±ranlar √º√ß√ºn x√ºsusi d…ôst…ôk proqramƒ± t…ôtbiq edilm…ôlidir.</li>
                    </ul>
                `;
            }
        }

        // =============================================
        // TEACHER ANALYSIS LOGIC
        // =============================================
        let teacherCharts = {};

        function getTeacherForSubject(student, subjectName) {
            const normalizedClass = student.className;

            // 1. Check Subgroups (6-8 Math/English)
            if (SUBGROUP_TEACHERS[subjectName] && SUBGROUP_TEACHERS[subjectName][normalizedClass]) {
                const subgroups = SUBGROUP_TEACHERS[subjectName][normalizedClass];
                for (const tName in subgroups) {
                    if (subgroups[tName].includes(student.name)) return tName;
                }
            }

            // 2. Check General Subject Teachers
            if (SUBJECT_TEACHERS[normalizedClass] && SUBJECT_TEACHERS[normalizedClass][subjectName]) {
                return SUBJECT_TEACHERS[normalizedClass][subjectName];
            }

            return 'T…ôyin edilm…ôyib';
        }

        function updateTeachersView() {
            const grid = document.getElementById('teachers-grid');
            const detailView = document.getElementById('teacher-detail-view');
            const searchInput = document.getElementById('teacher-search');

            grid.style.display = 'flex';
            detailView.style.display = 'none';
            grid.innerHTML = '';

            // Calculate Teacher Stats
            const teacherStats = {};
            schoolData.students.forEach(student => {
                for (const subject in student.subjects) {
                    const teacherName = getTeacherForSubject(student, subject);
                    if (teacherName === 'T…ôyin edilm…ôyib') continue;

                    if (!teacherStats[teacherName]) {
                        teacherStats[teacherName] = {
                            name: teacherName,
                            subjects: new Set(),
                            uniqueStudents: new Set(),
                            classes: new Set(),
                            totalScore: 0,
                            dataCount: 0
                        };
                    }

                    teacherStats[teacherName].subjects.add(subject);
                    teacherStats[teacherName].classes.add(student.className);
                    teacherStats[teacherName].uniqueStudents.add(student.id);
                    teacherStats[teacherName].totalScore += student.subjects[subject];
                    teacherStats[teacherName].dataCount++;
                }
            });

            const query = searchInput.value.toLowerCase();

            Object.values(teacherStats).sort((a, b) => a.name.localeCompare(b.name, 'az')).forEach(teacher => {
                if (query && !teacher.name.toLowerCase().includes(query)) return;

                const avg = (teacher.totalScore / teacher.dataCount).toFixed(1);
                const subjectsArr = Array.from(teacher.subjects);

                const card = document.createElement('div');
                card.className = 'col-md-4 col-lg-3 mb-4';
                card.innerHTML = `
                    <div class="card h-100 teacher-card animate-slide-up" onclick="showTeacherDetail('${teacher.name.replace(/'/g, "\\'")}')" style="cursor: pointer; transition: transform 0.2s;">
                        <div class="card-body text-center">
                            <div class="avatar-circle mx-auto mb-3" style="width: 70px; height: 70px; background: var(--card-bg); border: 2px solid var(--primary-blue); border-radius: 50%; display: flex; align-items: center; justify-content: center; overflow: hidden; padding: 5px;">
                                <img src="https://i.imgur.com/a3FuVV8.png" style="width: 100%; height: 100%; object-fit: contain;" 
                                     onerror="this.onerror=null; this.src='https://placehold.co/70x70/00525d/ffffff?text=IMSA';">
                            </div>
                            <h5 class="mb-1">${teacher.name}</h5>
                            <p class="text-primary small mb-2">${subjectsArr.join(', ')}</p>
                            <div class="d-flex justify-content-around mt-3">
                                <div>
                                    <div class="fw-bold">${teacher.uniqueStudents.size}</div>
                                    <small class="text-muted">≈ûagird</small>
                                </div>
                                <div>
                                    <div class="fw-bold">${avg}</div>
                                    <small class="text-muted">Orta</small>
                                </div>
                                <div>
                                    <div class="fw-bold">${teacher.classes.size}</div>
                                    <small class="text-muted">Sinif</small>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });

            if (!searchInput.oninput) {
                searchInput.oninput = updateTeachersView;
            }
        }

        function showTeachersGrid() {
            document.getElementById('teachers-grid').style.display = 'flex';
            document.getElementById('teacher-detail-view').style.display = 'none';
        }

        function showTeacherDetail(teacherName) {
            const grid = document.getElementById('teachers-grid');
            const detailView = document.getElementById('teacher-detail-view');
            grid.style.display = 'none';
            detailView.style.display = 'block';

            // Collect Data
            const teacherData = {
                students: [], // all subject-student pairs
                uniqueStudentIds: new Set(),
                classes: {},
                subjectStats: {}, // To store avg per subject
                totalScore: 0,
                warningCount: 0,
                totalDataEntries: 0
            };

            schoolData.students.forEach(student => {
                let isTeacherForThisStudent = false;
                for (const subject in student.subjects) {
                    if (getTeacherForSubject(student, subject) === teacherName) {
                        isTeacherForThisStudent = true;
                        if (!teacherData.subjectStats[subject]) {
                            teacherData.subjectStats[subject] = { total: 0, count: 0 };
                        }
                        teacherData.subjectStats[subject].total += student.subjects[subject];
                        teacherData.subjectStats[subject].count++;

                        teacherData.students.push({
                            id: student.id,
                            name: student.name,
                            className: student.className,
                            subject: subject,
                            grade: student.subjects[subject],
                            status: student.subjects[subject] >= 85 ? '∆èla' : (student.subjects[subject] >= 50 ? 'Yax≈üƒ±' : 'Z…ôif')
                        });
                        teacherData.totalScore += student.subjects[subject];
                        teacherData.totalDataEntries++;
                        if (student.subjects[subject] < 50) teacherData.warningCount++;

                        if (!teacherData.classes[student.className]) {
                            teacherData.classes[student.className] = { total: 0, count: 0 };
                        }
                        teacherData.classes[student.className].total += student.subjects[subject];
                        teacherData.classes[student.className].count++;
                    }
                }
                if (isTeacherForThisStudent) {
                    teacherData.uniqueStudentIds.add(student.id);
                }
            });

            // Update UI
            document.getElementById('detail-teacher-name').textContent = teacherName;
            document.getElementById('detail-teacher-subject').textContent = Object.keys(teacherData.subjectStats).join(', ');
            document.getElementById('teacher-student-count').textContent = teacherData.uniqueStudentIds.size;
            document.getElementById('teacher-performance-avg').textContent = (teacherData.totalScore / teacherData.totalDataEntries).toFixed(1);
            document.getElementById('teacher-class-count').textContent = Object.keys(teacherData.classes).length;
            document.getElementById('teacher-warning-count').textContent = teacherData.warningCount;

            // Populate Subject Averages
            const subAvgContainer = document.getElementById('teacher-subject-averages');
            if (subAvgContainer) {
                subAvgContainer.innerHTML = '';
                Object.keys(teacherData.subjectStats).sort().forEach(sub => {
                    const stats = teacherData.subjectStats[sub];
                    const avg = (stats.total / stats.count).toFixed(1);
                    const col = document.createElement('div');
                    col.className = 'col-md-4 col-sm-6';
                    col.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center p-2 border rounded shadow-sm" style="background: var(--card-bg);">
                            <span class="small fw-bold text-truncate me-2" title="${sub}">${sub}</span>
                            <span class="badge ${getGradeBadgeClass(parseFloat(avg))}">${avg}</span>
                        </div>
                    `;
                    subAvgContainer.appendChild(col);
                });
            }

            // Global store for filtering
            currentTeacherStudents = teacherData.students;

            // Populate Class Filter
            const classFilter = document.getElementById('teacher-student-class-filter');
            if (classFilter) {
                classFilter.innerHTML = '<option value="all">B√ºt√ºn Sinifl…ôr</option>';
                const uniqueClasses = [...new Set(teacherData.students.map(s => s.className))].sort();
                uniqueClasses.forEach(c => {
                    const opt = document.createElement('option');
                    opt.value = c;
                    opt.textContent = c;
                    classFilter.appendChild(opt);
                });
            }

            // Populate Subject Filter
            const subjectFilter = document.getElementById('teacher-student-subject-filter');
            if (subjectFilter) {
                subjectFilter.innerHTML = '<option value="all">B√ºt√ºn F…ônl…ôr</option>';
                const uniqueSubjects = [...new Set(teacherData.students.map(s => s.subject))].sort();
                uniqueSubjects.forEach(s => {
                    const opt = document.createElement('option');
                    opt.value = s;
                    opt.textContent = s;
                    subjectFilter.appendChild(opt);
                });
            }

            // Reset Initial Filter UI
            const sortSelect = document.getElementById('teacher-student-sort');
            if (sortSelect) sortSelect.value = 'desc';

            // Initial Table Render
            filterTeacherStudents();

            // Update Charts
            updateTeacherCharts({
                classes: teacherData.classes,
                students: teacherData.students
            });
        }

        let currentTeacherStudents = [];

        function filterTeacherStudents() {
            const classFilter = document.getElementById('teacher-student-class-filter').value;
            const subjectFilter = document.getElementById('teacher-student-subject-filter').value;
            const sortOrder = document.getElementById('teacher-student-sort').value;

            let filtered = [...currentTeacherStudents];

            if (classFilter !== 'all') {
                filtered = filtered.filter(s => s.className === classFilter);
            }

            if (subjectFilter !== 'all') {
                filtered = filtered.filter(s => s.subject === subjectFilter);
            }

            if (sortOrder === 'asc') {
                filtered.sort((a, b) => a.grade - b.grade);
            } else {
                filtered.sort((a, b) => b.grade - a.grade);
            }

            renderTeacherStudentTable(filtered);
        }

        function renderTeacherStudentTable(students) {
            const tableBody = document.getElementById('teacher-students-table-body');
            tableBody.innerHTML = '';

            if (students.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">M…ôlumat tapƒ±lmadƒ±</td></tr>';
                return;
            }

            students.forEach(s => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="cursor: pointer; color: var(--primary-blue);" onclick="viewStudentDetails(${s.id})"><strong>${s.name}</strong></td>
                    <td><span class="badge bg-primary">${s.className}</span></td>
                    <td class="small text-muted">${s.subject}</td>
                    <td><span class="badge ${getGradeBadgeClass(s.grade)}">${s.grade}</span></td>
                    <td>${s.status}</td>
                    <td>${s.grade < 50 ? '<span class="text-danger"><i class="fas fa-arrow-down me-1"></i>D…ôst…ôk lazƒ±mdƒ±r</span>' : '<span class="text-success"><i class="fas fa-check me-1"></i>Stabil</span>'}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        function updateTeacherCharts(data) {
            const classCtx = document.getElementById('teacherClassChart').getContext('2d');
            const distCtx = document.getElementById('teacherDistributionChart').getContext('2d');

            if (teacherCharts.classChart) teacherCharts.classChart.destroy();
            if (teacherCharts.distChart) teacherCharts.distChart.destroy();

            const classLabels = Object.keys(data.classes).sort();
            const classAverages = classLabels.map(c => (data.classes[c].total / data.classes[c].count).toFixed(1));

            teacherCharts.classChart = new Chart(classCtx, {
                type: 'bar',
                data: {
                    labels: classLabels,
                    datasets: [{
                        label: 'Sinif Ortalamasƒ±',
                        data: classAverages,
                        backgroundColor: '#00adba',
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true, max: 100 } }
                }
            });

            const distData = [
                data.students.filter(s => s.grade >= 90).length,
                data.students.filter(s => s.grade >= 70 && s.grade < 90).length,
                data.students.filter(s => s.grade >= 50 && s.grade < 70).length,
                data.students.filter(s => s.grade < 50).length
            ];

            teacherCharts.distChart = new Chart(distCtx, {
                type: 'doughnut',
                data: {
                    labels: ['90-100 (∆èla)', '70-89 (Yax≈üƒ±)', '50-69 (Kafi)', '<50 (Z…ôif)'],
                    datasets: [{
                        data: distData,
                        backgroundColor: ['#28a745', '#007bff', '#ffc107', '#dc3545']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } }
                }
            });
        }
        // HIZLI D√úZELTME - D√úƒûMELERƒ∞ √áALI≈ûTIR
        document.addEventListener('DOMContentLoaded', function () {
            // Modern grid butonlarƒ±
            document.querySelectorAll('.modern-nav-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    // T√ºm butonlardan active class'ƒ±nƒ± kaldƒ±r
                    document.querySelectorAll('.modern-nav-btn').forEach(b => {
                        b.classList.remove('active');
                    });

                    // Tƒ±klanana active ekle
                    this.classList.add('active');

                    // T√ºm b√∂lmeleri gizle
                    document.querySelectorAll('.content-section').forEach(section => {
                        section.style.display = 'none';
                    });

                    // ƒ∞lgili b√∂l√ºm√º g√∂ster
                    const sectionName = this.getAttribute('data-section');
                    const targetSection = document.getElementById(sectionName + '-section');
                    if (targetSection) {
                        targetSection.style.display = 'block';

                        // Gerekli g√ºncellemeleri yap
                        if (sectionName === 'dashboard') updateDashboard();
                        if (sectionName === 'students') updateStudentsView();
                        if (sectionName === 'attendance') updateAttendanceView();
                        if (sectionName === 'subjects') updateSubjectsView();
                        if (sectionName === 'classes') updateClassesView();
                        if (sectionName === 'comparison') updateComparisonView();
                        if (sectionName === 'teachers') updateTeachersView();
                        if (sectionName === 'export') {
                            generateHeatmap();
                            updateImpactAnalysis();
                        }
                    }
                });
            });

            // Toggle Event Listeners
            const mergeClassesToggle = document.getElementById('merge-classes-toggle');
            if (mergeClassesToggle) {
                mergeClassesToggle.addEventListener('change', updateClassesView);
            }
            const comparisonMergeToggle = document.getElementById('comparison-merge-toggle');
            if (comparisonMergeToggle) {
                comparisonMergeToggle.addEventListener('change', updateComparisonView);
            }
            const heatmapMergeToggle = document.getElementById('heatmap-merge-toggle');
            if (heatmapMergeToggle) {
                heatmapMergeToggle.addEventListener('change', generateHeatmap);
            }
            const subjectMergeToggle = document.getElementById('subject-merge-toggle');
            if (subjectMergeToggle) {
                subjectMergeToggle.addEventListener('change', updateSubjectsView);
            }
        });

        console.log('Navigasyon butonlarƒ± aktif!');
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
